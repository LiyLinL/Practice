sap.ui.define(["sap/ui/core/Control","sap/ui/core/Element","./library"],function(e,t,n){"use strict";var i=e.extend("fw.Scheduler.Scheduler",{metadata:{library:"fw.Scheduler",properties:{width:{type:"string",group:"appearance",defaultValue:"100%"},height:{type:"string",group:"appearance",defaultValue:"100%"},defaultDate:{type:"string",group:"config",defaultValue:"%Y/%m/%d"},detailsOnCreate:{type:"boolean",group:"config",defaultValue:false},dblclickCreate:{type:"boolean",group:"config",defaultValue:false},dragCreate:{type:"boolean",group:"config",defaultValue:false},detailsOnDblclick:{type:"boolean",group:"config",defaultValue:false},eventOnDblclick:{type:"boolean",group:"config",defaultValue:false},eventDrag:{type:"boolean",group:"config",defaultValue:false},beforeEventChanged:{type:"boolean",group:"config",defaultValue:false},beforeLightbox:{type:"boolean",group:"config",defaultValue:false},beforeTodayDisplayed:{type:"boolean",group:"config",defaultValue:true},name:{type:"string",defaultValue:"timeline"},xUnit:{type:"string",defaultValue:"minute"},xDate:{type:"string",defaultValue:"%H:%i"},xStep:{type:"int",defaultValue:60},xSize:{type:"int",defaultValue:24},xStart:{type:"int",defaultValue:7},xLength:{type:"int",defaultValue:24},yUnit:{type:"object",defaultValue:undefined},yProperty:{type:"string",defaultValue:"headKey"},render:{type:"string",defaultValue:"bar"},secondScale:{type:"object",defaultValue:undefined},detail:{type:"object",defaultValue:undefined},lightBoxSections:{type:"object",defaultValue:[]},dx:{type:"int",defaultValue:220},autoHeight:{type:"boolean",defaultValue:false}},events:{onDblClick:{parameters:{id:{type:"string"},e:{type:"object"}}},onViewChange:{parameters:{new_mode:{type:"string"},new_date:{type:"object"}}},onDataRender:{parameters:{}},onBeforeLightbox:{parameters:{id:{type:"string"}}},onBeforeDrag:{parameters:{id:{type:"string"},mode:{type:"string"},e:{type:"Event"}}},onBeforeEventChanged:{parameters:{ev:{type:"object"},e:{type:"Event"},is_new:{type:"boolean"},original:{type:"object"}}},onBeforeTodayDisplayed:{parameters:{}},showLightbox:{parameters:{id:{type:"string"}}},onPickCalDate:{parameters:{date:{type:"date"}}}}},init:function(){var e=window.innerHeight-100;this.setProperty("height",e+"px")},onAfterRendering:function(e){this.setConfig();if(scheduler.getView(this.getName())==null){this.createTimeLine();this.onDblClick();this.onViewChange();this.onDataRender();this.onBeforeLightbox();this.onBeforeDrag();this.onBeforeEventChanged();this.onBeforeTodayDisplayed();this.showLightbox()}this.miniCalCreate();var t=this.getId();var n=this.getName();scheduler.init(this.getId(),new Date,this.getName());scheduler.clearAll();this.updateCollection(this.getYUnit());this.parse(this.getDetail())},setConfig:function(){scheduler.config.default_date=this.getDefaultDate();scheduler.config.details_on_create=this.getDetailsOnCreate();scheduler.config.dblclick_create=this.getDblclickCreate();scheduler.config.drag_create=this.getDragCreate();scheduler.config.details_on_dblclick=this.getDetailsOnDblclick();scheduler.config.lightbox.sections=this.getLightBoxSections()},createTimeLine:function(){var e=this.getSecondScale();if(!e){e={x_unit:"day",x_date:"%m/%d"}}scheduler.createTimelineView({name:this.getName(),x_unit:this.getXUnit(),x_date:this.getXDate(),x_step:this.getXStep(),x_size:this.getXSize(),x_start:this.getXStart(),x_length:this.getXLength(),y_unit:scheduler.serverList("section",this.getYUnit()),y_property:this.getYProperty(),render:this.getRender(),section_autoheight:this.getAutoHeight(),second_scale:e,dx:this.getDx()})},miniCalCreate:function(){var e=this;$("#dhx_minical_icon").click(function(){if(scheduler.isCalendarVisible()){scheduler.destroyCalendar()}else{scheduler.renderCalendar({position:"dhx_minical_icon",date:scheduler.getState().date,navigation:true,handler:function(t,n){e.fireOnPickCalDate({date:t});scheduler.setCurrentView(t);scheduler.destroyCalendar()}})}})},onViewChange:function(){var e=this;scheduler.attachEvent("onViewChange",function(t,n){e.fireOnViewChange({new_mode:t,new_date:n})})},onDataRender:function(){var e=this,t=this.getId();scheduler.attachEvent("onDataRender",function(){var n=$("#"+t).children("div.dhx_cal_navline").children(".dhx_cal_date");var i=n.text();if(i.includes("–")){n.text(i.split("–")[0].replace(/\s*/g,""))}e.fireOnDataRender()})},onBeforeLightbox:function(){var e=this;scheduler.attachEvent("onBeforeLightbox",function(t){e.fireOnBeforeLightbox({id:t});return e.getBeforeLightbox()})},onDblClick:function(){var e=this;scheduler.attachEvent("onDblClick",function(t,n){e.fireOnDblClick({id:t,e:n});return e.getEventOnDblclick()})},onBeforeDrag:function(){var e=this;scheduler.attachEvent("onBeforeDrag",function(t,n,i){e.fireOnBeforeDrag({id:t,mode:n,e:i});return e.getEventDrag()})},onBeforeEventChanged:function(){var e=this;scheduler.attachEvent("onBeforeEventChanged",function(t,n,i,a){e.fireOnBeforeEventChanged({ev:t,e:n,is_new:i,original:a});return e.getBeforeEventChanged()})},onBeforeTodayDisplayed:function(){var e=this;scheduler.attachEvent("onBeforeTodayDisplayed",function(){e.fireOnBeforeTodayDisplayed();return e.getBeforeTodayDisplayed()})},updateCollection:function(e){scheduler.updateCollection("section",e);return this},parse:function(e){scheduler.parse(e);return this},setCurrentView:function(e,t){if(e&&t){scheduler.setCurrentView(e,t)}else if(e&&!t){scheduler.setCurrentView(e)}else{scheduler.setCurrentView()}},deleteMarkedTimespan:function(e){if(e){scheduler.deleteMarkedTimespan(e)}else{scheduler.deleteMarkedTimespan()}},addMarkedTimespan:function(e){scheduler.addMarkedTimespan(e);return this},showLightbox:function(){scheduler.showLightbox=function(e){}}});return i});