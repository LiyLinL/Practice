/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){(function(){if(!e._inited_multisection_copies){e.attachEvent("onEventIdChange",function(e,t){var a=this._multisection_copies;if(!a)return;if(a[e]&&!a[t]){var r=a[e];delete a[e];a[t]=r}});e._inited_multisection_copies=true}e._register_copies_array=function(e){for(var t=0;t<e.length;t++)this._register_copy(e[t])};e._register_copy=function(e){if(!this._multisection_copies){return}if(!this._multisection_copies[e.id]){this._multisection_copies[e.id]={}}var t=e[this._get_section_property()];var a=this._multisection_copies[e.id];a[t]=e};e._get_copied_event=function(t,a){if(!this._multisection_copies[t])return null;if(this._multisection_copies[t][a])return this._multisection_copies[t][a];var r=this._multisection_copies[t];if(e._drag_event&&e._drag_event._orig_section&&r[e._drag_event._orig_section]){return r[e._drag_event._orig_section]}else{var _=Infinity,n=null;for(var i in r){if(r[i]._sorder<_){n=r[i];_=r[i]._sorder}}return n}};e._clear_copied_events=function(){this._multisection_copies={}};e._restore_render_flags=function(t){var a=this._get_section_property();for(var r=0;r<t.length;r++){var _=t[r];var n=e._get_copied_event(_.id,_[a]);if(n){for(var i in n){if(i.indexOf("_")===0){_[i]=n[i]}}}}};var t=e.createTimelineView;e.createTimelineView=function(a){if(a.render!="days"){t.apply(this,arguments);return}var r=a.name;var _=a.y_property="timeline-week"+r;a.y_unit=[];a.render="bar";a.days=a.days||7;t.call(this,a);e.templates[r+"_scalex_class"]=function(){};e.templates[r+"_scaley_class"]=function(){};e.templates[r+"_scale_label"]=function(t,a,r){return e.templates.day_date(a)};e.date[r+"_start"]=function(t){t=e.date.week_start(t);t=e.date.add(t,a.x_step*a.x_start,a.x_unit);return t};e.date["add_"+r]=function(t,r){return e.date.add(t,r*a.days,"day")};function n(){var t=new Date(e.getState().date);var _=e.date[r+"_start"](t);_=e.date.date_part(_);var n=[];var i=e.matrix[r];i.y_unit=n;i.order={};for(var d=0;d<a.days;d++){n.push({key:+_,label:_});i.order[i.y_unit[d].key]=d;_=e.date.add(_,1,"day")}}var i=e._renderMatrix;e._renderMatrix=function(e,t){if(e){n()}i.apply(this,arguments)};function d(e){var t={};for(var a in e)t[a]=e[a];return t}var s=e.checkCollision;e.checkCollision=function(t){if(t[_]){var t=d(t);delete t[_]}return s.apply(e,[t])};e.attachEvent("onBeforeDrag",function(t,a,r){var _=r.target||r.srcElement;var n=e._getClassName(_);if(a=="resize"){if(n.indexOf("dhx_event_resize_end")<0){e._w_line_drag_from_start=true}else{e._w_line_drag_from_start=false}}else if(a=="move"){if(n.indexOf("no_drag_move")>=0){return false}}return true});var o=e["mouse_"+r];e["mouse_"+r]=function(t){var a;if(this._drag_event)a=this._drag_event._move_delta;var _=e.matrix[this._mode];if(_.scrollable&&!t.converted){t.converted=1;t.x-=-_._x_scroll;t.y+=_._y_scroll}if(a===undefined&&e._drag_mode=="move"){var n={y:t.y};e._resolve_timeline_section(_,n);var i=t.x-_.dx;var d=new Date(n.section);y(e._timeline_drag_date(_,i),d);var s=e._drag_event;var f=this.getEvent(this._drag_id);if(f){s._move_delta=(f.start_date-d)/6e4;if(this.config.preserve_length&&t._ignores){s._move_delta=this._get_real_event_length(f.start_date,d,_);s._event_length=this._get_real_event_length(f.start_date,f.end_date,_)}}}var t=o.apply(e,arguments);if(e._drag_mode&&e._drag_mode!="move"){var v=null;if(e._drag_event&&e._drag_event["timeline-week"+r]){v=new Date(e._drag_event["timeline-week"+r])}else{v=new Date(t.section)}t.y+=Math.round((v-e.date.date_part(new Date(e._min_date)))/(1e3*60*this.config.time_step));if(e._drag_mode=="resize"){t.resize_from_start=e._w_line_drag_from_start}}else{if(e._drag_event){var l=Math.floor(Math.abs(t.y/(24*60/e.config.time_step)));l*=t.y>0?1:-1;t.y=t.y%(24*60/e.config.time_step);var c=e.date.date_part(new Date(e._min_date));if(c.valueOf()!=new Date(t.section).valueOf()){t.x=Math.floor((t.section-c)/(24*60*6e4));t.x+=l}}}return t};e.attachEvent("onEventCreated",function(t,a){if(e._events[t]){delete e._events[t][_]}return true});e.attachEvent("onBeforeEventChanged",function(t,a,r,n){if(e._events[t.id]){delete e._events[t.id][_]}return true});var f=e._update_timeline_section;e._update_timeline_section=function(t){var a,_;if(this._mode==r){a=t.event;if(a){_=e._get_copied_event(a.id,e.date.day_start(new Date(a.start_date.valueOf())));if(_){t.event._sorder=_._sorder;t.event._count=_._count}}}var n=f.apply(this,arguments);if(a&&_){_._count=a._count;_._sorder=a._sorder}};var v=e.render_view_data;e.render_view_data=function(t,a){if(this._mode==r){if(t){t=p(t);e._restore_render_flags(t)}}return v.apply(e,[t,a])};var l=e.get_visible_events;e.get_visible_events=function(){if(this._mode==r){this._clear_copied_events();e._max_date=e.date.date_part(e.date.add(e._min_date,a.days,"day"));var t=l.apply(e,arguments);t=p(t);e._register_copies_array(t);return t}return l.apply(e,arguments)};var c=e.addEventNow;e.addEventNow=function(t){if(e.getState().mode==r){if(t[_]){var a=new Date(t[_]);u(a,t.start_date);u(a,t.end_date)}else{var n=new Date(t.start_date);t[_]=+e.date.date_part(n)}}return c.apply(e,arguments)};function u(e,t){t.setDate(1);t.setFullYear(e.getFullYear());t.setMonth(e.getMonth());t.setDate(e.getDate())}function p(t){var a=[];for(var r=0;r<t.length;r++){var _=g(t[r]);if(!e.isOneDayEvent(_)){var n=new Date(Math.min(+_.end_date,+e._max_date)),i=new Date(Math.max(+_.start_date,+e._min_date));var d=[];while(+i<+n){var s=g(_);s.start_date=i;s.end_date=new Date(Math.min(+w(s.start_date),+n));i=w(i);h(s);a.push(s);d.push(s)}m(d,_)}else{h(_);a.push(_)}}return a}function m(e,t){var a=false;var r=false;for(var _=0,n=e.length;_<n;_++){var i=e[_];a=+i._w_start_date==+t.start_date;r=+i._w_end_date==+t.end_date;i._no_resize_start=i._no_resize_end=true;if(a){i._no_resize_start=false}if(r)i._no_resize_end=false}}function g(t){var a=e.getEvent(t.event_pid);if(a&&a.isPrototypeOf(t)){t=e._copy_event(t);delete t.event_length;delete t.event_pid;delete t.rec_pattern;delete t.rec_type}else{t=e._lame_clone(t)}return t}function h(t){if(t._w_start_date&&t._w_end_date){return}var a=e.date,r=t._w_start_date=new Date(t.start_date),n=t._w_end_date=new Date(t.end_date);t[_]=+a.date_part(t.start_date);if(!t._count)t._count=1;if(!t._sorder)t._sorder=0;var i=n-r;t.start_date=new Date(e._min_date);y(r,t.start_date);t.end_date=new Date(+t.start_date+i);if(r.getTimezoneOffset()!=n.getTimezoneOffset()){t.end_date=new Date(t.end_date.valueOf()+(r.getTimezoneOffset()-n.getTimezoneOffset())*(1e3*60))}}function y(e,t){t.setMinutes(e.getMinutes());t.setHours(e.getHours())}function w(t){var a=e.date.add(t,1,"day");a=e.date.date_part(a);return a}var D=e._render_marked_timespan;e._render_marked_timespan=function(){if(e._mode==r){return}return D.apply(this,arguments)}}})()});