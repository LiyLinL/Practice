/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e._temp_matrix_scope=function(){var t=function(){return function e(){var t={minMax:"[0;max]",maxMin:"[max;0]",nMaxMin:"[-max;0]"};function r(){var e=document.createElement("div");e.style.cssText="direction: rtl;"+"overflow: auto;"+"width:100px;"+"height: 100px;"+"position:absolute;"+"top: -100500px;"+"left: -100500px;";var t=document.createElement("div");t.style.cssText="width: 100500px;height: 1px;";e.appendChild(t);return e}function i(){var e=t.minMax;var i=r();document.body.appendChild(i);var a=i.scrollLeft;if(a>0){e=t.minMax}else{i.scrollLeft=-50;if(i.scrollLeft===-50){e=t.nMaxMin}else{e=t.maxMin}}document.body.removeChild(i);return e}function a(e,r){var i=s();if(i===t.nMaxMin){if(e){return-e}else{return 0}}else if(i===t.minMax){return r-e}else{return e}}function _(e){var t=getComputedStyle(e).direction;if(!t||t==="ltr"){return e.scrollLeft}else{var r=e.scrollWidth-e.offsetWidth;return a(e.scrollLeft,r)}}function l(e,t){var r=getComputedStyle(e).direction;if(!r||r==="ltr"){e.scrollLeft=t}else{var i=e.scrollWidth-e.offsetWidth;var _=a(t,i);e.scrollLeft=_}}var n;function s(){if(!n){n=i()}return n}return{modes:t,getMode:s,normalizeValue:a,getScrollValue:_,setScrollValue:l}}}();e.matrix={};e._merge=function(e,t){for(var r in t)if(typeof e[r]=="undefined")e[r]=t[r]};e.createTimelineView=function(i){e._skin_init();e._merge(i,{scrollHelper:t(),column_width:100,autoscroll:{range_x:200,range_y:100,speed_x:20,speed_y:10},_is_new_view:true,_section_autowidth:true,_x_scroll:0,_y_scroll:0,_h_cols:{},_label_rows:[],section_autoheight:true,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:e.xy.bar_height-5,event_min_dy:e.xy.bar_height-5,resize_events:true,fit_events:true,show_unassigned:false,second_scale:false,round_position:false,_logic:function(t,r,i){var a={};if(e.checkEvent("onBeforeSectionRender")){a=e.callEvent("onBeforeSectionRender",[t,r,i])}return a}});i._original_x_start=i.x_start;if(i.x_unit!="day")i.first_hour=i.last_hour=0;i._start_correction=i.first_hour?i.first_hour*60*60*1e3:0;i._end_correction=i.last_hour?(24-i.last_hour)*60*60*1e3:0;if(e.checkEvent("onTimelineCreated")){e.callEvent("onTimelineCreated",[i])}dhtmlxEventable(i);var a=e.render_data;e.render_data=function(t,r){if(this._mode==i.name){if(r&&!i.show_unassigned&&i.render!="cell"){for(var _=0;_<t.length;_++){this.clear_event(t[_]);this.render_timeline_event.call(this.matrix[this._mode],t[_],true)}}else{e._renderMatrix.call(i,true,true)}}else return a.apply(this,arguments)};e.matrix[i.name]=i;e.templates[i.name+"_cell_value"]=function(e){return e?e.length:""};e.templates[i.name+"_cell_class"]=function(e){return""};e.templates[i.name+"_scalex_class"]=function(e){return""};e.templates[i.name+"_second_scalex_class"]=function(e){return""};e.templates[i.name+"_row_class"]=function(e,t){if(t.folder_events_available&&e.children){return"folder"}return""};e.templates[i.name+"_scaley_class"]=function(e,t,r){return""};e.templates[i.name+"_scale_label"]=function(e,t,r){return t};e.templates[i.name+"_tooltip"]=function(e,t,r){return r.text};e.templates[i.name+"_date"]=function(t,r){if(t.getDay()==r.getDay()&&r-t<24*60*60*1e3||+t==+e.date.date_part(new Date(r))||+e.date.add(t,1,"day")==+r&&r.getHours()===0&&r.getMinutes()===0)return e.templates.day_date(t);if(t.getDay()!=r.getDay()&&r-t<24*60*60*1e3){return e.templates.day_date(t)+" &ndash; "+e.templates.day_date(r)}return e.templates.week_date(t,r)};e.templates[i.name+"_scale_date"]=e.date.date_to_str(i.x_date||e.config.hour_date);e.templates[i.name+"_second_scale_date"]=e.date.date_to_str(i.second_scale&&i.second_scale.x_date?i.second_scale.x_date:e.config.hour_date);e.date["add_"+i.name+"_private"]=function(t,r){var a=r;var _=i.x_unit;if(i.x_unit=="minute"||i.x_unit=="hour"){var l=a;if(i.x_unit=="hour")l*=60;if(!(l%(24*60))){a=l/(24*60);_="day"}}return e.date.add(t,a,_)};e.date["add_"+i.name]=function(t,r,a){var _=e.date["add_"+i.name+"_private"](t,(i.x_length||i.x_size)*i.x_step*r);if(i.x_unit=="minute"||i.x_unit=="hour"){var l=i.x_length||i.x_size;var n=i.x_unit=="hour"?i.x_step*60:i.x_step;if(n*l%(24*60)){if(+e.date.date_part(new Date(t))==+e.date.date_part(new Date(_))){i.x_start+=r*l}else{var s=24*60/(l*n)-1;var o=Math.round(s*l);if(r>0){i.x_start=i.x_start-o}else{i.x_start=o+i.x_start}}}}return _};e.date[i.name+"_start"]=function(t){var r=e.date[i.x_unit+"_start"]||e.date.day_start;var a=r.call(e.date,t);var _=a.getTimezoneOffset();a=e.date.add(a,i.x_step*i.x_start,i.x_unit);var l=a.getTimezoneOffset();if(_!=l){a.setTime(a.getTime()+(l-_)*6e4)}return a};i.scrollTo=e.bind(function(t){if(!t){return}var r;if(t.date){r=t.date}else if(t.left){r=t.left}else{r=t}var i=-1;if(t.section){i=this.posFromSection(t.section)}else if(t.top){i=t.top}var a;if(typeof r=="number"){a=r}else{a=this.posFromDate(r)}if(e.config.rtl){var _=+e.$container.querySelector(".dhx_timeline_label_wrapper").style.height.replace("px","");var l=this._section_height[this.y_unit.length]+this._label_rows[this._label_rows.length-1].top;if(this.scrollHelper.getMode()==this.scrollHelper.modes.minMax&&(l>_||this.render=="tree")){a-=o()}}var n=e.$container.querySelector(".dhx_timeline_data_wrapper");if(!this.scrollable){n=e.$container.querySelector(".dhx_cal_data")}if(this.scrollable){this.scrollHelper.setScrollValue(n,a)}if(i>0){n.scrollTop=i}},i);i.getScrollPosition=e.bind(function(){return{left:this._x_scroll||0,top:this._y_scroll||0}},i);i.posFromDate=e.bind(function(t){return e._timeline_getX({start_date:t},false,this)-1},i);i.posFromSection=e.bind(function(e){var t=this.order[e];if(t===undefined){return-1}var r=0;for(var i in this.order){if(this.order[i]<t){r+=this._section_height[i]}}return r},i);i.selectEvents=e.bind(function(e){var t=e.section,r=e.date,i=e.selectNested;if(r){return l(t,r,i,this)}else if(t){return _(t,i,this)}},i);function _(t,i,a){var _=e._timeline_smart_render.getPreparedEvents(a);var l=a.order[t];var n=a.y_unit[l];if(!n){return[]}var s=[t];if(i){r(n,s)}var o=[];for(var d=0;d<s.length;d++){var l=a.order[s[d]];if(l!==undefined&&_[l]){o=o.concat(_[l])}else if(_.undefined){for(var c=0;c<_.undefined.length;c++){var h=_.undefined[c];if(h[a.y_property]==s[d]){o.push(h)}}}}return o}function l(t,r,i,a){var _=e._timeline_smart_render.getPreparedEvents(a);var l=[];var n=[];var s=a.order[t];var o=a.y_unit[s];if(!o){return[]}var d=e._get_date_index(a,r);if(_.$matrix){l=_.$matrix[s][d]||[];if(i&&_.$matrix.$tree&&_.$matrix.$tree[o.key]){n=_.$matrix.$tree[o.key][d]||[]}return l.concat(n)}else{return _[s]||[]}}function n(t,r,i){var a=e.date[i.name+"_start"](new Date(t));var _=0;var l=a;var n=i.x_step;var s=i.x_unit;while(l<r){_++;l=e.date.add(l,n,s)}return _}i.setRange=e.bind(function(t,r){var i=e.date[this.name+"_start"](new Date(t));var a=n(t,r,this);this.x_size=a;e.setCurrentView(i,this.name)},i);e.callEvent("onOptionsLoad",[i]);e[i.name+"_view"]=function(t){if(t){e._set_timeline_dates(i)}else{e._renderMatrix.apply(i,arguments)}};var s=new Date;var d=e.date.add(s,i.x_step,i.x_unit).valueOf()-s.valueOf();e["mouse_"+i.name]=function(t){var r=this._drag_event;if(this._drag_id){r=this.getEvent(this._drag_id)}if(i.scrollable&&!t.converted){t.converted=1;t.x+=-i.dx+i._x_scroll;if(e.config.rtl){var a=+e.$container.querySelector(".dhx_timeline_label_wrapper").style.height.replace("px","");var _=i._section_height[i.y_unit.length]+i._label_rows[i._label_rows.length-1].top;t.x+=e.xy.scale_width;if(i.scrollHelper.getMode()==i.scrollHelper.modes.minMax&&(_>a||i.render=="tree"))t.x+=o()}t.y+=i._y_scroll}else if(!e.config.rtl){t.x-=i.dx}else{t.x-=i.dx-e.xy.scale_width}var l=e._timeline_drag_date(i,t.x);t.x=0;t.force_redraw=true;t.custom=true;if(this._drag_mode=="move"&&this._drag_id&&this._drag_event){var r=this.getEvent(this._drag_id);var n=this._drag_event;t._ignores=this._ignores_detected||i._start_correction||i._end_correction;if(n._move_delta===undefined){n._move_delta=(r.start_date-l)/6e4;if(this.config.preserve_length&&t._ignores){n._move_delta=this._get_real_event_length(r.start_date,l,i);n._event_length=this._get_real_event_length(r.start_date,r.end_date,i)}}if(this.config.preserve_length&&t._ignores){var s=n._event_length;var d=this._get_fictional_event_length(l,n._move_delta,i,true);l=new Date(l-d)}else{l=e.date.add(l,n._move_delta,"minute")}}if(this._drag_mode=="resize"&&r){if(this.config.timeline_swap_resize&&this._drag_id){if(this._drag_from_start&&+l>+r.end_date){this._drag_from_start=false}else if(!this._drag_from_start&&+l<+r.start_date){this._drag_from_start=true}}t.resize_from_start=this._drag_from_start;if(!this.config.timeline_swap_resize&&this._drag_id){if(this._drag_from_start&&+l>=+e.date.add(r.end_date,-e.config.time_step,"minute")){l=e.date.add(r.end_date,-e.config.time_step,"minute")}}}if(i.round_position){switch(this._drag_mode){case"move":if(!this.config.preserve_length){l=e._timeline_get_rounded_date.call(i,l,false);if(i.x_unit=="day")t.custom=false}break;case"resize":if(this._drag_event){if(this._drag_event._resize_from_start===null||this._drag_event._resize_from_start===undefined){this._drag_event._resize_from_start=t.resize_from_start}t.resize_from_start=this._drag_event._resize_from_start;l=e._timeline_get_rounded_date.call(i,l,!this._drag_event._resize_from_start)}break}}this._resolve_timeline_section(i,t);if(t.section){this._update_timeline_section({pos:t,event:this.getEvent(this._drag_id),view:i})}t.y=Math.round((this._correct_shift(l,1)-this._min_date)/(1e3*60*this.config.time_step));t.shift=this.config.time_step;if(i.round_position&&this._drag_mode=="new-size"){if(l<=this._drag_start){t.shift=e.date.add(this._drag_start,i.x_step,i.x_unit)-this._drag_start}}var c=this._is_pos_changed(this._drag_pos,t);if(this._drag_pos&&c){this._drag_event._dhx_changed=true}if(!c&&!this._drag_pos.has_moved)t.force_redraw=false;return t}};e._prepare_timeline_events=function(t){var r=[];if(t.render=="cell"){r=e._timeline_trace_events.call(t)}else{var i=e.get_visible_events();var a=t.order;for(var _=0;_<i.length;_++){var l=i[_];var n=l[t.y_property];var s=t.order[n];var o=t.y_unit[s];if(t.show_unassigned&&!n){for(var d in a){if(a.hasOwnProperty(d)){s=a[d];if(!r[s])r[s]=[];var c=e._lame_copy({},l);c[t.y_property]=d;r[s].push(c);break}}}else{if(!r[s])r[s]=[];r[s].push(l)}}r.$matrix=e._timeline_trace_events.call(t)}return r};e._populate_timeline_rendered=function(t){e._rendered=[];var r=t.querySelectorAll("div[event_id]");for(var i=0;i<r.length;i++){e._rendered.push(r[i])}};e._get_timeline_event_height=function(e,t){var r=e[t.y_property];var i=t.event_dy;if(t.event_dy=="full"){if(t.section_autoheight){i=t._section_height[r]-6}else{i=t.dy-3}}if(t.resize_events){i=Math.max(Math.floor(i/(e._count||1)),t.event_min_dy)}return i};e._get_timeline_event_y=function(t,r){var i=t||0;var a=2+i*r+(i?i*2:0);if(e.config.cascade_event_display){a=2+i*e.config.cascade_event_margin+(i?i*2:0)}return a};e.render_timeline_event=function(t,r){var i=t[this.y_property];if(!i)return"";var a=t._sorder;var _=e._timeline_getX(t,false,this);var l=e._timeline_getX(t,true,this);var n=e._get_timeline_event_height(t,this);var s=n-2;if(!t._inner&&this.event_dy=="full"){s=(s+2)*(t._count-a)-2}s+=3;var o=e._get_timeline_event_y(t._sorder,n);var d=n+o+2;if(!this._events_height[i]||this._events_height[i]<d){this._events_height[i]=d}var c=e.templates.event_class(t.start_date,t.end_date,t);c="dhx_cal_event_line "+(c||"");if(e.getState().select_id==t.id){c+=" dhx_cal_event_selected"}if(t._no_drag_move){c+=" no_drag_move"}var h=t.color?"background:"+t.color+";":"";var f=t.textColor?"color:"+t.textColor+";":"";var v=e.templates.event_bar_text(t.start_date,t.end_date,t);var u="<div "+e._waiAria.eventBarAttrString(t)+" event_id='"+t.id+"' class='"+c+"' style='"+h+f+"position:absolute; top:"+o+"px; height: "+s+"px; "+(e.config.rtl?"right:":"left:")+_+"px; width:"+Math.max(0,l-_)+"px;"+(t._text_style||"")+"'>";if(e.config.drag_resize&&!e.config.readonly){var m="dhx_event_resize";var g=s+1;var p="<div class='"+m+" "+m+"_start' style='height: "+g+"px;'></div>";var x="<div class='"+m+" "+m+"_end' style='height: "+g+"px;'></div>";u+=(!t._no_resize_start?p:"")+(!t._no_resize_end?x:"")}u+=v+"</div>";if(!r)return u;else{var y=document.createElement("div");y.innerHTML=u;var w=this._scales[i];if(w){e._rendered.push(y.firstChild);w.appendChild(y.firstChild)}}};function r(e,t){t=t||[];if(e.children){for(var i=0;i<e.children.length;i++){t.push(e.children[i].key);r(e.children[i],t)}}return t}function i(e,t){var r=t.order[e];if(r===undefined){r="$_"+e}return r}function a(e,t){t[e.key]=e;if(e.children){for(var r=0;r<e.children.length;r++){a(e.children[r],t)}}}function _(e){var t={};var r=e.y_unit_original||e.y_unit;for(var i=0;i<r.length;i++){a(r[i],t)}return t}function l(t,r){var a=[];for(var l=0;l<r.y_unit.length;l++){a[l]=[]}var n;if(!a[n]){a[n]=[]}var s=_(r);var o=r.render=="tree";if(o){a.$tree={}}function d(e,t,r,i){if(!e[t]){e[t]=[]}for(var a=r;a<=i;a++){if(!e[t][a])e[t][a]=[];e[t][a].push(h)}}var c=r.y_property;for(var l=0;l<t.length;l++){var h=t[l];var f=h[c];n=i(f,r);var v=e._get_date_index(r,h.start_date);var u=e._get_date_index(r,h.end_date);if(h.end_date.valueOf()==r._trace_x[u].valueOf()){u-=1}if(!a[n]){a[n]=[]}d(a,n,v,u);var m=s[f];if(o&&m&&m.$parent){while(m.$parent){var g=s[m.$parent];d(a.$tree,g.key,v,u);m=g}}}return a}var n=function(e){var t=String(e);return t.replace(/'/g,"&apos;").replace(/"/g,"&quot;")};var s=function(e){var t=String(e);return t.replace(/'/g,"\\'").replace(/"/g,'\\"')};e._timeline_trace_events=function t(){var r=e.get_visible_events();var i=l(r,this);return i};e._timeline_getX=function t(r,i,a){var _=0;var l=a._step;var n=a.round_position;var s=0;var o=i?r.end_date:r.start_date;if(o.valueOf()>e._max_date.valueOf())o=e._max_date;var d=o-e._min_date_timeline;if(d>0){var c=e._get_date_index(a,o);if(e._ignores[c])n=true;for(var h=0;h<c;h++){_+=e._cols[h]}var f=e._timeline_get_rounded_date.apply(a,[o,false]);if(!n){d=o-f;if(a.first_hour||a.last_hour){d=d-a._start_correction;if(d<0)d=0;s=Math.round(d/l);if(s>e._cols[c])s=e._cols[c]}else{s=Math.round(d/l)}}else{if(+o>+f&&i){s=e._cols[c]}}}var v=e._border_box_events();if(i){if(d!==0&&!n){_+=s}else{_+=s-2}}else{_+=s+1}return _};e._timeline_get_rounded_date=function t(r,i){var a=e._get_date_index(this,r);var _=this._trace_x[a];if(i&&+r!=+this._trace_x[a]){_=this._trace_x[a+1]?this._trace_x[a+1]:e.date.add(this._trace_x[a],this.x_step,this.x_unit)}return new Date(_)};e._timeline_skip_ignored=function t(r){if(e._ignores_detected){var i,a,_,l;for(var n=0;n<r.length;n++){l=r[n];_=false;i=e._get_date_index(this,l.start_date);a=e._get_date_index(this,l.end_date);while(i<a){if(!e._ignores[i]){_=true;break}i++}if(!_&&i==a&&!e._ignores[a]){if(+l.end_date>+this._trace_x[a]){_=true}}if(!_){r.splice(n,1);n--}}}};e._timeline_calculate_event_positions=function(t){if(t&&this.render!="cell"){e._timeline_skip_ignored.call(this,t);t.sort(this.sort||function(e,t){if(e.start_date.valueOf()==t.start_date.valueOf())return e.id>t.id?1:-1;return e.start_date>t.start_date?1:-1});var r=[];var i=t.length;var a=-1,_=null;for(var l=0;l<i;l++){var n=t[l];n._inner=false;var s=this.round_position?e._timeline_get_rounded_date.apply(this,[n.start_date,false]):n.start_date;var o=this.round_position?e._timeline_get_rounded_date.apply(this,[n.end_date,true]):n.end_date;while(r.length){var d=r[r.length-1];if(d.end_date.valueOf()<=s.valueOf()){r.splice(r.length-1,1)}else{break}}var c=false;for(var h=0;h<r.length;h++){var f=r[h];if(f.end_date.valueOf()<=s.valueOf()){c=true;n._sorder=f._sorder;r.splice(h,1);n._inner=true;break}}if(r.length)r[r.length-1]._inner=true;if(!c){if(r.length){if(r.length<=r[r.length-1]._sorder){if(!r[r.length-1]._sorder)n._sorder=0;else for(var v=0;v<r.length;v++){var u=false;for(var m=0;m<r.length;m++){if(r[m]._sorder==v){u=true;break}}if(!u){n._sorder=v;break}}n._inner=true}else{var g=r[0]._sorder;for(var p=1;p<r.length;p++)if(r[p]._sorder>g)g=r[p]._sorder;n._sorder=g+1;if(a<n._sorder){a=n._sorder;_=n}n._inner=false}}else n._sorder=0}r.push(n);if(r.length>(r.max_count||0)){r.max_count=r.length;n._count=r.length}else{n._count=n._count?n._count:1}}for(var x=0;x<t.length;x++){t[x]._count=r.max_count;if(e._register_copy){e._register_copy(t[x])}}if(_||t[0]){e.render_timeline_event.call(this,_||t[0],false)}}};e._timeline_get_events_html=function t(r){var i="";if(r&&this.render!="cell"){for(var a=0;a<r.length;a++){i+=e.render_timeline_event.call(this,r[a],false)}}return i};e._timeline_update_events_html=function t(r){var i="";if(r&&this.render!="cell"){var a=e.getView();var _={};var l=function(e,t){return e+"_"+t};r.forEach(function(e){_[l(e.id,e[a.y_property])]=true});e._rendered.forEach(function(e){if(e.parentNode){var t=e.parentNode.getAttribute("data-section-id");if(_[l(e.getAttribute("event_id"),t)]){e.parentNode.removeChild(e)}}});for(var n=0;n<r.length;n++){i+=e.render_timeline_event.call(this,r[n],false)}}return i};function o(){var e=document.createElement("p");e.style.width="100%";e.style.height="200px";var t=document.createElement("div");t.style.position="absolute";t.style.top="0px";t.style.left="0px";t.style.visibility="hidden";t.style.width="200px";t.style.height="150px";t.style.overflow="hidden";t.appendChild(e);document.body.appendChild(t);var r=e.offsetWidth;t.style.overflow="scroll";var i=e.offsetWidth;if(r==i){i=t.clientWidth}document.body.removeChild(t);return r-i}e._timeline_get_block_stats=function(t,r){var i={};r._sch_height=t.offsetHeight;i.style_data_wrapper=(e.config.rtl?"padding-right:":"padding-left:")+r.dx+"px;";i.style_label_wrapper="width: "+r.dx+"px;";if(r.scrollable){i.style_data_wrapper+="height:"+(r._sch_height-1)+"px;";if(r.html_scroll_width===undefined)r.html_scroll_width=o();if(r._section_autowidth){r.custom_scroll_width=0}else{r.custom_scroll_width=r.html_scroll_width}i.style_label_wrapper+="height:"+(r._sch_height-1-r.custom_scroll_width)+"px;"}else{i.style_data_wrapper+="height:"+(r._sch_height-1)+"px;";i.style_label_wrapper+="height:"+(r._sch_height-1)+"px;overflow:visible;"}return i};e._timeline_get_cur_row_stats=function(t,r){var i=t._logic(t.render,t.y_unit[r],t);e._merge(i,{height:t.dy});if(t.section_autoheight){var a=t.scrollable?t._sch_height-e.xy.scroll_width:t._sch_height;if(t.y_unit.length*i.height<a){i.height=Math.max(i.height,Math.floor((a-1)/t.y_unit.length))}}t._section_height[t.y_unit[r].key]=i.height;if(!i.td_className){i.td_className="dhx_matrix_scell"+(e.templates[t.name+"_scaley_class"](t.y_unit[r].key,t.y_unit[r].label,t.y_unit[r])?" "+e.templates[t.name+"_scaley_class"](t.y_unit[r].key,t.y_unit[r].label,t.y_unit[r]):"")}if(!i.td_content){i.td_content=e.templates[t.name+"_scale_label"](t.y_unit[r].key,t.y_unit[r].label,t.y_unit[r])}e._merge(i,{tr_className:"",style_height:"height:"+i.height+"px;",style_width:"width:"+t.dx+"px;",summ_width:"width:"+t._summ+"px;",table_className:""});return i};e._timeline_get_fit_events_stats=function(e,t,r){if(e.fit_events){var i=e._events_height[e.y_unit[t].key]||0;r.height=i>r.height?i:r.height;r.style_height="height:"+r.height+"px;";r.style_line_height="line-height:"+(r.height-1)+"px;";e._section_height[e.y_unit[t].key]=r.height}r.style_height="height:"+r.height+"px;";r.style_line_height="line-height:"+(r.height-1)+"px;";e._section_height[e.y_unit[t].key]=r.height;return r};e._timeline_set_scroll_pos=function(e,t){var r=e.querySelector(".dhx_timeline_data_wrapper");r.scrollTop=t._y_scroll||0;t.scrollHelper.setScrollValue(r,t._x_scroll||0);if(t.scrollHelper.getMode()!=t.scrollHelper.modes.maxMin&&r.scrollLeft==t._summ-r.offsetWidth+t.dx)r.scrollLeft+=o()};e._timeline_save_scroll_pos=function(e,t,r,i){e._y_scroll=t||0;e._x_scroll=r||0};e._timeline_get_html_for_cell_data_row=function(e,t,r,i,a){var _="";if(a.template){_+=" "+(a.template(a.section,a.view)||"")}return"<div class='dhx_timeline_data_row"+_+"' data-section-id='"+n(i)+"' data-section-index='"+e+"' style='"+t.summ_width+t.style_height+" position:absolute; top:"+r+"px;'>"};e._timeline_get_html_for_cell_ignores=function(e){return'<div class="dhx_matrix_cell dhx_timeline_data_cell" style="'+e.style_height+e.style_line_height+';display:none"></div>'};e._timeline_get_html_for_cell=function(t,r,i,a,_,l){var n=i._trace_x[t];var s=i.y_unit[r];var o=e._cols[t];var c=d(n);var h=e.templates[i.name+"_cell_value"](a,n,s);return"<div data-col-id='"+t+"' data-col-date='"+c+"' class='dhx_matrix_cell dhx_timeline_data_cell "+e.templates[i.name+"_cell_class"](a,n,s)+"' style='width:"+o+"px;"+_.style_height+_.style_line_height+(e.config.rtl?" right:":"  left:")+l+"px;'>"+"<div style='width:auto'>"+h+"</div></div>"};e._timeline_get_html_for_bar_matrix_line=function(e,t,r,i){return"<div style='"+t.summ_width+" "+t.style_height+" position:absolute; top:"+r+"px;' data-section-id='"+n(i)+"' data-section-index='"+e+"' class='dhx_matrix_line'>"};e._timeline_get_html_for_bar_data_row=function(e,t){var r=e.table_className;if(t.template){r+=" "+(t.template(t.section,t.view)||"")}return"<div class='dhx_timeline_data_row "+r+"' style='"+e.summ_width+" "+e.style_height+"' >"};e._timeline_get_html_for_bar_ignores=function(){return""};function d(t){return e._helpers.formatDate(t)}e._timeline_get_html_for_bar=function(t,r,i,a,_,l){var n=d(i._trace_x[t]);var s=i.y_unit[r];var o="";if(i.cell_template){o=e.templates[i.name+"_cell_value"](a,i._trace_x[t],s,l)}var c="line-height:"+i._section_height[s.key]+"px;";return"<div class='dhx_matrix_cell dhx_timeline_data_cell "+e.templates[i.name+"_cell_class"](a,i._trace_x[t],s,l)+"' style='width:"+e._cols[t]+"px; "+(e.config.rtl?"right:":"left:")+_+"px;'  data-col-id='"+t+"' data-col-date='"+n+"' >"+"<div style='width:auto; height:100%;position:relative;"+c+"'>"+o+"</div></div>"};e._timeline_render_scale_header=function(t,r){var i=e.$container.querySelector(".dhx_timeline_scale_header");if(i){i.parentNode.removeChild(i)}if(!r){return}i=document.createElement("div");var a="dhx_timeline_scale_header";if(t.second_scale){a+=" dhx_timeline_second_scale"}var _=e.xy.scale_height;i.className=a;i.style.cssText=["width:"+(t.dx-1)+"px","height:"+_+"px","line-height:"+_+"px","top:"+(e.xy.nav_height+2)+"px",e.config.rtl?"right:0":"left:0"].join(";");i.innerHTML=e.locale.labels[t.name+"_scale_header"]||"";e.$container.appendChild(i)};function c(t,r){var i=t.querySelector(".dhx_timeline_data_wrapper");if(!r.scrollable){i=e.$container.querySelector(".dhx_cal_data")}return i}function h(e){return e.querySelector(".dhx_timeline_label_wrapper")}function f(){return e.$container.querySelector(".dhx_cal_data .dhx_timeline_label_col")}function v(t,r,i,a){r._is_ev_creating=false;var _=c(t,r);var l=e._els["dhx_cal_header"][0];function n(e){e=e||window.event;if(e.shiftKey)return;var t=e.deltaY||e.detail||-e.wheelDelta;t=t<0?-100:100;_.scrollTop+=t;if(e.preventDefault){e.preventDefault()}}var s=h(t);if(s){if(s.addEventListener){if("onwheel"in document){s.addEventListener("wheel",n)}else if("onmousewheel"in document){s.addEventListener("mousewheel",n)}}else{s.attachEvent("onmousewheel",n)}if(!s.$eventsAttached){s.$eventsAttached=true;var d={pageX:0,pageY:0};s.addEventListener("touchstart",function(e){var t=e;if(e.touches){t=e.touches[0]}d={pageX:t.pageX,pageY:t.pageY}});s.addEventListener("touchmove",function(e){var t=e;if(e.touches){t=e.touches[0]}var r=d.pageY-t.pageY;d={pageX:t.pageX,pageY:t.pageY};if(r){_.scrollTop+=r}if(e&&e.preventDefault)e.preventDefault()})}}var v;_.onscroll=function(n){var s=c(t,r);var d=s.scrollTop;var h=r.scrollHelper.getScrollValue(s);var u=e._timeline_smart_render.getViewPort(r.scrollHelper,0,h,d);var m=f();if(r.scrollable){m.style.top=-d+"px"}if(r.smart_rendering===false){return}if(h!==r._x_scroll||r._is_ev_creating){if(r.second_scale)e._timeline_smart_render.updateHeader(r,u,l.children[1]);else e._timeline_smart_render.updateHeader(r,u,l.children[0])}if(e.config.rtl){var g=+e.$container.querySelector(".dhx_timeline_label_wrapper").style.height.replace("px","");var p=r._section_height[r.y_unit.length]+r._label_rows[r._label_rows.length-1].top;if(r.scrollHelper.getMode()==r.scrollHelper.modes.minMax&&(p>g||r.render=="tree")){l.style.right=-1-h-o()+"px"}else l.style.right=-1-h+"px";l.style.left="unset"}else{l.style.left=-1-h+"px"}if(r._options_changed||d!==r._y_scroll||r._is_ev_creating){e._timeline_smart_render.updateLabels(r,u,m)}r._is_ev_creating=false;e._timeline_smart_render.updateGridCols(r,u);e._timeline_smart_render.updateGridRows(r,u);var x=false;if(r.render!="cell"){if(window.requestAnimationFrame){x=true;if(v){cancelAnimationFrame(v)}v=requestAnimationFrame(function(){if(r.name!==e.getState().mode){return}e._timeline_smart_render.updateEvents(r,u);v=0;r.callEvent("onScroll",[r.scrollHelper.getScrollValue(_),_.scrollTop])})}else{e._timeline_smart_render.updateEvents(r,u)}}var y=0;r._scales={};var w;if(r.render==="cell")w=s.querySelectorAll(".dhx_timeline_data_col .dhx_timeline_data_row");else w=s.querySelectorAll(".dhx_timeline_data_col .dhx_matrix_line");for(var b=0,k=w.length;b<k;b++){var E=w[b].getAttribute("data-section-id");var S=r.order[E];i[S]=a[S].height;r._scales[E]=w[b]}for(var b=0,k=i.length;b<k;b++){y+=i[b]}var T=e.$container.querySelector(".dhx_timeline_data_col");T.style.height=y+"px";var C=s.scrollTop;var M=r.scrollHelper.getScrollValue(s);var H=r._summ-e.$container.querySelector(".dhx_cal_data").offsetWidth+r.dx+r.custom_scroll_width;e._timeline_save_scroll_pos(r,C,M,H);if(!x){r.callEvent("onScroll",[M,C])}r._is_new_view=false};if(!_.$eventsAttached){_.$eventsAttached=true;var u={pageX:0,pageY:0};_.addEventListener("touchstart",function(e){var t=e;if(e.touches){t=e.touches[0]}u={pageX:t.pageX,pageY:t.pageY}});_.addEventListener("touchmove",function(t){var i=t;if(t.touches){i=t.touches[0]}var a=f();var l=u.pageX-i.pageX;var n=u.pageY-i.pageY;u={pageX:i.pageX,pageY:i.pageY};if((l||n)&&!e.getState().drag_id){var s=Math.abs(l);var o=Math.abs(n);var d=Math.sqrt(l*l+n*n);var c=s/d;var h=o/d;if(c<.42){l=0}else if(h<.42){n=0}r.scrollHelper.setScrollValue(_,r.scrollHelper.getScrollValue(_)+l);_.scrollTop+=n;if(r.scrollable&&n){a.style.top=-_.scrollTop+"px"}}if(t&&t.preventDefault)t.preventDefault();return false})}if(r.scroll_position&&r._is_new_view){r.scrollTo(r.scroll_position)}else{e._timeline_set_scroll_pos(t,r)}r._is_ev_creating=true}e._timeline_y_scale=function t(r){var i=e._timeline_get_block_stats(r,this);var a=!this.scrollable?"":" dhx_timeline_scrollable_data";var _="<div class='dhx_timeline_table_wrapper'>";var l="<div class='dhx_timeline_label_wrapper' style='"+i.style_label_wrapper+"'>"+"<div class='dhx_timeline_label_col'>";var s="<div class='dhx_timeline_data_wrapper"+a+"' style='"+i.style_data_wrapper+"'>"+"<div class='dhx_timeline_data_col'>";if(e._load_mode)e._load();e._timeline_smart_render.clearPreparedEventsCache(o);var o=e._timeline_smart_render.getPreparedEvents(this);e._timeline_smart_render.cachePreparedEvents(o);var d=0;for(var c=0;c<e._cols.length;c++)d+=e._cols[c];var h=new Date;var f=e._cols.length-e._ignores_detected;h=(e.date.add(h,this.x_step*f,this.x_unit)-h-(this._start_correction+this._end_correction)*f)/d;this._step=h;this._summ=d;var u=e._colsS.heights=[];var m=[];this._events_height={};this._section_height={};this._label_rows=[];var g=false;var p=0;var x=null;if(this.scrollable||this.smart_rendering){x=e._timeline_smart_render.getViewPort(this.scrollHelper,this._sch_height)}e._timeline_smart_render._rendered_labels_cache=[];e._timeline_smart_render._rendered_events_cache=[];var y=!!x;var w;if(!this.scrollable){w=!!this.smart_rendering&&y}else{if(this.smart_rendering===false){w=false}else{w=!!y}}var b=[];var k=0;for(var E=0;E<this.y_unit.length;E++){e._timeline_calculate_event_positions.call(this,o[E]);var S=e._timeline_get_cur_row_stats(this,E);S=e._timeline_get_fit_events_stats(this,E,S);b.push(S);k+=S.height}if(x&&k<x.scrollTop){x.scrollTop=Math.max(0,k-x.height)}for(var E=0;E<this.y_unit.length;E++){var S=b[E];var T=this.y_unit[E];var C="<div class='dhx_timeline_label_row "+S.tr_className+"' style='top:"+p+"px;"+S.style_height+S.style_line_height+"'"+"data-row-index='"+E+"'"+" data-row-id='"+n(T.key)+"'>"+"<div class='"+S.td_className+"' style='"+S.style_width+" height:"+S.height+"px;' "+e._waiAria.label(S.td_content)+">"+S.td_content+"</div></div>";if(w)this._label_rows.push({div:C,top:p,section:T});if(w){if(!e._timeline_smart_render.isInYViewPort({top:p,bottom:p+S.height},x)){g=true}}p+=S.height;if(g){g=false}else{l+=C;if(w){e._timeline_smart_render._rendered_labels_cache.push(E)}var M=e.templates[this.name+"_row_class"];var H={view:this,section:T,template:M};var D=0;if(this.render=="cell"){s+=e._timeline_get_html_for_cell_data_row(E,S,p-S.height,T.key,H);for(var L=0;L<e._cols.length;L++){if(e._ignores[L]&&!w)s+=e._timeline_get_html_for_cell_ignores(S);else{if(w&&y){if(e._timeline_smart_render.isInXViewPort({left:D,right:D+e._cols[L]},x)){s+=e._timeline_get_html_for_cell(L,E,this,o[E][L],S,D)}}else{s+=e._timeline_get_html_for_cell(L,E,this,o[E][L],S,D)}}D+=e._cols[L]}s+="</div>"}else{s+=e._timeline_get_html_for_bar_matrix_line(E,S,p-S.height,T.key);var $=o[E];if(w&&y){$=e._timeline_smart_render.getVisibleEventsForRow(this,x,o,E)}var z=e._timeline_get_events_html.call(this,$);s+=z;s+=e._timeline_get_html_for_bar_data_row(S,H);for(var L=0;L<e._cols.length;L++){if(e._ignores[L])s+=e._timeline_get_html_for_bar_ignores();else{if(w&&y){if(e._timeline_smart_render.isInXViewPort({left:D,right:D+e._cols[L]},x)){s+=e._timeline_get_html_for_bar(L,E,this,o[E],D)}}else{s+=e._timeline_get_html_for_bar(L,E,this,o[E],D)}}D+=e._cols[L]}s+="</div></div>"}}S.sectionKey=T.key;m.push(S)}_+=l+"</div></div>";_+=s+"</div></div>";_+="</div>";this._matrix=o;r.innerHTML=_;if(w){var q=e.$container.querySelector(".dhx_timeline_data_col");q.style.height=p+"px"}e._populate_timeline_rendered(r);this._scales={};var V=null;for(var c=0,O=m.length;c<O;c++){u.push(m[c].height);var N=m[c].sectionKey;e._timeline_finalize_section_add(this,N,r)}if(w){if(e._timeline_smart_render){e._timeline_smart_render._rendered_events_cache=[]}}if(w||this.scrollable){v(r,this,u,m)}};e._timeline_finalize_section_add=function(t,r,i){var a=t._scales[r]=i.querySelector(".dhx_timeline_data_col [data-section-id='"+s(r)+"']");if(a){e.callEvent("onScaleAdd",[a,r])}};e.attachEvent("onBeforeViewChange",function(t,r,i,a){if(e.matrix[i]){var _=e.matrix[i];if(_.scrollable){if(_.render=="tree"){if(t===i&&r===a){return true}}_._x_scroll=_._y_scroll=0;if(e.$container.querySelector(".dhx_timeline_scrollable_data")){e._timeline_set_scroll_pos(e._els["dhx_cal_data"][0],_)}}}return true});e._timeline_x_dates=function t(r){var i=e._min_date;var a=e._max_date;e._process_ignores(i,this.x_size,this.x_unit,this.x_step,r);var _=this.x_size+(r?e._ignores_detected:0);var l=0,n=0;while(+i<+a){this._trace_x[n]=new Date(i);if(this.x_unit=="month"&&e.date[this.x_unit+"_start"]){i=e.date[this.x_unit+"_start"](new Date(i))}i=e.date.add(i,this.x_step,this.x_unit);if(e.date[this.x_unit+"_start"]){i=e.date[this.x_unit+"_start"](i)}if(!e._ignores[n])l++;n++;if(r){if(l<this.x_size&&!(+i<+a)){a=e.date["add_"+this.name+"_private"](a,(this.x_length||this.x_size)*this.x_step)}else if(l>=this.x_size){e._max_date=i;break}}}return{total:n,displayed:l}};e._timeline_x_scale=function t(r){var i=e.xy.scale_height;var a=this._header_resized||e.xy.scale_height;e._cols=[];e._colsS={height:0};this._trace_x=[];var _=e.config.preserve_scale_length;var l=e._timeline_x_dates.call(this,_);var n=e._x-this.dx-e.xy.scroll_width;if(this.scrollable&&this.column_width>0){var s=this.column_width*l.displayed;if(s>n){n=s;this._section_autowidth=false}}var o=[this.dx];var c=e._els["dhx_cal_header"][0];c.style.width=o[0]+n+"px";var h=e._min_date_timeline=e._min_date;var f=l.displayed;var v=l.total;for(var u=0;u<v;u++){if(e._ignores[u]){e._cols[u]=0;f++}else{e._cols[u]=Math.floor(n/(f-u))}n-=e._cols[u];o[u+1]=o[u]+e._cols[u]}r.innerHTML="<div></div>";if(this.second_scale){var m=this.second_scale.x_unit;var g=[this._trace_x[0]];var p=[];var x=[this.dx,this.dx];var y=0;for(var w=0;w<this._trace_x.length;w++){var b=this._trace_x[w];var k=e._timeline_is_new_interval(m,b,g[y]);if(k){++y;g[y]=b;x[y+1]=x[y]}var E=y+1;p[y]=e._cols[w]+(p[y]||0);x[E]+=e._cols[w]}r.innerHTML="<div></div><div></div>";var S=r.firstChild;S.style.height=a+"px";var T=r.lastChild;T.style.position="relative";T.className="dhx_bottom_scale_container";for(var C=0;C<g.length;C++){var M=g[C];var H=e.templates[this.name+"_second_scalex_class"](M);var D=document.createElement("div");D.className="dhx_scale_bar dhx_second_scale_bar"+(H?" "+H:"");e.set_xy(D,p[C]-1,a-3,x[C],0);D.innerHTML=e.templates[this.name+"_second_scale_date"](M);S.appendChild(D)}}e.xy.scale_height=a;r=r.lastChild;this._h_cols={};for(var L=0;L<this._trace_x.length;L++){if(e._ignores[L])continue;h=this._trace_x[L];e._render_x_header(L,o[L],h,r);var $=e.templates[this.name+"_scalex_class"](h);if($)r.lastChild.className+=" "+$;r.lastChild.setAttribute("data-col-id",L);r.lastChild.setAttribute("data-col-date",d(h));var z=r.lastChild.cloneNode(true);this._h_cols[L]={div:z,left:o[L]}}e.xy.scale_height=i;var q=this._trace_x;r.onclick=function(t){var r=e._timeline_locate_hcell(t);if(r)e.callEvent("onXScaleClick",[r.x,q[r.x],t||event])};r.ondblclick=function(t){var r=e._timeline_locate_hcell(t);if(r)e.callEvent("onXScaleDblClick",[r.x,q[r.x],t||event])}};e._timeline_is_new_interval=function t(r,i,a){switch(r){case"hour":return i.getHours()!=a.getHours()||e._timeline_is_new_interval("day",i,a);case"day":return!(i.getDate()==a.getDate()&&i.getMonth()==a.getMonth()&&i.getFullYear()==a.getFullYear());case"week":return!(e.date.week_start(new Date(i)).valueOf()==e.date.week_start(new Date(a)).valueOf());case"month":return!(i.getMonth()==a.getMonth()&&i.getFullYear()==a.getFullYear());case"year":return!(i.getFullYear()==a.getFullYear());default:return false}};e._timeline_reset_scale_height=function t(r){if(this._header_resized&&(!r||!this.second_scale)){e.xy.scale_height/=2;this._header_resized=false;var i=e._els["dhx_cal_header"][0];i.className=i.className.replace(/ dhx_second_cal_header/gi,"")}};e._timeline_set_full_view=function t(r){e._timeline_reset_scale_height.call(this,r);if(r){if(this.second_scale&&!this._header_resized){this._header_resized=e.xy.scale_height;e.xy.scale_height*=2;e._els["dhx_cal_header"][0].className+=" dhx_second_cal_header"}e.set_sizes();e._init_matrix_tooltip();var i=e._min_date;e._timeline_x_scale.call(this,e._els["dhx_cal_header"][0]);if(e.$container.querySelector(".dhx_timeline_scrollable_data")){var a=e._timeline_smart_render.getViewPort(this.scrollHelper);var _=e._timeline_smart_render.getVisibleHeader(this,a);if(_){if(this.second_scale)e._els.dhx_cal_header[0].children[1].innerHTML=_;else e._els.dhx_cal_header[0].children[0].innerHTML=_}}e._timeline_y_scale.call(this,e._els["dhx_cal_data"][0]);e._min_date=i;var l=e._getNavDateElement();if(l){l.innerHTML=e.templates[this.name+"_date"](e._min_date,e._max_date)}if(e._mark_now){e._mark_now()}e._timeline_reset_scale_height.call(this,r)}e._timeline_render_scale_header(this,r);e._timeline_hideToolTip()};e._timeline_hideToolTip=function t(){if(e._tooltip){e._tooltip.style.display="none";e._tooltip.date=""}};e._timeline_showToolTip=function t(r,i,a){if(r.render!="cell")return;var _=i.x+"_"+i.y;var l=r._matrix[i.y][i.x];if(!l)return e._timeline_hideToolTip();l.sort(function(e,t){return e.start_date>t.start_date?1:-1});if(e._tooltip){if(e._tooltip.date==_)return;e._tooltip.innerHTML=""}else{var n=e._tooltip=document.createElement("div");n.className="dhx_year_tooltip";if(e.config.rtl)n.className+=" dhx_tooltip_rtl";document.body.appendChild(n);n.onclick=e._click.dhx_cal_data}var s="";for(var o=0;o<l.length;o++){var d=l[o].color?"background-color:"+l[o].color+";":"";var c=l[o].textColor?"color:"+l[o].textColor+";":"";s+="<div class='dhx_tooltip_line' event_id='"+l[o].id+"' style='"+d+""+c+"'>";s+="<div class='dhx_tooltip_date'>"+(l[o]._timed?e.templates.event_date(l[o].start_date):"")+"</div>";s+="<div class='dhx_event_icon icon_details'>&nbsp;</div>";s+=e.templates[r.name+"_tooltip"](l[o].start_date,l[o].end_date,l[o])+"</div>"}e._tooltip.style.display="";e._tooltip.style.top="0px";if(e.config.rtl&&a.left-e._tooltip.offsetWidth>=0||document.body.offsetWidth-i.src.offsetWidth-a.left-e._tooltip.offsetWidth<0){e._tooltip.style.left=a.left-e._tooltip.offsetWidth+"px"}else{e._tooltip.style.left=a.left+i.src.offsetWidth+"px"}e._tooltip.date=_;e._tooltip.innerHTML=s;if(document.body.offsetHeight-a.top-e._tooltip.offsetHeight<0)e._tooltip.style.top=a.top-e._tooltip.offsetHeight+i.src.offsetHeight+"px";else e._tooltip.style.top=a.top+"px"};e._matrix_tooltip_handler=function(t){var r=e.matrix[e._mode];if(!r||r.render!="cell")return;if(r){var i=e._locate_cell_timeline(t);var t=t||event;var a=t.target||t.srcElement;if(i)return e._timeline_showToolTip(r,i,e.$domHelpers.getOffset(i.src))}e._timeline_hideToolTip()};e._init_matrix_tooltip=function(){e._detachDomEvent(e._els["dhx_cal_data"][0],"mouseover",e._matrix_tooltip_handler);e.event(e._els["dhx_cal_data"][0],"mouseover",e._matrix_tooltip_handler)};e._set_timeline_dates=function(t){e._min_date=e.date[t.name+"_start"](new Date(e._date));e._max_date=e.date["add_"+t.name+"_private"](e._min_date,t.x_size*t.x_step);if(e.date[t.x_unit+"_start"]){e._max_date=e.date[t.x_unit+"_start"](e._max_date)}e._table_view=true};e._renderMatrix=function(t,r){if(!r)e._els["dhx_cal_data"][0].scrollTop=0;e._set_timeline_dates(this);e._timeline_set_full_view.call(this,t)};e._timeline_html_index=function t(r){var i=r.parentNode.childNodes;var a=-1;for(var _=0;_<i.length;_++){if(i[_]==r){a=_;break}}var l=a;if(e._ignores_detected){for(var n in e._ignores){if(e._ignores[n]&&n*1<=l)l++}}return l};e._timeline_locate_hcell=function t(r){r=r||event;var i=r.target?r.target:r.srcElement;while(i&&i.tagName!="DIV")i=i.parentNode;if(i&&i.tagName=="DIV"){var a=e._getClassName(i).split(" ")[0];if(a=="dhx_scale_bar")return{x:e._timeline_html_index(i),y:-1,src:i,scale:true}}};function u(e,t){if(e.closest){return e.closest(t)}else if(e.matches||e.msMatchesSelector||e.webkitMatchesSelector){var r=e;if(!document.documentElement.contains(r))return null;do{var i=r.matches||r.msMatchesSelector||r.webkitMatchesSelector;if(i.call(r,t))return r;r=r.parentElement||r.parentNode}while(r!==null&&r.nodeType===1);return null}else{window.console.error("Your browser is not supported");return null}}e._locate_cell_timeline=function(t){t=t||event;var r=t.target?t.target:t.srcElement;var i={};var a=e.matrix[e._mode];var _=e.getActionData(t);var l=e._ignores;var n=0;for(var s=0;s<a._trace_x.length-1;s++){if(+_.date<a._trace_x[s+1])break;if(!l[s]){n++}}i.x=n===0?0:s;i.y=a.order[_.section];var o=e._isRender("cell")?1:0;var d=0;if(a.scrollable&&a.render==="cell"){if(!a._scales[_.section]||!a._scales[_.section].querySelector(".dhx_matrix_cell"))return;var c=a._scales[_.section].querySelector(".dhx_matrix_cell");if(!c)return;var h=c.offsetLeft;if(h>0){var f=e._timeline_drag_date(a,h);for(var v=0;v<a._trace_x.length-1;v++){if(+f<a._trace_x[v+1])break}d=v}}i.src=a._scales[_.section]?a._scales[_.section].querySelectorAll(".dhx_matrix_cell")[s-d]:null;var m=false;var g=u(r,".dhx_matrix_scell");if(g){r=g;m=true}if(m){i.x=-1;i.src=r;i.scale=true}else{i.x=s}return i};var m=e._click.dhx_cal_data;e._click.dhx_marked_timespan=e._click.dhx_cal_data=function(t){var r=m.apply(this,arguments);var i=e.matrix[e._mode];if(i){var a=e._locate_cell_timeline(t);if(a){if(a.scale)e.callEvent("onYScaleClick",[a.y,i.y_unit[a.y],t||event]);else{e.callEvent("onCellClick",[a.x,a.y,i._trace_x[a.x],(i._matrix[a.y]||{})[a.x]||[],t||event]);e._timeline_set_scroll_pos(e._els["dhx_cal_data"][0],i)}}}return r};e.dblclick_dhx_matrix_cell=function(t){var r=e.matrix[e._mode];if(r){var i=e._locate_cell_timeline(t);if(i){if(i.scale)e.callEvent("onYScaleDblClick",[i.y,r.y_unit[i.y],t||event]);else e.callEvent("onCellDblClick",[i.x,i.y,r._trace_x[i.x],(r._matrix[i.y]||{})[i.x]||[],t||event])}}};var g=e.dblclick_dhx_marked_timespan||function(){};e.dblclick_dhx_marked_timespan=function(t){var r=e.matrix[e._mode];if(r)return e.dblclick_dhx_matrix_cell(t);else return g.apply(this,arguments)};e.dblclick_dhx_matrix_scell=function(t){return e.dblclick_dhx_matrix_cell(t)};e._isRender=function(t){return e.matrix[e._mode]&&e.matrix[e._mode].render==t};e.attachEvent("onCellDblClick",function(t,r,i,a,_){if(this.config.readonly||_.type=="dblclick"&&!this.config.dblclick_create)return;var l=e.matrix[e._mode];var n={};n.start_date=l._trace_x[t];n.end_date=l._trace_x[t+1]?l._trace_x[t+1]:e.date.add(l._trace_x[t],l.x_step,l.x_unit);if(l._start_correction)n.start_date=new Date(n.start_date*1+l._start_correction);if(l._end_correction)n.end_date=new Date(n.end_date-l._end_correction);n[l.y_property]=l.y_unit[r].key;e.addEventNow(n,null,_)});e.attachEvent("onBeforeDrag",function(t,r,i){return!e._isRender("cell")});e.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)});e.attachEvent("onBeforeEventChanged",function(e,t,r,i){if(e){e._move_delta=undefined}if(i){i._move_delta=undefined}return true});e._is_column_visible=function(t){var r=e.matrix[e._mode];var i=e._get_date_index(r,t);return!e._ignores[i]};var p=e._render_marked_timespan;e._render_marked_timespan=function(t,r,i,a,_){if(!e.config.display_marked_timespans)return[];if(e.matrix&&e.matrix[e._mode]){if(e._isRender("cell"))return;var l=e._lame_copy({},e.matrix[e._mode]);l.round_position=false;var n=[];var s=[];var o=[];var d=t.sections?t.sections.units||t.sections.timeline:null;if(!i){var c=l.order;if(d){if(c.hasOwnProperty(d)){s.push(d);o.push(l._scales[d])}}else{if(l._scales){for(var h in c){if(c.hasOwnProperty(h)&&l._scales[h]){s.push(h);o.push(l._scales[h])}}}}}else{o=[r];s=[i]}var a=a?new Date(a):e._min_date;var _=_?new Date(_):e._max_date;if(a.valueOf()<e._min_date.valueOf())a=new Date(e._min_date);if(_.valueOf()>e._max_date.valueOf())_=new Date(e._max_date);if(!l._trace_x)return;for(var f=0;f<l._trace_x.length;f++){if(e._is_column_visible(l._trace_x[f]))break}if(f==l._trace_x.length)return;var v=[];if(t.days>6){var u=new Date(t.days);if(e.date.date_part(new Date(a))<=+u&&+_>=+u)v.push(u)}else{v.push.apply(v,e._get_dates_by_index(t.days))}var m=t.zones;var g=e._get_css_classes_by_config(t);for(var x=0;x<s.length;x++){r=o[x];i=s[x];for(var f=0;f<v.length;f++){var y=v[f];for(var w=0;w<m.length;w+=2){var b=m[w];var k=m[w+1];var E=new Date(+y+b*60*1e3);var S=new Date(+y+k*60*1e3);E=new Date(E.valueOf()+(E.getTimezoneOffset()-y.getTimezoneOffset())*1e3*60);S=new Date(S.valueOf()+(S.getTimezoneOffset()-y.getTimezoneOffset())*1e3*60);if(!(a<S&&_>E))continue;var T=e._get_block_by_config(t);T.className=g;var C=e._timeline_getX({start_date:E},false,l)-1;var M=e._timeline_getX({start_date:S},false,l)-1;var H=Math.max(1,M-C-1);var D=l._section_height[i]-1||l.dy-1;T.style.cssText="height: "+D+"px; "+(e.config.rtl?"right: ":"left: ")+C+"px; width: "+H+"px; top: 0;";r.insertBefore(T,r.firstChild);n.push(T)}}}return n}else{return p.apply(e,[t,r,i])}};var x=e._append_mark_now;e._append_mark_now=function(t,r){if(e.matrix&&e.matrix[e._mode]){var i=e._currentDate();var a=e._get_zone_minutes(i);var _={days:+e.date.date_part(i),zones:[a,a+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return e._render_marked_timespan(_)}else{return x.apply(e,[t,r])}};var y=e._mark_timespans;e._mark_timespans=function(){if(e.matrix&&e.matrix[e.getState().mode]){var t=[];var r=e.matrix[e.getState().mode];var i=r.y_unit;for(var a=0;a<i.length;a++){var _=i[a].key;var l=r._scales[_];var n=e._on_scale_add_marker(l,_);t.push.apply(t,n)}return t}else{return y.apply(this,arguments)}};var w=e._on_scale_add_marker;e._on_scale_add_marker=function(t,r){if(e.matrix&&e.matrix[e._mode]){var i=[];var a=e._marked_timespans;if(a&&e.matrix&&e.matrix[e._mode]){var _=e._mode;var l=e._min_date;var n=e._max_date;var s=a["global"];for(var o=e.date.date_part(new Date(l));o<n;o=e.date.add(o,1,"day")){var d=+o;var c=o.getDay();var h=[];var f=s[d]||s[c];h.push.apply(h,e._get_configs_to_render(f));if(a[_]&&a[_][r]){var v=[];var u=e._get_types_to_render(a[_][r][c],a[_][r][d]);v.push.apply(v,e._get_configs_to_render(u));if(v.length)h=v}for(var m=0;m<h.length;m++){var g=h[m];var p=g.days;if(p<7){p=d;i.push.apply(i,e._render_marked_timespan(g,t,r,o,e.date.add(o,1,"day")));p=c}else{i.push.apply(i,e._render_marked_timespan(g,t,r,o,e.date.add(o,1,"day")))}}}}return i}else{return w.apply(this,arguments)}};e._resolve_timeline_section=function(e,t){var r=0;var i=0;for(r;r<this._colsS.heights.length;r++){i+=this._colsS.heights[r];if(i>t.y)break}if(!e.y_unit[r]){r=e.y_unit.length-1}if(this._drag_event&&!this._drag_event._orig_section){this._drag_event._orig_section=e.y_unit[r].key}t.fields={};if(r>=0&&e.y_unit[r]){t.section=t.fields[e.y_property]=e.y_unit[r].key}};e._update_timeline_section=function(e){var t=e.view,r=e.event,i=e.pos;if(r){if(r[t.y_property]!=i.section){var a=this._get_timeline_event_height(r,t);r._sorder=this._get_dnd_order(r._sorder,a,t._section_height[i.section])}r[t.y_property]=i.section}};e._get_date_index=function(e,t){var r=e._trace_x;var i=0,a=r.length-1;var _=t.valueOf();while(a-i>3){var l=i+Math.floor((a-i)/2);if(r[l].valueOf()>_){a=l}else{i=l}}var n=i;while(n<=a&&+t>=+r[n+1]){n++}return n};e._timeline_drag_date=function(t,r){var i=t,a={x:r};if(!i._trace_x.length){return new Date(e.getState().date)}var _=0,l=0;var n,s;for(l;l<=this._cols.length-1;l++){s=this._cols[l];_+=s;if(_>a.x){n=(a.x-(_-s))/s;n=n<0?0:n;break}}if(i.round_position){var o=1;var d=e.getState().drag_mode;if(d&&d!="move"&&d!="create"){o=.5}if(n>=o){l++}n=0}if(l===0&&this._ignores[0]){l=1;n=0;while(this._ignores[l])l++}else if(l==this._cols.length&&this._ignores[l-1]){l=this._cols.length-1;n=0;while(this._ignores[l])l--;l++}var c;if(l>=i._trace_x.length){c=e.date.add(i._trace_x[i._trace_x.length-1],i.x_step,i.x_unit);if(i._end_correction)c=new Date(c-i._end_correction)}else{var h=n*s*i._step+i._start_correction;c=new Date(+i._trace_x[l]+h)}return c};e.attachEvent("onBeforeTodayDisplayed",function(){for(var t in e.matrix){var r=e.matrix[t];r.x_start=r._original_x_start}return true});e.attachEvent("onOptionsLoad",function(){for(var t in e.matrix){var r=e.matrix[t];r.order={};e.callEvent("onOptionsLoadStart",[]);for(var t=0;t<r.y_unit.length;t++)r.order[r.y_unit[t].key]=t;e.callEvent("onOptionsLoadFinal",[]);if(e._date&&r.name==e._mode){r._options_changed=true;e.setCurrentView(e._date,e._mode);setTimeout(function(){r._options_changed=false})}}});e.attachEvent("onEventIdChange",function(){var t=e.getView();if(t&&e.matrix[t.name]){if(e._timeline_smart_render){e._timeline_smart_render.clearPreparedEventsCache();e._timeline_smart_render.getPreparedEvents(t)}}});e.attachEvent("onBeforeDrag",function(t,r,i){if(r=="resize"){var a=i.target||i.srcElement;var _=e._getClassName(a);if(_.indexOf("dhx_event_resize_end")<0){e._drag_from_start=true}else{e._drag_from_start=false}}return true});var b=10;var k=null,E=null;function S(t,r){var i=e.matrix[e._mode];var a={},_={},l=r;a.x=!!t.touches?t.touches[0].pageX:t.pageX;a.y=!!t.touches?t.touches[0].pageY:t.pageY;_.left=l.offsetLeft+i.dx;_.top=l.offsetTop;while(l){_.left+=l.offsetLeft;_.top+=l.offsetTop;l=l.offsetParent}return{x:a.x-_.left,y:a.y-_.top}}function T(t){if(k)clearInterval(k);e._schedulerOuter=e.$container.querySelector(".dhx_timeline_data_wrapper");var r={pageX:!!t.touches?t.touches[0].pageX:t.pageX,pageY:!!t.touches?t.touches[0].pageY:t.pageY};k=setInterval(function(){C(r)},b)}function C(t){if(!e.getState().drag_id){clearInterval(k);E=null;return}var r=e.matrix[e._mode];if(!r)return;var i=e._schedulerOuter;var a=S(t,i);var _=i.offsetWidth-r.dx;var l=i.offsetHeight;var n=a.x;var s=a.y;var o=r.autoscroll||{};e._merge(o,{range_x:200,range_y:100,speed_x:20,speed_y:10});var d=M(n,_,E?E.x:0,o.range_x);if(!r.scrollable){d=0}var c=M(s,l,E?E.y:0,o.range_y);if((c||d)&&!E){E={x:n,y:s};d=0;c=0}d=d*o.speed_x;c=c*o.speed_y;if(d&&c){if(Math.abs(d/5)>Math.abs(c)){c=0}else if(Math.abs(c/5)>Math.abs(d)){d=0}}if(d||c){E.started=true;H(d,c)}else{clearInterval(k)}}function M(e,t,r,i){if(e<i&&(!E||E.started||e<r)){return-1}else if(t-e<i&&(!E||E.started||e>r)){return 1}return 0}function H(t,r){var i=e._schedulerOuter;if(r){i.scrollTop+=r}if(t){i.scrollLeft+=t}}var D=e.attachEvent("onSchedulerReady",function(){if(e.matrix){e.event(document.body,"mousemove",T);e.detachEvent(D)}});e._timeline_smart_render={_prepared_events_cache:null,_rendered_events_cache:[],_rendered_header_cache:[],_rendered_labels_cache:[],_rows_to_delete:[],_rows_to_add:[],_cols_to_delete:[],_cols_to_add:[],getViewPort:function(t,r,i,a){var _=e.$container.querySelector(".dhx_cal_data");var l=_.getBoundingClientRect();var n=e.$container.querySelector(".dhx_timeline_scrollable_data");if(n&&i===undefined){i=t.getScrollValue(n)}if(a===undefined){if(n){a=n.scrollTop}else{a=_.scrollTop}}var s={};for(var o in l){s[o]=l[o]}s.scrollLeft=i||0;s.scrollTop=a||0;if(r)l.height=r;return s},isInXViewPort:function(e,t){var r=t.scrollLeft;var i=t.width+t.scrollLeft;return e.left<i+100&&e.right>r-100},isInYViewPort:function(e,t){var r=t.scrollTop;var i=t.height+t.scrollTop;return e.top<i+100&&e.bottom>r-100},getVisibleHeader:function(t,r){var i="";this._rendered_header_cache=[];for(var a in t._h_cols){var _=t._h_cols[a];if(this.isInXViewPort({left:_.left,right:_.left+e._cols[a]},r)){var l=_.div.outerHTML;i+=l;this._rendered_header_cache.push(_.div.getAttribute("data-col-id"))}}return i},updateHeader:function(t,r,i){this._cols_to_delete=[];this._cols_to_add=[];var a=e.$container.querySelectorAll(".dhx_cal_header > div");var _=a[a.length-1].querySelectorAll(".dhx_scale_bar");var l=[];for(var n=0;n<_.length;n++){l.push(_[n].getAttribute("data-col-id"))}var s=this.getVisibleHeader(t,r);if(!s)return;var o=this._rendered_header_cache.slice();var d=[];for(var n=0,c=l.length;n<c;n++){var h=o.indexOf(l[n]);if(h>-1){o.splice(h,1)}else{d.push(l[n])}}if(d.length){this._cols_to_delete=d.slice();this._deleteHeaderCells(d,t,i)}if(o.length){this._cols_to_add=o.slice();this._addHeaderCells(o,t,i)}},_deleteHeaderCells:function(e,t,r){for(var i=0;i<e.length;i++){var a=r.querySelector('[data-col-id="'+e[i]+'"]');if(a){r.removeChild(a)}}},_addHeaderCells:function(e,t,r){var i="";for(var a=0;a<e.length;a++){i+=t._h_cols[e[a]].div.outerHTML}r.insertAdjacentHTML("beforeEnd",i)},getVisibleLabels:function(e,t){if(!e._label_rows.length)return;var r="";this._rendered_labels_cache=[];for(var i=0;i<e._label_rows.length;i++){if(this.isInYViewPort({top:e._label_rows[i].top,bottom:e._label_rows[i].top+e._section_height[e.y_unit[i].key]},t)){var a=e._label_rows[i].div;r+=a;this._rendered_labels_cache.push(i)}}return r},updateLabels:function(e,t,r){this._rows_to_delete=[];this._rows_to_add=[];var i=this._rendered_labels_cache.slice();if(!i.length){this.getVisibleLabels(e,t);i=this._rendered_labels_cache.slice()}var a=this.getVisibleLabels(e,t);if(!a)return;var _=this._rendered_labels_cache.slice();var l=[];for(var n=0,s=i.length;n<s;n++){var o=_.indexOf(i[n]);if(o>-1){_.splice(o,1)}else{l.push(i[n])}}if(l.length){this._rows_to_delete=l.slice();this._deleteLabelCells(l,e,r)}if(_.length){this._rows_to_add=_.slice();this._addLabelCells(_,e,r)}},_deleteLabelCells:function(e,t,r){for(var i=0;i<e.length;i++){var a=r.querySelector('[data-row-index="'+e[i]+'"]');if(a){r.removeChild(a)}}},_addLabelCells:function(e,t,r){var i="";for(var a=0;a<e.length;a++){i+=t._label_rows[e[a]].div}r.insertAdjacentHTML("beforeEnd",i)},clearPreparedEventsCache:function(){this.cachePreparedEvents(null)},cachePreparedEvents:function(e){this._prepared_events_cache=e;this._prepared_events_coordinate_cache=e},getPreparedEvents:function(t){var r;if(this._prepared_events_cache){r=this._prepared_events_cache}else{r=e._prepare_timeline_events(t);r.$coordinates={};this.cachePreparedEvents(r)}return r},updateEvents:function(t,r){var i=this.getPreparedEvents(t);var a=this._rendered_events_cache.slice();this._rendered_events_cache=[];var _=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(!_)return;for(var l=0;l<this._rendered_labels_cache.length;l++){var n=this._rendered_labels_cache[l];var s=[];var o=a[n]?a[n].slice():[];e._timeline_calculate_event_positions.call(t,i[n]);var d=e._timeline_smart_render.getVisibleEventsForRow(t,r,i,n);for(var c=0,h=d.length;c<h;c++){var f=o.indexOf(d[c].id);if(f>-1){o.splice(f,1)}else{s.push(d[c])}}var v=_.querySelector('[data-section-index="'+n+'"]');if(o.length){this._deleteEvents(o,t,v)}if(s.length){this._addEvents(s,t,v,n)}}e._populate_timeline_rendered(e.$container);t._matrix=i},_deleteEvents:function(e,t,r){for(var i=0;i<e.length;i++){var a=r.querySelector('[event_id="'+e[i]+'"]');if(a){if(!a.classList.contains("dhx_in_move"))r.removeChild(a)}}},_addEvents:function(t,r,i,a){var _=e._timeline_update_events_html.call(r,t);i.insertAdjacentHTML("beforeEnd",_)},getVisibleEventsForRow:function(t,r,i,a){var _=[];if(t.render=="cell"){_=i}else{var l=i[a];if(l){for(var n=0,s=l.length;n<s;n++){var o=l[n];var d=a+"_"+o.id;var c,h;if(i.$coordinates&&i.$coordinates[d]){c=i.$coordinates[d].xStart;h=i.$coordinates[d].xEnd}else{c=e._timeline_getX(o,false,t);h=e._timeline_getX(o,true,t);if(i.$coordinates){i.$coordinates[d]={xStart:c,xEnd:h}}}if(e._timeline_smart_render.isInXViewPort({left:c,right:h},r)){_.push(o);if(!this._rendered_events_cache[a])this._rendered_events_cache[a]=[];this._rendered_events_cache[a].push(o.id)}}}}return _},getVisibleRowCellsHTML:function(t,r,i,a,_){var l="";var n;var s=this._rendered_header_cache;for(var o=0;o<s.length;o++){var d=s[o];n=t._h_cols[d].left-t.dx;if(e._ignores[d]){if(t.render=="cell"){l+=e._timeline_get_html_for_cell_ignores(i)}else{l+=e._timeline_get_html_for_bar_ignores()}}else{if(t.render=="cell"){l+=e._timeline_get_html_for_cell(d,_,t,a[_][d],i,n)}else{l+=e._timeline_get_html_for_bar(d,_,t,a[_],n)}}}return l},getVisibleTimelineRowsHTML:function(t,r,i,a){var _="";var l=e._timeline_get_cur_row_stats(t,a);l=e._timeline_get_fit_events_stats(t,a,l);var n=t._label_rows[a];var s=e.templates[t.name+"_row_class"];var o={view:t,section:n.section,template:s};if(t.render=="cell"){_+=e._timeline_get_html_for_cell_data_row(a,l,n.top,n.section.key,o);_+=this.getVisibleRowCellsHTML(t,r,l,i,a);_+="</div>"}else{_+=e._timeline_get_html_for_bar_matrix_line(a,l,n.top,n.section.key,o);_+=e._timeline_get_html_for_bar_data_row(l,o);_+=this.getVisibleRowCellsHTML(t,r,l,i,a);_+="</div></div>"}return _},updateGridRows:function(e,t){if(this._rows_to_delete.length){this._deleteGridRows(this._rows_to_delete)}if(this._rows_to_add.length){this._addGridRows(this._rows_to_add,e,t)}},_deleteGridRows:function(t){var r=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(!r)return;for(var i=0;i<t.length;i++){var a=r.querySelector('[data-section-index="'+t[i]+'"]');r.removeChild(a)}this._rows_to_delete=[]},_addGridRows:function(t,r,i){var a=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(!a)return;var _=this.getPreparedEvents(r);var l="";var n=[];for(var s=0;s<t.length;s++){l+=this.getVisibleTimelineRowsHTML(r,i,_,t[s])}a.insertAdjacentHTML("beforeEnd",l);for(var s=0;s<t.length;s++){e._timeline_finalize_section_add(r,r.y_unit[t[s]].key,a)}if(e._mark_now){e._mark_now()}this._rows_to_add=[]},updateGridCols:function(t,r){var i=this._rendered_header_cache;var a={};var _={};for(var l=0;l<i.length;l++){_[i[l]]=true}var n=e.$container.querySelector(".dhx_timeline_data_row");if(n){var s=n.querySelectorAll("[data-col-id]");for(var l=0;l<s.length;l++){a[s[l].getAttribute("data-col-id")]=true}}var o=[],d=[];for(var l in a){if(!_[l]){o.push(l)}}for(var l in _){if(!a[l]){d.push(l)}}if(o.length){this._deleteGridCols(o,t)}if(d.length){this._addGridCols(d,t,r)}},_deleteGridCols:function(t,r){var i=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(!i)return;for(var a=0;a<this._rendered_labels_cache.length;a++){var _;if(r.render=="cell"){_=i.querySelector('[data-section-index="'+this._rendered_labels_cache[a]+'"]')}else{_=i.querySelector('[data-section-index="'+this._rendered_labels_cache[a]+'"] .dhx_timeline_data_row ')}if(_){for(var l=0;l<t.length;l++){var n=_.querySelector('[data-col-id="'+t[l]+'"]');if(n)_.removeChild(n)}}}this._cols_to_delete=[]},_addGridCols:function(t,r,i){var a=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(!a)return;var _=this.getPreparedEvents(r);for(var l=0;l<this._rendered_labels_cache.length;l++){var n=this._rendered_labels_cache[l];var s="";var o=e._timeline_get_cur_row_stats(r,n);o=e._timeline_get_fit_events_stats(r,n,o);var d;if(r.render=="cell"){d=a.querySelector('[data-section-index="'+n+'"]')}else{d=a.querySelector('[data-section-index="'+n+'"] .dhx_timeline_data_row')}if(d){for(var c=0;c<t.length;c++){var h=d.querySelector('[data-col-id="'+t[c]+'"]');if(!h){var f=this.getVisibleGridCell(r,i,o,_,n,t[c]);if(f)s+=f}}d.insertAdjacentHTML("beforeEnd",s)}}this._cols_to_add=[]},getVisibleGridCell:function(t,r,i,a,_,l){if(!t._h_cols[l])return;var n="";var s=t._h_cols[l].left-t.dx;if(t.render=="cell"){if(e._ignores[l]){}else{n+=e._timeline_get_html_for_cell(l,_,t,a[_][l],i,s)}}else{if(e._ignores[l]){}else{n+=e._timeline_get_html_for_bar(l,_,t,a[_],s)}}return n}}};e._temp_matrix_scope()});