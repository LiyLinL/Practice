/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.xy.map_date_width=188;e.xy.map_icon_width=25;e.xy.map_description_width=400;e.config.map_resolve_event_location=true;e.config.map_resolve_user_location=true;e.config.map_initial_position=new google.maps.LatLng(48.724,8.215);e.config.map_error_position=new google.maps.LatLng(15,15);e.config.map_infowindow_max_width=300;e.config.map_type=google.maps.MapTypeId.ROADMAP;e.config.map_zoom_after_resolve=15;e.locale.labels.marker_geo_success="It seems you are here.";e.locale.labels.marker_geo_fail="Sorry, could not get your current position using geolocation.";e.templates.marker_date=e.date.date_to_str("%Y-%m-%d %H:%i");e.templates.marker_text=function(t,a,n){return"<div><b>"+n.text+"</b><br/><br/>"+(n.event_location||"")+"<br/><br/>"+e.templates.marker_date(t)+" - "+e.templates.marker_date(a)+"</div>"};e.dblclick_dhx_map_area=function(){if(!this.config.readonly&&this.config.dblclick_create)this.addEventNow({start_date:e._date,end_date:e.date.add(e._date,e.config.time_step,"minute")})};e.templates.map_time=function(t,a,n){if(e.config.rtl&&!n._timed){return e.templates.day_date(a)+" &ndash; "+e.templates.day_date(t)}else if(n._timed){return this.day_date(n.start_date,n.end_date,n)+" "+this.event_date(t)}else{return e.templates.day_date(t)+" &ndash; "+e.templates.day_date(a)}};e.templates.map_text=function(e,t,a){return a.text};e.date.map_start=function(e){return e};e.date.add_map=function(e,t,a){return new Date(e.valueOf())};e.templates.map_date=function(e,t,a){return""};e._latLngUpdate=false;e.attachEvent("onSchedulerReady",function(){e._isMapPositionSet=false;var t=document.createElement("div");t.className="dhx_map";t.id="dhx_gmap";t.style.dispay="none";var a=e._obj;a.appendChild(t);e._els.dhx_gmap=[];e._els.dhx_gmap.push(t);s("dhx_gmap");var n={zoom:e.config.map_inital_zoom||10,center:e.config.map_initial_position,mapTypeId:e.config.map_type||google.maps.MapTypeId.ROADMAP};var i=new google.maps.Map(document.getElementById("dhx_gmap"),n);i.disableDefaultUI=false;i.disableDoubleClickZoom=!e.config.readonly;google.maps.event.addListener(i,"dblclick",function(t){if(!e.config.readonly&&e.config.dblclick_create){var a=t.latLng;geocoder.geocode({latLng:a},function(t,n){if(n==google.maps.GeocoderStatus.OK){a=t[0].geometry.location;e.addEventNow({lat:a.lat(),lng:a.lng(),event_location:t[0].formatted_address,start_date:e._date,end_date:e.date.add(e._date,e.config.time_step,"minute")})}})}});var _={content:""};if(e.config.map_infowindow_max_width){_.maxWidth=e.config.map_infowindow_max_width}e.map={_points:[],_markers:[],_infowindow:new google.maps.InfoWindow(_),_infowindows_content:[],_initialization_count:-1,_obj:i};geocoder=new google.maps.Geocoder;if(e.config.map_resolve_user_location){if(navigator.geolocation){if(!e._isMapPositionSet){navigator.geolocation.getCurrentPosition(function(t){var a=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);i.setCenter(a);i.setZoom(e.config.map_zoom_after_resolve||10);e.map._infowindow.setContent(e.locale.labels.marker_geo_success);e.map._infowindow.position=i.getCenter();e.map._infowindow.open(i);e._isMapPositionSet=true},function(){e.map._infowindow.setContent(e.locale.labels.marker_geo_fail);e.map._infowindow.setPosition(i.getCenter());e.map._infowindow.open(i);e._isMapPositionSet=true})}}}google.maps.event.addListener(i,"resize",function(e){t.style.zIndex="5";i.setZoom(i.getZoom())});google.maps.event.addListener(i,"tilesloaded",function(e){t.style.zIndex="5"});t.style.display="none";var o=e.render_data;e.render_data=function(t,a){if(this._mode=="map"){l();var n=e.get_visible_events();for(var i=0;i<n.length;i++){if(!e.map._markers[n[i].id]){p(n[i],false,false)}}}else return o.apply(this,arguments)};function d(t){if(t){var a=e.locale.labels;e._els["dhx_cal_header"][0].innerHTML="<div class='dhx_map_line' style='width: "+(e.xy.map_date_width+e.xy.map_description_width+2)+"px;' ><div class='headline_date' style='width: "+e.xy.map_date_width+"px;'>"+a.date+"</div><div class='headline_description' style='width: "+e.xy.map_description_width+"px;'>"+a.description+"</div></div>";e._table_view=true;e.set_sizes()}}function r(){e._selected_event_id=null;e.map._infowindow.close();var t=e.map._markers;for(var a in t){if(t.hasOwnProperty(a)){t[a].setMap(null);delete e.map._markers[a];if(e.map._infowindows_content[a])delete e.map._infowindows_content[a]}}}function l(){var t=e.get_visible_events();t.sort(function(e,t){if(e.start_date.valueOf()==t.start_date.valueOf())return e.id>t.id?1:-1;return e.start_date>t.start_date?1:-1});var a=e._waiAria.mapAttrString();var n="<div "+a+" class='dhx_map_area'>";for(var i=0;i<t.length;i++){var _=t[i];var o=_.id==e._selected_event_id?"dhx_map_line highlight":"dhx_map_line";var d=_.color?"background:"+_.color+";":"";var r=_.textColor?"color:"+_.textColor+";":"";var a=e._waiAria.mapRowAttrString(_);var l=e._waiAria.mapDetailsBtnString();n+="<div "+a+" class='"+o+"' event_id='"+_.id+"' style='"+d+""+r+""+(_._text_style||"")+" width: "+(e.xy.map_date_width+e.xy.map_description_width+2)+"px;'><div class='dhx_map_event_time' style='width: "+e.xy.map_date_width+"px;' >"+e.templates.map_time(_.start_date,_.end_date,_)+"</div>";n+="<div "+l+" class='dhx_event_icon icon_details'>&nbsp;</div>";n+="<div class='line_description' style='width:"+(e.xy.map_description_width-e.xy.map_icon_width)+"px;'>"+e.templates.map_text(_.start_date,_.end_date,_)+"</div></div>"}n+="<div class='dhx_v_border' style="+(e.config.rtl?"'right: ":"'left: ")+(e.xy.map_date_width-2)+"px;'></div><div class='dhx_v_border_description'></div></div>";e._els["dhx_cal_data"][0].scrollTop=0;e._els["dhx_cal_data"][0].innerHTML=n;e._els["dhx_cal_data"][0].style.width=e.xy.map_date_width+e.xy.map_description_width+1+"px";var s=e._els["dhx_cal_data"][0].firstChild.childNodes;var m=e._getNavDateElement();if(m){m.innerHTML=e.templates[e._mode+"_date"](e._min_date,e._max_date,e._mode)}e._rendered=[];for(var i=0;i<s.length-2;i++){e._rendered[i]=s[i]}}function s(t){var a=document.getElementById(t);var n=e._y-e.xy.nav_height;if(n<0)n=0;var i=e._x-e.xy.map_date_width-e.xy.map_description_width-1;if(i<0)i=0;a.style.height=n+"px";a.style.width=i+"px";if(e.config.rtl){a.style.marginRight=e.xy.map_date_width+e.xy.map_description_width+1+"px"}else{a.style.marginLeft=e.xy.map_date_width+e.xy.map_description_width+1+"px"}a.style.marginTop=e.xy.nav_height+2+"px"}e.map_view=function(t){e.map._initialization_count++;var a=e._els.dhx_gmap[0];var n;e._els.dhx_cal_data[0].style.width=e.xy.map_date_width+e.xy.map_description_width+1+"px";e._min_date=e.config.map_start||e._currentDate();e._max_date=e.config.map_end||e.date.add(e._currentDate(),1,"year");e._table_view=true;d(t);if(t){r();l();a.style.display="block";s("dhx_gmap");n=e.map._obj.getCenter();var i=e.get_visible_events();for(var _=0;_<i.length;_++){if(!e.map._markers[i[_].id]){p(i[_])}}}else{a.style.display="none"}google.maps.event.trigger(e.map._obj,"resize");if(e.map._initialization_count===0&&n){e.map._obj.setCenter(n)}if(e._selected_event_id){m(e._selected_event_id)}};var m=function(t){e.map._obj.setCenter(e.map._points[t]);e.callEvent("onClick",[t])};var p=function(t,a,n){var i=e.config.map_error_position;if(t.lat&&t.lng){i=new google.maps.LatLng(t.lat,t.lng)}var _=e.templates.marker_text(t.start_date,t.end_date,t);if(!e._new_event){e.map._infowindows_content[t.id]=_;if(e.map._markers[t.id])e.map._markers[t.id].setMap(null);e.map._markers[t.id]=new google.maps.Marker({position:i,map:e.map._obj});google.maps.event.addListener(e.map._markers[t.id],"click",function(){e.map._infowindow.setContent(e.map._infowindows_content[t.id]);e.map._infowindow.open(e.map._obj,e.map._markers[t.id]);e._selected_event_id=t.id;e.render_data()});e.map._points[t.id]=i;if(a)e.map._obj.setCenter(e.map._points[t.id]);if(n)e.callEvent("onClick",[t.id])}};e.attachEvent("onClick",function(t,a){if(this._mode=="map"){e._selected_event_id=t;for(var n=0;n<e._rendered.length;n++){e._rendered[n].className="dhx_map_line";if(e._rendered[n].getAttribute("event_id")==t){e._rendered[n].className+=" highlight"}}if(e.map._points[t]&&e.map._markers[t]){e.map._obj.setCenter(e.map._points[t]);google.maps.event.trigger(e.map._markers[t],"click")}}return true});var c=function(t){if(t.event_location&&geocoder){geocoder.geocode({address:t.event_location,language:e.uid().toString()},function(a,n){var i={};if(n!=google.maps.GeocoderStatus.OK){i=e.callEvent("onLocationError",[t.id]);if(!i||i===true)i=e.config.map_error_position}else{i=a[0].geometry.location}t.lat=i.lat();t.lng=i.lng();e._selected_event_id=t.id;e._latLngUpdate=true;e.callEvent("onEventChanged",[t.id,t]);p(t,true,true)})}else{p(t,true,true)}};var f=function(t){if(t.event_location&&geocoder){geocoder.geocode({address:t.event_location,language:e.uid().toString()},function(a,n){var i={};if(n!=google.maps.GeocoderStatus.OK){i=e.callEvent("onLocationError",[t.id]);if(!i||i===true)i=e.config.map_error_position}else{i=a[0].geometry.location}t.lat=i.lat();t.lng=i.lng();e._latLngUpdate=true;e.callEvent("onEventChanged",[t.id,t])})}};var g=function(e,t,a,n){setTimeout(function(){var n=e.apply(t,a);e=t=a=null;return n},n||1)};e.attachEvent("onEventChanged",function(t,a){if(!this._latLngUpdate){var n=e.getEvent(t);if(n.start_date<e._min_date&&n.end_date>e._min_date||n.start_date<e._max_date&&n.end_date>e._max_date||n.start_date.valueOf()>=e._min_date&&n.end_date.valueOf()<=e._max_date){if(e.map._markers[t])e.map._markers[t].setMap(null);c(n)}else{e._selected_event_id=null;e.map._infowindow.close();if(e.map._markers[t])e.map._markers[t].setMap(null)}}else this._latLngUpdate=false;return true});e.attachEvent("onEventIdChange",function(t,a){var n=e.getEvent(a);if(n.start_date<e._min_date&&n.end_date>e._min_date||n.start_date<e._max_date&&n.end_date>e._max_date||n.start_date.valueOf()>=e._min_date&&n.end_date.valueOf()<=e._max_date){if(e.map._markers[t]){e.map._markers[t].setMap(null);delete e.map._markers[t]}if(e.map._infowindows_content[t])delete e.map._infowindows_content[t];c(n)}return true});e.attachEvent("onEventAdded",function(t,a){if(!e._dataprocessor){if(a.start_date<e._min_date&&a.end_date>e._min_date||a.start_date<e._max_date&&a.end_date>e._max_date||a.start_date.valueOf()>=e._min_date&&a.end_date.valueOf()<=e._max_date){if(e.map._markers[t])e.map._markers[t].setMap(null);c(a)}}return true});e.attachEvent("onBeforeEventDelete",function(t,a){if(e.map._markers[t]){e.map._markers[t].setMap(null)}e._selected_event_id=null;e.map._infowindow.close();return true});e._event_resolve_delay=1500;e.attachEvent("onEventLoading",function(t){if(e.config.map_resolve_event_location&&t.event_location&&!t.lat&&!t.lng){e._event_resolve_delay+=1500;g(f,this,[t],e._event_resolve_delay)}return true});e.attachEvent("onEventCancel",function(t,a){if(a){if(e.map._markers[t])e.map._markers[t].setMap(null);e.map._infowindow.close()}return true})})});