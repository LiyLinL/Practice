/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.attachEvent("onTemplatesReady",function(){this.layers.sort(function(e,t){return e.zIndex-t.zIndex});e._dp_init=function(t){t._methods=["_set_event_text_style","","changeEventId","deleteEvent"];this.attachEvent("onEventAdded",function(e){if(!this._loading&&this.validId(e)&&this.getEvent(e)&&this.getEvent(e).layer==t.layer)t.setUpdated(e,true,"inserted")});this.attachEvent("onBeforeEventDelete",function(e){if(this.getEvent(e)&&this.getEvent(e).layer==t.layer){if(!this.validId(e))return;var a=t.getState(e);if(a=="inserted"||this._new_event){t.setUpdated(e,false);return true}if(a=="deleted")return false;if(a=="true_deleted")return true;t.setUpdated(e,true,"deleted");return false}else return true});this.attachEvent("onEventChanged",function(e){if(!this._loading&&this.validId(e)&&this.getEvent(e)&&this.getEvent(e).layer==t.layer)t.setUpdated(e,true,"updated")});t._getRowData=function(e,t){var a=this.obj.getEvent(e);var i={};for(var s in a){if(s.indexOf("_")===0)continue;if(a[s]&&a[s].getUTCFullYear)i[s]=this.obj._helpers.formatDate(a[s]);else i[s]=a[s]}return i};t._clearUpdateFlag=function(){};t.attachEvent("insertCallback",e._update_callback);t.attachEvent("updateCallback",e._update_callback);t.attachEvent("deleteCallback",function(e,t){this.obj.setUserData(t,this.action_param,"true_deleted");this.obj.deleteEvent(t)})};(function(){var t=function(e){if(e===null||typeof e!="object")return e;var a=new e.constructor;for(var i in e)a[i]=t(e[i]);return a};e._dataprocessors=[];e._layers_zindex={};for(var a=0;a<e.layers.length;a++){e.config["lightbox_"+e.layers[a].name]={};e.config["lightbox_"+e.layers[a].name].sections=t(e.config.lightbox.sections);e._layers_zindex[e.layers[a].name]=e.config.inital_layer_zindex||5+a*3;if(e.layers[a].url){var i=new dataProcessor(e.layers[a].url);i.layer=e.layers[a].name;e._dataprocessors.push(i);e._dataprocessors[a].init(e)}if(e.layers[a].isDefault)e.defaultLayer=e.layers[a].name}})();e.showLayer=function(e){this.toggleLayer(e,true)};e.hideLayer=function(e){this.toggleLayer(e,false)};e.toggleLayer=function(e,t){var a=this.getLayer(e);if(typeof t!="undefined")a.visible=!!t;else a.visible=!a.visible;this.setCurrentView(this._date,this._mode)};e.getLayer=function(t){var a,i;if(typeof t=="string")i=t;if(typeof t=="object")i=t.layer;for(var s=0;s<e.layers.length;s++){if(e.layers[s].name==i)a=e.layers[s]}return a};e.attachEvent("onBeforeLightbox",function(t){var a=this.getEvent(t);this.config.lightbox.sections=this.config["lightbox_"+a.layer].sections;e.resetLightbox();return true});e.attachEvent("onClick",function(t,a){var i=e.getEvent(t);return!e.getLayer(i.layer).noMenu});e.attachEvent("onEventCollision",function(t,a){var i=this.getLayer(t);if(!i.checkCollision)return false;var s=0;for(var r=0;r<a.length;r++){if(a[r].layer==i.name&&a[r].id!=t.id)s++}return s>=e.config.collision_limit});e.addEvent=function(t,a,i,s,r){var n=t;if(arguments.length!=1){n=r||{};n.start_date=t;n.end_date=a;n.text=i;n.id=s;n.layer=this.defaultLayer}n.id=n.id||e.uid();n.text=n.text||"";if(typeof n.start_date=="string")n.start_date=this.templates.api_date(n.start_date);if(typeof n.end_date=="string")n.end_date=this.templates.api_date(n.end_date);n._timed=this.isOneDayEvent(n);var d=!this._events[n.id];this._events[n.id]=n;this.event_updated(n);if(!this._loading)this.callEvent(d?"onEventAdded":"onEventChanged",[n.id,n])};this._evs_layer={};for(var t=0;t<this.layers.length;t++){this._evs_layer[this.layers[t].name]=[]}e.addEventNow=function(t,a,i){var s={};if(typeof t=="object"){s=t;t=null}var r=(this.config.event_duration||this.config.time_step)*6e4;if(!t)t=Math.round(e._currentDate().valueOf()/r)*r;var n=new Date(t);if(!a){var d=this.config.first_hour;if(d>n.getHours()){n.setHours(d);t=n.valueOf()}a=t+r}s.start_date=s.start_date||n;s.end_date=s.end_date||new Date(a);s.text=s.text||this.locale.labels.new_event;s.id=this._drag_id=this.uid();s.layer=this.defaultLayer;this._drag_mode="new-size";this._loading=true;this.addEvent(s);this.callEvent("onEventCreated",[this._drag_id,i]);this._loading=false;this._drag_event={};this._on_mouse_up(i)};e._t_render_view_data=function(e){if(this.config.multi_day&&!this._table_view){var t=[];var a=[];for(var i=0;i<e.length;i++){if(e[i]._timed)t.push(e[i]);else a.push(e[i])}this._table_view=true;this.render_data(a);this._table_view=false;this.render_data(t)}else this.render_data(e)};e.render_view_data=function(){if(this._not_render){this._render_wait=true;return}this._render_wait=false;this.clear_view();this._evs_layer={};for(var e=0;e<this.layers.length;e++){this._evs_layer[this.layers[e].name]=[]}var t=this.get_visible_events();for(var e=0;e<t.length;e++){if(this._evs_layer[t[e].layer])this._evs_layer[t[e].layer].push(t[e])}if(this._mode=="month"){var a=[];for(var e=0;e<this.layers.length;e++){if(this.layers[e].visible)a=a.concat(this._evs_layer[this.layers[e].name])}this._t_render_view_data(a)}else{for(var e=0;e<this.layers.length;e++){if(this.layers[e].visible){var i=this._evs_layer[this.layers[e].name];this._t_render_view_data(i)}}}};e._render_v_bar=function(t,a,i,s,r,n,d,_,l){var h=t.id;if(d.indexOf("<div class=")==-1)d=e.templates["event_header_"+t.layer]?e.templates["event_header_"+t.layer](t.start_date,t.end_date,t):d;if(_.indexOf("<div class=")==-1)_=e.templates["event_text_"+t.layer]?e.templates["event_text_"+t.layer](t.start_date,t.end_date,t):_;var o=document.createElement("div");var v="dhx_cal_event";var f=e.templates["event_class_"+t.layer]?e.templates["event_class_"+t.layer](t.start_date,t.end_date,t):e.templates.event_class(t.start_date,t.end_date,t);if(f)v=v+" "+f;var c=e._border_box_events();var u=s-2;var y=c?u:s-4,p=c?u:s-6,g=c?u:s-(this._quirks?4:14),x=c?u-2:s-8;var m=c?r-this.xy.event_header_height:r-(this._quirks?20:30)+1;var b='<div event_id="'+h+'" class="'+v+'" style="position:absolute; top:'+i+"px; left:"+a+"px; width:"+y+"px; height:"+r+"px;"+(n||"")+'">';b+='<div class="dhx_header" style=" width:'+p+'px;" >&nbsp;</div>';b+='<div class="dhx_title">'+d+"</div>";b+='<div class="dhx_body" style=" width:'+g+"px; height:"+m+'px;">'+_+"</div>";b+='<div class="dhx_footer" style=" width:'+x+"px;"+(l?" margin-top:-1px;":"")+'" ></div></div>';o.innerHTML=b;o.style.zIndex=100;return o.firstChild};e.render_event_bar=function(t){var a=this._els["dhx_cal_data"][0];var i=this._colsS[t._sday];var s=this._colsS[t._eday];if(s==i)s=this._colsS[t._eday+1];var r=this.xy.bar_height;var n=this._colsS.heights[t._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+t._sorder*r;var d=document.createElement("div");var _=t._timed?"dhx_cal_event_clear":"dhx_cal_event_line";var l=e.templates["event_class_"+t.layer]?e.templates["event_class_"+t.layer](t.start_date,t.end_date,t):e.templates.event_class(t.start_date,t.end_date,t);if(l)_=_+" "+l;var h='<div event_id="'+t.id+'" class="'+_+'" style="position:absolute; top:'+n+"px; left:"+i+"px; width:"+(s-i-15)+"px;"+(t._text_style||"")+'">';if(t._timed)h+=e.templates["event_bar_date_"+t.layer]?e.templates["event_bar_date_"+t.layer](t.start_date,t.end_date,t):e.templates.event_bar_date(t.start_date,t.end_date,t);h+=e.templates["event_bar_text_"+t.layer]?e.templates["event_bar_text_"+t.layer](t.start_date,t.end_date,t):e.templates.event_bar_text(t.start_date,t.end_date,t)+"</div>)";h+="</div>";d.innerHTML=h;this._rendered.push(d.firstChild);a.appendChild(d.firstChild)};e.render_event=function(t){var a=e.xy.menu_width;if(e.getLayer(t.layer).noMenu)a=0;if(t._sday<0)return;var i=e.locate_holder(t._sday);if(!i)return;var s=t.start_date.getHours()*60+t.start_date.getMinutes();var r=t.end_date.getHours()*60+t.end_date.getMinutes()||e.config.last_hour*60;var n=Math.round((s*60*1e3-this.config.first_hour*60*60*1e3)*this.config.hour_size_px/(60*60*1e3))%(this.config.hour_size_px*24)+1;var d=Math.max(e.xy.min_event_height,(r-s)*this.config.hour_size_px/60)+1;var _=Math.floor((i.clientWidth-a)/t._count);var l=t._sorder*_+1;if(!t._inner)_=_*(t._count-t._sorder);var h=this._render_v_bar(t.id,a+l,n,_,d,t._text_style,e.templates.event_header(t.start_date,t.end_date,t),e.templates.event_text(t.start_date,t.end_date,t));this._rendered.push(h);i.appendChild(h);l=l+parseInt(i.style.left,10)+a;n+=this._dy_shift;h.style.zIndex=this._layers_zindex[t.layer];if(this._edit_id==t.id){h.style.zIndex=parseInt(h.style.zIndex)+1;var o=h.style.zIndex;_=Math.max(_-4,e.xy.editor_width);var h=document.createElement("div");h.setAttribute("event_id",t.id);this.set_xy(h,_,d-20,l,n+14);h.className="dhx_cal_editor";h.style.zIndex=o;var v=document.createElement("div");this.set_xy(v,_-6,d-26);v.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;";v.style.zIndex=o;h.appendChild(v);this._els["dhx_cal_data"][0].appendChild(h);this._rendered.push(h);v.innerHTML="<textarea class='dhx_cal_editor'>"+t.text+"</textarea>";if(this._quirks7)v.firstChild.style.height=d-12+"px";this._editor=v.firstChild;this._editor.onkeypress=function(t){if((t||event).shiftKey)return true;var a=(t||event).keyCode;if(a==e.keys.edit_save)e.editStop(true);if(a==e.keys.edit_cancel)e.editStop(false)};this._editor.onselectstart=function(e){(e||event).cancelBubble=true;return true};v.firstChild.focus();this._els["dhx_cal_data"][0].scrollLeft=0;v.firstChild.select()}if(this._select_id==t.id){h.style.zIndex=parseInt(h.style.zIndex)+1;var f=this.config["icons_"+(this._edit_id==t.id?"edit":"select")];var c="";for(var u=0;u<f.length;u++)c+="<div class='dhx_menu_icon "+f[u]+"' title='"+this.locale.labels[f[u]]+"'></div>";var y=this._render_v_bar(t.id,l-a+1,n,a,f.length*20+26,"","<div class='dhx_menu_head'></div>",c,true);y.style.left=l-a+1;y.style.zIndex=h.style.zIndex;this._els["dhx_cal_data"][0].appendChild(y);this._rendered.push(y)}};e.filter_agenda=function(t,a){var i=e.getLayer(a.layer);return i&&i.visible}})});