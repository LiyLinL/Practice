/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
(function(){function e(e){e.config.key_nav=true;e.config.key_nav_step=30;e.addShortcut=function(e,a,i){var n=t(i);if(n){n.prototype.bind(e,a)}};e.getShortcutHandler=function(a,i){var n=t(i);if(n){var r=e.$keyboardNavigation.shortcuts.parse(a);if(r.length){return n.prototype.findHandler(r[0])}}};e.removeShortcut=function(e,a){var i=t(a);if(i){i.prototype.unbind(e)}};e.focus=function(){if(!e.config.key_nav){return}var t=e.$keyboardNavigation.dispatcher;t.enable();var a=t.getActiveNode();if(!a||a instanceof e.$keyboardNavigation.MinicalButton||a instanceof e.$keyboardNavigation.MinicalCell){t.setDefaultNode()}else{t.focusNode(t.getActiveNode())}};function t(t){var a={minicalButton:e.$keyboardNavigation.MinicalButton,minicalDate:e.$keyboardNavigation.MinicalCell,scheduler:e.$keyboardNavigation.SchedulerNode,dataArea:e.$keyboardNavigation.DataArea,timeSlot:e.$keyboardNavigation.TimeSlot,event:e.$keyboardNavigation.Event};var i={};for(var n in a)i[n.toLowerCase()]=a[n];t=(t+"").toLowerCase();return i[t]||a.scheduler}e.$keyboardNavigation={};e._compose=function(){var e=Array.prototype.slice.call(arguments,0);var t={};for(var a=0;a<e.length;a++){var i=e[a];if(typeof i=="function"){i=new i}for(var n in i){t[n]=i[n]}}return t};e.$keyboardNavigation.shortcuts={createCommand:function(){return{modifiers:{shift:false,alt:false,ctrl:false,meta:false},keyCode:null}},parse:function(e){var t=[];var a=this.getExpressions(this.trim(e));for(var i=0;i<a.length;i++){var n=this.getWords(a[i]);var r=this.createCommand();for(var o=0;o<n.length;o++){if(this.commandKeys[n[o]]){r.modifiers[n[o]]=true}else if(this.specialKeys[n[o]]){r.keyCode=this.specialKeys[n[o]]}else{r.keyCode=n[o].charCodeAt(0)}}t.push(r)}return t},getCommandFromEvent:function(e){var t=this.createCommand();t.modifiers.shift=!!e.shiftKey;t.modifiers.alt=!!e.altKey;t.modifiers.ctrl=!!e.ctrlKey;t.modifiers.meta=!!e.metaKey;t.keyCode=e.which||e.keyCode;if(t.keyCode>=96&&t.keyCode<=105){t.keyCode-=48}var a=String.fromCharCode(t.keyCode);if(a){t.keyCode=a.toLowerCase().charCodeAt(0)}return t},getHashFromEvent:function(e){return this.getHash(this.getCommandFromEvent(e))},getHash:function(e){var t=[];for(var a in e.modifiers){if(e.modifiers[a]){t.push(a)}}t.push(e.keyCode);return t.join(this.junctionChar)},getExpressions:function(e){return e.split(this.junctionChar)},getWords:function(e){return e.split(this.combinationChar)},trim:function(e){return e.replace(/\s/g,"")},junctionChar:",",combinationChar:"+",commandKeys:{shift:16,alt:18,ctrl:17,meta:true},specialKeys:{backspace:8,tab:9,enter:13,esc:27,space:32,up:38,down:40,left:37,right:39,home:36,end:35,pageup:33,pagedown:34,delete:46,insert:45,plus:107,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123}};e.$keyboardNavigation.EventHandler={_handlers:null,findHandler:function(t){if(!this._handlers)this._handlers={};var a=e.$keyboardNavigation.shortcuts;var i=a.getHash(t);return this._handlers[i]},doAction:function(e,t){var a=this.findHandler(e);if(a){a.call(this,t);if(t.preventDefault)t.preventDefault();else t.returnValue=false}},bind:function(t,a){if(!this._handlers)this._handlers={};var i=e.$keyboardNavigation.shortcuts;var n=i.parse(t);for(var r=0;r<n.length;r++){this._handlers[i.getHash(n[r])]=a}},unbind:function(t){var a=e.$keyboardNavigation.shortcuts;var i=a.parse(t);for(var n=0;n<i.length;n++){if(this._handlers[a.getHash(i[n])]){delete this._handlers[a.getHash(i[n])]}}},bindAll:function(e){for(var t in e){this.bind(t,e[t])}},initKeys:function(){if(!this._handlers)this._handlers={};if(this.keys){this.bindAll(this.keys)}}};(function(){e.$keyboardNavigation.getFocusableNodes=e._getFocusableNodes;e.$keyboardNavigation.trapFocus=function t(a,i){if(i.keyCode!=9)return false;var n=e.$keyboardNavigation.getFocusableNodes(a);var r=document.activeElement;var o=-1;for(var d=0;d<n.length;d++){if(n[d]==r){o=d;break}}var s,l;if(i.shiftKey){s=o<=0?n[n.length-1]:o-1;l=n[s];if(l){l.focus();i.preventDefault();return true}}else{s=o>=n.length-1?0:o+1;l=n[s];if(l){l.focus();i.preventDefault();return true}}return false}})();e.$keyboardNavigation.marker={clear:function(){var t=e.$container.querySelectorAll(".dhx_focus_slot");for(var a=0;a<t.length;a++){t[a].parentNode.removeChild(t[a])}},createElement:function(){var e=document.createElement("div");e.setAttribute("tabindex",-1);e.className="dhx_focus_slot";return e},renderMultiple:function(t,a,i){var n=[];var r=new Date(t);var o=new Date(Math.min(a.valueOf(),e.date.add(e.date.day_start(new Date(t)),1,"day").valueOf()));while(r.valueOf()<a.valueOf()){n=n.concat(i.call(this,r,new Date(Math.min(o.valueOf(),a.valueOf()))));r=e.date.day_start(e.date.add(r,1,"day"));o=e.date.day_start(e.date.add(r,1,"day"));o=new Date(Math.min(o.valueOf(),a.valueOf()))}return n},render:function(t,a,i){this.clear();var n=[];var r=e.$keyboardNavigation.TimeSlot.prototype._modes;var o=e.$keyboardNavigation.TimeSlot.prototype._getMode();switch(o){case r.units:n=this.renderVerticalMarker(t,a,i);break;case r.timeline:n=this.renderTimelineMarker(t,a,i);break;case r.year:n=n.concat(this.renderMultiple(t,a,this.renderYearMarker));break;case r.month:n=this.renderMonthMarker(t,a);break;case r.weekAgenda:n=n.concat(this.renderMultiple(t,a,this.renderWeekAgendaMarker));break;case r.list:n=this.renderAgendaMarker(t,a);break;case r.dayColumns:n=n.concat(this.renderMultiple(t,a,this.renderVerticalMarker));break}this.addWaiAriaLabel(n,t,a,i);this.addDataAttributes(n,t,a,i);for(var d=n.length-1;d>=0;d--){if(n[d].offsetWidth){return n[d]}}return null},addDataAttributes:function(t,a,i,n){var r=e.date.date_to_str(e.config.api_date);var o=r(a),d=r(i);for(var s=0;s<t.length;s++){t[s].setAttribute("data-start-date",o);t[s].setAttribute("data-end-date",d);if(n){t[s].setAttribute("data-section",n)}}},addWaiAriaLabel:function(t,a,i,n){var r="";var o=e.getState();var d=o.mode;var s=false;r+=e.templates.day_date(a);if(e.date.day_start(new Date(a)).valueOf()!=a.valueOf()){r+=" "+e.templates.hour_scale(a);s=true}if(e.date.day_start(new Date(a)).valueOf()!=e.date.day_start(new Date(i)).valueOf()){r+=" - "+e.templates.day_date(i);if(s||e.date.day_start(new Date(i)).valueOf()!=i.valueOf()){r+=" "+e.templates.hour_scale(i)}}if(n){if(e.matrix&&e.matrix[d]){r+=", "+e.templates[d+"_scale_label"](n.key,n.label,n)}else if(e._props&&e._props[d]){r+=", "+e.templates[d+"_scale_text"](n.key,n.label,n)}}for(var l=0;l<t.length;l++){e._waiAria.setAttributes(t[l],{"aria-label":r,"aria-live":"polite"})}},renderWeekAgendaMarker:function(t,a){var i=e.$container.querySelectorAll(".dhx_wa_day_cont .dhx_wa_scale_bar");var n=e.date.week_start(new Date(e.getState().min_date));var r=-1;var o=e.date.day_start(new Date(t));for(var d=0;d<i.length;d++){r++;if(e.date.day_start(new Date(n)).valueOf()==o.valueOf()){break}else{n=e.date.add(n,1,"day")}}if(r!=-1)return this._wrapDiv(i[r]);return[]},_wrapDiv:function(e){var t=this.createElement();t.style.top=e.offsetTop+"px";t.style.left=e.offsetLeft+"px";t.style.width=e.offsetWidth+"px";t.style.height=e.offsetHeight+"px";e.appendChild(t);return[t]},renderYearMarker:function(t,a){var i=e._get_year_cell(t);i.style.position="relative";var n=this.createElement();n.style.top="0px";n.style.left="0px";n.style.width="100%";n.style.height="100%";i.appendChild(n);return[n]},renderAgendaMarker:function(t,a){var i=this.createElement();i.style.height="1px";i.style.width="100%";i.style.opacity=1;i.style.top="0px";i.style.left="0px";e.$container.querySelector(".dhx_cal_data").appendChild(i);return[i]},renderTimelineMarker:function(t,a,i){var n=e._lame_copy({},e.matrix[e._mode]);var r=n._scales;n.round_position=false;var o=[];var d=t?new Date(t):e._min_date;var s=a?new Date(a):e._max_date;if(d.valueOf()<e._min_date.valueOf())d=new Date(e._min_date);if(s.valueOf()>e._max_date.valueOf())s=new Date(e._max_date);if(!n._trace_x)return o;for(var l=0;l<n._trace_x.length;l++){if(e._is_column_visible(n._trace_x[l]))break}if(l==n._trace_x.length)return o;var u=r[i];if(!(d<a&&s>t))return o;var c=this.createElement();var f=e._timeline_getX({start_date:t},false,n)-1;var v=e._timeline_getX({start_date:a},false,n)-1;var h=n._section_height[i]-1||n.dy-1;var _=0;if(e._isRender("cell")){_=u.offsetTop;f+=n.dx;v+=n.dx;u=e.$container.querySelector(".dhx_cal_data")}else{}var g=Math.max(1,v-f-1);c.style.cssText="height: "+h+"px; left: "+f+"px; width: "+g+"px; top: "+_+"px;";u.appendChild(c);o.push(c);return o},renderMonthCell:function(t){var a=e.$container.querySelectorAll(".dhx_month_head");var i=[];for(var n=0;n<a.length;n++){i.push(a[n].parentNode)}var r=e.date.week_start(new Date(e.getState().min_date));var o=-1;var d=0;var s=-1;var l=r;var u=e.date.day_start(new Date(t));for(var n=0;n<i.length;n++){o++;if(s==6){d++;s=0}else{s++}if(e.date.day_start(new Date(l)).valueOf()==u.valueOf()){break}else{l=e.date.add(l,1,"day")}}if(o==-1){return[]}var c=e._colsS[s];var f=e._colsS.heights[d];var v=this.createElement();v.style.top=f+"px";v.style.left=c+"px";v.style.width=e._cols[s]+"px";v.style.height=(e._colsS.heights[d+1]-f||e._colsS.height)+"px";var h=e.$container.querySelector(".dhx_cal_data");var _=h.querySelector("table");if(_.nextSibling){h.insertBefore(v,_.nextSibling)}else{h.appendChild(v)}return v},renderMonthMarker:function(t,a){var i=[];var n=t;while(n.valueOf()<a.valueOf()){i.push(this.renderMonthCell(n));n=e.date.add(n,1,"day")}return i},renderVerticalMarker:function(t,a,i){var n=e.locate_holder_day(t);var r=[];var o=null;var d=e.config;if(e._ignores[n])return r;if(e._props&&e._props[e._mode]&&i){var s=e._props[e._mode];n=s.order[i];var l=s.order[i];if(!(s.days>1)){n=l;if(s.size&&n>s.position+s.size){n=0}}else{n=e.locate_holder_day(t)+l}}o=e.locate_holder(n);if(!o||o.querySelector(".dhx_scale_hour")){return document.createElement("div")}var u=Math.max(t.getHours()*60+t.getMinutes(),d.first_hour*60);var c=Math.min(a.getHours()*60+a.getMinutes(),d.last_hour*60);if(!c&&e.date.day_start(new Date(a)).valueOf()>e.date.day_start(new Date(t)).valueOf()){c=d.last_hour*60}if(c<=u){return[]}var f=this.createElement();var v=e.config.hour_size_px*d.last_hour+1;var h=60*60*1e3;f.style.top=Math.round((u*60*1e3-e.config.first_hour*h)*e.config.hour_size_px/h)%v+"px";f.style.lineHeight=f.style.height=Math.max(Math.round((c-u)*60*1e3*e.config.hour_size_px/h)%v,1)+"px";f.style.width="100%";o.appendChild(f);r.push(f);return r[0]}};e.$keyboardNavigation.SchedulerNode=function(){};e.$keyboardNavigation.SchedulerNode.prototype=e._compose(e.$keyboardNavigation.EventHandler,{getDefaultNode:function(){var t=new e.$keyboardNavigation.TimeSlot;if(!t.isValid()){t=t.fallback()}return t},_modes:{month:"month",year:"year",dayColumns:"dayColumns",timeline:"timeline",units:"units",weekAgenda:"weekAgenda",list:"list"},getMode:function(){var t=e.getState();var a=t.mode;if(e.matrix&&e.matrix[a]){return this._modes.timeline}else if(e._props&&e._props[a]){return this._modes.units}else if(a=="month"){return this._modes.month}else if(a=="year"){return this._modes.year}else if(a=="week_agenda"){return this._modes.weekAgenda}else if(a=="map"||a=="agenda"||e._grid&&e["grid_"+a]){return this._modes.list}else{return this._modes.dayColumns}},focus:function(){e.focus()},blur:function(){},disable:function(){e.$container.setAttribute("tabindex","0")},enable:function(){if(e.$container)e.$container.removeAttribute("tabindex")},isEnabled:function(){return e.$container.hasAttribute("tabindex")},_compareEvents:function(e,t){if(e.start_date.valueOf()==t.start_date.valueOf())return e.id>t.id?1:-1;return e.start_date.valueOf()>t.start_date.valueOf()?1:-1},_pickEvent:function(t,a,i,n){var r=e.getState();t=new Date(Math.max(r.min_date.valueOf(),t.valueOf()));a=new Date(Math.min(r.max_date.valueOf(),a.valueOf()));var o=e.getEvents(t,a);o.sort(this._compareEvents);if(n){o=o.reverse()}var d=!!i;for(var s=0;s<o.length&&d;s++){if(o[s].id==i){d=false}o.splice(s,1);s--}for(var s=0;s<o.length;s++){var l=new e.$keyboardNavigation.Event(o[s].id);if(l.getNode())return o[s]}return null},nextEventHandler:function(t){var a=e.$keyboardNavigation.dispatcher.activeNode;var i=t||a&&a.eventId;var n=null;if(i&&e.getEvent(i)){var r=e.getEvent(i);n=e.$keyboardNavigation.SchedulerNode.prototype._pickEvent(r.start_date,e.date.add(r.start_date,1,"year"),r.id,false)}if(!n&&!t){var o=e.getState();n=e.$keyboardNavigation.SchedulerNode.prototype._pickEvent(o.min_date,e.date.add(o.min_date,1,"year"),null,false)}if(n){var d=new e.$keyboardNavigation.Event(n.id);if(!d.isValid()){this.nextEventHandler(n.id)}else{if(a){a.blur()}e.$keyboardNavigation.dispatcher.setActiveNode(d)}}},prevEventHandler:function(t){var a=e.$keyboardNavigation.dispatcher.activeNode;var i=t||a&&a.eventId;var n=null;if(i&&e.getEvent(i)){var r=e.getEvent(i);n=e.$keyboardNavigation.SchedulerNode.prototype._pickEvent(e.date.add(r.end_date,-1,"year"),r.end_date,r.id,true)}if(!n&&!t){var o=e.getState();n=e.$keyboardNavigation.SchedulerNode.prototype._pickEvent(e.date.add(o.max_date,-1,"year"),o.max_date,null,true)}if(n){var d=new e.$keyboardNavigation.Event(n.id);if(!d.isValid()){this.prevEventHandler(n.id)}else{if(a){a.blur()}e.$keyboardNavigation.dispatcher.setActiveNode(d)}}},keys:{"alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9":function(t){var a=e.$keyboardNavigation.HeaderCell.prototype.getNodes(".dhx_cal_navline .dhx_cal_tab");var i=t.key;if(i===undefined){i=t.keyCode-48}if(a[i*1-1]){a[i*1-1].click()}},"ctrl+left,meta+left":function(t){e._click.dhx_cal_prev_button()},"ctrl+right,meta+right":function(t){e._click.dhx_cal_next_button()},"ctrl+up,meta+up":function(t){var a=e.$container.querySelector(".dhx_cal_data");a.scrollTop-=20},"ctrl+down,meta+down":function(t){var a=e.$container.querySelector(".dhx_cal_data");a.scrollTop+=20},e:function(){this.nextEventHandler()},home:function(){e.setCurrentView(new Date)},"shift+e":function(){this.prevEventHandler()},"ctrl+enter,meta+enter":function(){e.addEventNow({start_date:new Date(e.getState().date)})},"ctrl+c,meta+c":function(t){e._key_nav_copy_paste(t)},"ctrl+v,meta+v":function(t){e._key_nav_copy_paste(t)},"ctrl+x,meta+x":function(t){e._key_nav_copy_paste(t)}}});e.$keyboardNavigation.SchedulerNode.prototype.bindAll(e.$keyboardNavigation.SchedulerNode.prototype.keys);e.$keyboardNavigation.KeyNavNode=function(){};e.$keyboardNavigation.KeyNavNode.prototype=e._compose(e.$keyboardNavigation.EventHandler,{isValid:function(){return true},fallback:function(){return null},moveTo:function(t){e.$keyboardNavigation.dispatcher.setActiveNode(t)},compareTo:function(e){if(!e)return false;for(var t in this){if(!!this[t]!=!!e[t])return false;var a=!!(this[t]&&this[t].toString);var i=!!(e[t]&&e[t].toString);if(i!=a)return false;if(!(i&&a)){if(e[t]!=this[t])return false}else{if(e[t].toString()!=this[t].toString())return false}}return true},getNode:function(){},focus:function(){var e=this.getNode();if(e){e.setAttribute("tabindex","-1");if(e.focus)e.focus()}},blur:function(){var e=this.getNode();if(e){e.setAttribute("tabindex","-1")}}});e.$keyboardNavigation.HeaderCell=function(e){this.index=e||0};e.$keyboardNavigation.HeaderCell.prototype=e._compose(e.$keyboardNavigation.KeyNavNode,{getNode:function(e){e=e||this.index||0;var t=this.getNodes();if(t[e])return t[e]},getNodes:function(t){t=t||[".dhx_cal_navline .dhx_cal_prev_button",".dhx_cal_navline .dhx_cal_next_button",".dhx_cal_navline .dhx_cal_today_button",".dhx_cal_navline .dhx_cal_tab"].join(", ");var a=Array.prototype.slice.call(e.$container.querySelectorAll(t));a.sort(function(e,t){return e.offsetLeft-t.offsetLeft});return a},_handlers:null,isValid:function(){return!!this.getNode(this.index)},fallback:function(){var t=this.getNode(0);if(!t){t=new e.$keyboardNavigation.TimeSlot}return t},keys:{left:function(){var t=this.index-1;if(t<0){t=this.getNodes().length-1}this.moveTo(new e.$keyboardNavigation.HeaderCell(t))},right:function(){var t=this.index+1;if(t>=this.getNodes().length){t=0}this.moveTo(new e.$keyboardNavigation.HeaderCell(t))},down:function(){this.moveTo(new e.$keyboardNavigation.TimeSlot)},enter:function(){var e=this.getNode();if(e){e.click()}}}});e.$keyboardNavigation.HeaderCell.prototype.bindAll(e.$keyboardNavigation.HeaderCell.prototype.keys);e.$keyboardNavigation.Event=function(t){this.eventId=null;if(e.getEvent(t)){var a=e.getEvent(t);this.start=new Date(a.start_date);this.end=new Date(a.end_date);this.section=this._getSection(a);this.eventId=t}};e.$keyboardNavigation.Event.prototype=e._compose(e.$keyboardNavigation.KeyNavNode,{_getNodes:function(){return Array.prototype.slice.call(e.$container.querySelectorAll("[event_id]"))},_modes:e.$keyboardNavigation.SchedulerNode.prototype._modes,getMode:e.$keyboardNavigation.SchedulerNode.prototype.getMode,_handlers:null,isValid:function(){return!!(e.getEvent(this.eventId)&&this.getNode())},fallback:function(){var t=this._getNodes()[0];var a=null;if(!t||!e._locate_event(t)){a=new e.$keyboardNavigation.TimeSlot}else{var i=e._locate_event(t);a=new e.$keyboardNavigation.Event(i)}return a},getNode:function(){function t(t){var a=t.getBoundingClientRect();var i=e.$container.querySelector(".dhx_cal_data").getBoundingClientRect();if(a.bottom<i.top||a.top>i.bottom){return false}return true}var a="[event_id='"+this.eventId+"']";var i=e.$keyboardNavigation.dispatcher.getInlineEditor(this.eventId);if(i){return i}else{if(e.isMultisectionEvent&&e.isMultisectionEvent(e.getEvent(this.eventId))){var n=e.$container.querySelectorAll(a);for(var r=0;r<n.length;r++){if(t(n[r])){return n[r]}}return n[0]}else{return e.$container.querySelector(a)}}},focus:function(){var t=e.getEvent(this.eventId);var a=e.getState();if(t.start_date.valueOf()>a.max_date.valueOf()||t.end_date.valueOf()<=a.min_date.valueOf()){e.setCurrentView(t.start_date)}e.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this)},blur:function(){e.$keyboardNavigation.KeyNavNode.prototype.blur.apply(this)},_getSection:function(t){var a=null;var i=e.getState().mode;if(e.matrix&&e.matrix[i]){var n=e.matrix[e.getState().mode];a=t[n.y_property]}else if(e._props&&e._props[i]){var r=e._props[i];a=t[r.map_to]}return a},_moveToSlot:function(t){var a=e.getEvent(this.eventId);if(a){var i=this._getSection(a);var n=new e.$keyboardNavigation.TimeSlot(a.start_date,null,i);this.moveTo(n.nextSlot(n,t))}else{this.moveTo(new e.$keyboardNavigation.TimeSlot)}},keys:{left:function(){this._moveToSlot("left")},right:function(){this._moveToSlot("right")},down:function(){if(this.getMode()==this._modes.list){e.$keyboardNavigation.SchedulerNode.prototype.nextEventHandler()}else{this._moveToSlot("down")}},space:function(){var t=this.getNode();if(t&&t.click){t.click()}else{this.moveTo(new e.$keyboardNavigation.TimeSlot)}},up:function(){if(this.getMode()==this._modes.list){e.$keyboardNavigation.SchedulerNode.prototype.prevEventHandler()}else{this._moveToSlot("up")}},delete:function(){if(e.getEvent(this.eventId)){e._click.buttons["delete"](this.eventId)}else{this.moveTo(new e.$keyboardNavigation.TimeSlot)}},enter:function(){if(e.getEvent(this.eventId)){e.showLightbox(this.eventId)}else{this.moveTo(new e.$keyboardNavigation.TimeSlot)}}}});e.$keyboardNavigation.Event.prototype.bindAll(e.$keyboardNavigation.Event.prototype.keys);e.$keyboardNavigation.TimeSlot=function(t,a,i,n){var r=e.getState();var o=e.matrix&&e.matrix[r.mode];if(!t){t=this.getDefaultDate()}if(!a){if(o){a=e.date.add(t,o.x_step,o.x_unit)}else{a=e.date.add(t,e.config.key_nav_step,"minute")}}this.section=i||this._getDefaultSection();this.start_date=new Date(t);this.end_date=new Date(a);this.movingDate=n||null};e.$keyboardNavigation.TimeSlot.prototype=e._compose(e.$keyboardNavigation.KeyNavNode,{_handlers:null,getDefaultDate:function(){var t;var a=e.getState();var i=e.matrix&&e.matrix[a.mode];if(i){t=e.date[i.name+"_start"](new Date(a.date));t=this.findVisibleColumn(t)}else{t=new Date(e.getState().min_date);t=this.findVisibleColumn(t);t.setHours(e.config.first_hour);if(!e._table_view){var n=e.$container.querySelector(".dhx_cal_data");if(n.scrollTop){t.setHours(e.config.first_hour+Math.ceil(n.scrollTop/e.config.hour_size_px))}}}return t},clone:function(t){return new e.$keyboardNavigation.TimeSlot(t.start_date,t.end_date,t.section,t.movingDate)},_getMultisectionView:function(){var t=e.getState();var a;if(e._props&&e._props[t.mode]){a=e._props[t.mode]}else if(e.matrix&&e.matrix[t.mode]){a=e.matrix[t.mode]}return a},_getDefaultSection:function(){var e=null;var t=this._getMultisectionView();if(t&&!e){e=this._getNextSection()}return e},_getNextSection:function(e,t){var a=this._getMultisectionView();var i=a.order[e];var n=i;if(i!==undefined){n=i+t}else{n=a.size&&a.position?a.position:0}n=n<0?n=(a.options||a.y_unit).length-1:n;var r=a.options||a.y_unit;if(r[n]){return r[n].key}else{return null}},isValid:function(){var t=e.getState();var a=!(this.start_date.valueOf()<t.min_date.valueOf()||this.start_date.valueOf()>=t.max_date.valueOf());if(!a)return false;if(!this.isVisible(this.start_date,this.end_date))return false;var i=this._getMultisectionView();if(i){return i.order[this.section]!==undefined}else{return true}},fallback:function(){var t=new e.$keyboardNavigation.TimeSlot;if(!t.isValid()){return new e.$keyboardNavigation.DataArea}else{return t}},getNodes:function(){return Array.prototype.slice.call(e.$container.querySelectorAll(".dhx_focus_slot"))},getNode:function(){return this.getNodes()[0]},focus:function(){e.$keyboardNavigation.marker.render(this.start_date,this.end_date,this.section);e.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this);e.$keyboardNavigation._pasteDate=this.start_date;e.$keyboardNavigation._pasteSection=this.section},blur:function(){e.$keyboardNavigation.KeyNavNode.prototype.blur.apply(this);e.$keyboardNavigation.marker.clear()},_modes:e.$keyboardNavigation.SchedulerNode.prototype._modes,_getMode:e.$keyboardNavigation.SchedulerNode.prototype.getMode,addMonthDate:function(t,a,i){var n;switch(a){case"up":n=e.date.add(t,-1,"week");break;case"down":n=e.date.add(t,1,"week");break;case"left":n=e.date.day_start(e.date.add(t,-1,"day"));n=this.findVisibleColumn(n,-1);break;case"right":n=e.date.day_start(e.date.add(t,1,"day"));n=this.findVisibleColumn(n,1);break;default:n=e.date.day_start(new Date(t));break}var r=e.getState();if(t.valueOf()<r.min_date.valueOf()||!i&&t.valueOf()>=r.max_date.valueOf()){n=new Date(r.min_date)}return n},nextMonthSlot:function(t,a,i){var n,r;n=this.addMonthDate(t.start_date,a,i);n.setHours(e.config.first_hour);r=new Date(n);r.setHours(e.config.last_hour);return{start_date:n,end_date:r}},_alignTimeSlot:function(t,a,i,n){var r=new Date(a);while(r.valueOf()<t.valueOf()){r=e.date.add(r,n,i)}if(r.valueOf()>t.valueOf()){r=e.date.add(r,-n,i)}return r},nextTimelineSlot:function(t,a,i){var n=e.getState();var r=e.matrix[n.mode];var o=this._alignTimeSlot(t.start_date,e.date[r.name+"_start"](new Date(t.start_date)),r.x_unit,r.x_step);var d=this._alignTimeSlot(t.end_date,e.date[r.name+"_start"](new Date(t.end_date)),r.x_unit,r.x_step);if(d.valueOf()<=o.valueOf()){d=e.date.add(o,r.x_step,r.x_unit)}var s=this.clone(t);s.start_date=o;s.end_date=d;s.section=t.section||this._getNextSection();switch(a){case"up":s.section=this._getNextSection(t.section,-1);break;case"down":s.section=this._getNextSection(t.section,+1);break;case"left":s.start_date=this.findVisibleColumn(e.date.add(s.start_date,-r.x_step,r.x_unit),-1);s.end_date=e.date.add(s.start_date,r.x_step,r.x_unit);break;case"right":s.start_date=this.findVisibleColumn(e.date.add(s.start_date,r.x_step,r.x_unit),1);s.end_date=e.date.add(s.start_date,r.x_step,r.x_unit);break;default:break}if(s.start_date.valueOf()<n.min_date.valueOf()||s.start_date.valueOf()>=n.max_date.valueOf()){if(i&&s.start_date.valueOf()>=n.max_date.valueOf()){s.start_date=new Date(n.max_date)}else{s.start_date=e.date[n.mode+"_start"](e.date.add(n.date,a=="left"?-1:1,n.mode));s.end_date=e.date.add(s.start_date,r.x_step,r.x_unit)}}return s},nextUnitsSlot:function(t,a,i){var n=this.clone(t);n.section=t.section||this._getNextSection();var r=t.section||this._getNextSection();var o=e.getState();var d=e._props[o.mode];switch(a){case"left":r=this._getNextSection(t.section,-1);var s=d.size?d.size-1:d.options.length;if(d.days>1&&d.order[r]==s-1){if(e.date.add(t.start_date,-1,"day").valueOf()>=o.min_date.valueOf()){n=this.nextDaySlot(t,a,i)}}break;case"right":r=this._getNextSection(t.section,1);if(d.days>1&&!d.order[r]){if(e.date.add(t.start_date,1,"day").valueOf()<o.max_date.valueOf()){n=this.nextDaySlot(t,a,i)}}break;default:n=this.nextDaySlot(t,a,i);r=t.section;break}n.section=r;return n},_moveDate:function(t,a){var i=this.findVisibleColumn(e.date.add(t,a,"day"),a);i.setHours(t.getHours());i.setMinutes(t.getMinutes());return i},isBeforeLastHour:function(t,a){var i=t.getMinutes(),n=t.getHours(),r=e.config.last_hour;return n<r||!a&&((r==24||n==r)&&!i)},isAfterFirstHour:function(t,a){var i=t.getMinutes(),n=t.getHours(),r=e.config.first_hour,o=e.config.last_hour;return n>=r||!a&&(!i&&(!n&&o==24||n==o))},isInVisibleDayTime:function(e,t){return this.isBeforeLastHour(e,t)&&this.isAfterFirstHour(e,t)},nextDaySlot:function(t,a,i){var n,r;var o=e.config.key_nav_step;var d=this._alignTimeSlot(t.start_date,e.date.day_start(new Date(t.start_date)),"minute",o);var s=t.start_date;switch(a){case"up":n=e.date.add(d,-o,"minute");if(!this.isInVisibleDayTime(n,true)){if(!i||this.isInVisibleDayTime(s,true)){var l=true;if(i&&e.date.date_part(new Date(n)).valueOf()!=e.date.date_part(new Date(s)).valueOf())l=false;if(l)n=this.findVisibleColumn(e.date.add(t.start_date,-1,"day"),-1);n.setHours(e.config.last_hour);n.setMinutes(0);n=e.date.add(n,-o,"minute")}}r=e.date.add(n,o,"minute");break;case"down":n=e.date.add(d,o,"minute");var u=i?n:e.date.add(n,o,"minute");if(!this.isInVisibleDayTime(u,false)){if(!i||this.isInVisibleDayTime(s,false)){if(!i){n=this.findVisibleColumn(e.date.add(t.start_date,1,"day"),1);n.setHours(e.config.first_hour);n.setMinutes(0)}else{var l=true;if(e.date.date_part(new Date(s)).valueOf()==s.valueOf()){l=false}if(l){n=this.findVisibleColumn(e.date.add(t.start_date,1,"day"),1)}n.setHours(e.config.first_hour);n.setMinutes(0);n=e.date.add(n,o,"minute")}}}r=e.date.add(n,o,"minute");break;case"left":n=this._moveDate(t.start_date,-1);r=this._moveDate(t.end_date,-1);break;case"right":n=this._moveDate(t.start_date,1);r=this._moveDate(t.end_date,1);break;default:n=d;r=e.date.add(n,o,"minute");break}return{start_date:n,end_date:r}},nextWeekAgendaSlot:function(t,a){var i,n;var r=e.getState();switch(a){case"down":case"left":i=e.date.day_start(e.date.add(t.start_date,-1,"day"));i=this.findVisibleColumn(i,-1);break;case"up":case"right":i=e.date.day_start(e.date.add(t.start_date,1,"day"));i=this.findVisibleColumn(i,1);break;default:i=e.date.day_start(t.start_date);break}if(t.start_date.valueOf()<r.min_date.valueOf()||t.start_date.valueOf()>=r.max_date.valueOf()){i=new Date(r.min_date)}n=new Date(i);n.setHours(e.config.last_hour);return{start_date:i,end_date:n}},nextAgendaSlot:function(e,t){return{start_date:e.start_date,end_date:e.end_date}},isDateVisible:function(t){if(!e._ignores_detected)return true;var a=e.matrix&&e.matrix[e.getState().mode];var i;if(a){i=e._get_date_index(a,t)}else{i=e.locate_holder_day(t)}return!e._ignores[i]},findVisibleColumn:function(t,a){var i=t;a=a||1;var n=e.getState();while(!this.isDateVisible(i)&&(a>0&&i.valueOf()<=n.max_date.valueOf()||a<0&&i.valueOf()>=n.min_date.valueOf())){i=this.nextDateColumn(i,a)}return i},nextDateColumn:function(t,a){a=a||1;var i=e.matrix&&e.matrix[e.getState().mode];var n;if(i){n=e.date.add(t,a*i.x_step,i.x_unit)}else{n=e.date.day_start(e.date.add(t,a,"day"))}return n},isVisible:function(t,a){if(!e._ignores_detected)return true;var i=new Date(t);while(i.valueOf()<a.valueOf()){if(this.isDateVisible(i))return true;i=this.nextDateColumn(i)}return false},nextSlot:function(t,a,i,n){var r;i=i||this._getMode();var o=e.$keyboardNavigation.TimeSlot.prototype.clone(t);switch(i){case this._modes.units:r=this.nextUnitsSlot(o,a,n);break;case this._modes.timeline:r=this.nextTimelineSlot(o,a,n);break;case this._modes.year:r=this.nextMonthSlot(o,a,n);break;case this._modes.month:r=this.nextMonthSlot(o,a,n);break;case this._modes.weekAgenda:r=this.nextWeekAgendaSlot(o,a,n);break;case this._modes.list:r=this.nextAgendaSlot(o,a,n);break;case this._modes.dayColumns:r=this.nextDaySlot(o,a,n);break}if(r.start_date.valueOf()>=r.end_date.valueOf()){r=this.nextSlot(r,a,i)}return e.$keyboardNavigation.TimeSlot.prototype.clone(r)},extendSlot:function(t,a){var i=this._getMode();var n;switch(i){case this._modes.units:if(a=="left"||a=="right"){n=this.nextUnitsSlot(t,a)}else{n=this.extendUnitsSlot(t,a)}break;case this._modes.timeline:if(a=="down"||a=="up"){n=this.nextTimelineSlot(t,a)}else{n=this.extendTimelineSlot(t,a)}break;case this._modes.year:n=this.extendMonthSlot(t,a);break;case this._modes.month:n=this.extendMonthSlot(t,a);break;case this._modes.dayColumns:n=this.extendDaySlot(t,a);break;case this._modes.weekAgenda:n=this.extendWeekAgendaSlot(t,a);break;default:n=t;break}var r=e.getState();if(n.start_date.valueOf()<r.min_date.valueOf()){n.start_date=this.findVisibleColumn(r.min_date);n.start_date.setHours(e.config.first_hour)}if(n.end_date.valueOf()>r.max_date.valueOf()){n.end_date=this.findVisibleColumn(r.max_date,-1)}return e.$keyboardNavigation.TimeSlot.prototype.clone(n)},extendTimelineSlot:function(e,t){return this.extendGenericSlot({left:"start_date",right:"end_date"},e,t,"timeline")},extendWeekAgendaSlot:function(e,t){return this.extendGenericSlot({left:"start_date",right:"end_date"},e,t,"weekAgenda")},extendGenericSlot:function(t,a,i,n){var r;var o=a.movingDate;if(!o){o=t[i]}if(!o||!t[i]){return a}if(i){r=this.nextSlot({start_date:a[o],section:a.section},i,n,true);if(r.start_date.valueOf()==a.start_date.valueOf()){r=this.nextSlot({start_date:r.start_date,section:r.section},i,n,true)}r.movingDate=o}else{return e.$keyboardNavigation.TimeSlot.prototype.clone(a)}var d=this.extendSlotDates(a,r,r.movingDate);if(d.end_date.valueOf()<=d.start_date.valueOf()){r.movingDate=r.movingDate=="end_date"?"start_date":"end_date"}d=this.extendSlotDates(a,r,r.movingDate);r.start_date=d.start_date;r.end_date=d.end_date;return r},extendSlotDates:function(e,t,a){var i={start_date:null,end_date:null};if(a=="start_date"){i.start_date=t.start_date;i.end_date=e.end_date}else{i.start_date=e.start_date;i.end_date=t.start_date}return i},extendMonthSlot:function(t,a){var t=this.extendGenericSlot({up:"start_date",down:"end_date",left:"start_date",right:"end_date"},t,a,"month");t.start_date.setHours(e.config.first_hour);t.end_date=e.date.add(t.end_date,-1,"day");t.end_date.setHours(e.config.last_hour);return t},extendUnitsSlot:function(e,t){var a;switch(t){case"down":case"up":a=this.extendDaySlot(e,t);break;default:a=e;break}a.section=e.section;return a},extendDaySlot:function(e,t){return this.extendGenericSlot({up:"start_date",down:"end_date",left:"start_date",right:"end_date"},e,t,"dayColumns")},scrollSlot:function(t){var a=e.getState();var i=this.nextSlot(this,t);if(i.start_date.valueOf()<a.min_date.valueOf()||i.start_date.valueOf()>=a.max_date.valueOf()){e.setCurrentView(new Date(i.start_date))}this.moveTo(i)},keys:{left:function(){this.scrollSlot("left")},right:function(){this.scrollSlot("right")},down:function(){var t=this._getMode();if(t==this._modes.list){e.$keyboardNavigation.SchedulerNode.prototype.nextEventHandler()}else{this.scrollSlot("down")}},up:function(){var t=this._getMode();if(t==this._modes.list){e.$keyboardNavigation.SchedulerNode.prototype.prevEventHandler()}else{this.scrollSlot("up")}},"shift+down":function(){this.moveTo(this.extendSlot(this,"down"))},"shift+up":function(){this.moveTo(this.extendSlot(this,"up"))},"shift+right":function(){this.moveTo(this.extendSlot(this,"right"))},"shift+left":function(){this.moveTo(this.extendSlot(this,"left"))},enter:function(){var t={start_date:new Date(this.start_date),end_date:new Date(this.end_date)};var a=e.getState().mode;if(e.matrix&&e.matrix[a]){var i=e.matrix[e.getState().mode];t[i.y_property]=this.section}else if(e._props&&e._props[a]){var n=e._props[a];t[n.map_to]=this.section}e.addEventNow(t)}}});e.$keyboardNavigation.TimeSlot.prototype.bindAll(e.$keyboardNavigation.TimeSlot.prototype.keys);e.$keyboardNavigation.MinicalButton=function(e,t){this.container=e;this.index=t||0};e.$keyboardNavigation.MinicalButton.prototype=e._compose(e.$keyboardNavigation.KeyNavNode,{isValid:function(){var e=this.container;return!!e.offsetWidth},fallback:function(){var t=new e.$keyboardNavigation.TimeSlot;if(t.isValid()){return t}else{return new e.$keyboardNavigation.DataArea}},focus:function(){e.$keyboardNavigation.dispatcher.globalNode.disable();this.container.removeAttribute("tabindex");e.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this)},blur:function(){this.container.setAttribute("tabindex","0");e.$keyboardNavigation.KeyNavNode.prototype.blur.apply(this)},getNode:function(){if(!this.index){return this.container.querySelector(".dhx_cal_prev_button")}else{return this.container.querySelector(".dhx_cal_next_button")}},keys:{right:function(t){this.moveTo(new e.$keyboardNavigation.MinicalButton(this.container,this.index?0:1))},left:function(t){this.moveTo(new e.$keyboardNavigation.MinicalButton(this.container,this.index?0:1))},down:function(){var t=new e.$keyboardNavigation.MinicalCell(this.container,0,0);if(t&&!t.isValid()){t=t.fallback()}this.moveTo(t)},enter:function(e){this.getNode().click()}}});e.$keyboardNavigation.MinicalButton.prototype.bindAll(e.$keyboardNavigation.MinicalButton.prototype.keys);e.$keyboardNavigation.MinicalCell=function(e,t,a){this.container=e;this.row=t||0;this.col=a||0};e.$keyboardNavigation.MinicalCell.prototype=e._compose(e.$keyboardNavigation.KeyNavNode,{isValid:function(){var e=this._getGrid();return!!(e[this.row]&&e[this.row][this.col])},fallback:function(){var t=this.row;var a=this.col;var i=this._getGrid();if(!i[t]){t=0}var n=true;if(t>i.length/2){n=false}if(!i[t]){var r=new e.$keyboardNavigation.TimeSlot;if(r.isValid()){return r}else{return new e.$keyboardNavigation.DataArea}}if(n){for(var o=a;i[t]&&o<i[t].length;o++){if(!i[t][o]&&o==i[t].length-1){t++;a=0}if(i[t][o]){return new e.$keyboardNavigation.MinicalCell(this.container,t,o)}}}else{for(var o=a;i[t]&&o<i[t].length;o--){if(!i[t][o]&&!o){t--;a=i[t].length-1}if(i[t][o]){return new e.$keyboardNavigation.MinicalCell(this.container,t,o)}}}return new e.$keyboardNavigation.MinicalButton(this.container,0)},focus:function(){e.$keyboardNavigation.dispatcher.globalNode.disable();this.container.removeAttribute("tabindex");e.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this)},blur:function(){this.container.setAttribute("tabindex","0");e.$keyboardNavigation.KeyNavNode.prototype.blur.apply(this)},_getNode:function(e,t){return this.container.querySelector(".dhx_year_body tr:nth-child("+(e+1)+") td:nth-child("+(t+1)+")")},getNode:function(){return this._getNode(this.row,this.col)},_getGrid:function(){var t=this.container.querySelectorAll(".dhx_year_body tr");var a=[];for(var i=0;i<t.length;i++){a[i]=[];var n=t[i];var r=n.querySelectorAll("td");for(var o=0;o<r.length;o++){var d=r[o];var s=true;var l=e._getClassName(d);if(l.indexOf("dhx_after")>-1||l.indexOf("dhx_before")>-1||l.indexOf("dhx_scale_ignore")>-1){s=false}a[i][o]=s}}return a},keys:{right:function(t){var a=this._getGrid();var i=this.row;var n=this.col+1;if(!a[i]||!a[i][n]){if(a[i+1]){i=i+1;n=0}else{n=this.col}}var r=new e.$keyboardNavigation.MinicalCell(this.container,i,n);if(!r.isValid()){r=r.fallback()}this.moveTo(r)},left:function(t){var a=this._getGrid();var i=this.row;var n=this.col-1;if(!a[i]||!a[i][n]){if(a[i-1]){i=i-1;n=a[i].length-1}else{n=this.col}}var r=new e.$keyboardNavigation.MinicalCell(this.container,i,n);if(!r.isValid()){r=r.fallback()}this.moveTo(r)},down:function(){var t=this._getGrid();var a=this.row+1;var i=this.col;if(!t[a]||!t[a][i]){a=this.row}var n=new e.$keyboardNavigation.MinicalCell(this.container,a,i);if(!n.isValid()){n=n.fallback()}this.moveTo(n)},up:function(){var t=this._getGrid();var a=this.row-1;var i=this.col;if(!t[a]||!t[a][i]){var n=0;if(this.col>t[this.row].length/2){n=1}this.moveTo(new e.$keyboardNavigation.MinicalButton(this.container,n))}else{var r=new e.$keyboardNavigation.MinicalCell(this.container,a,i);if(!r.isValid()){r=r.fallback()}this.moveTo(r)}},enter:function(e){this.getNode().querySelector(".dhx_month_head").click()}}});e.$keyboardNavigation.MinicalCell.prototype.bindAll(e.$keyboardNavigation.MinicalCell.prototype.keys);e.$keyboardNavigation.DataArea=function(e){this.index=e||0};e.$keyboardNavigation.DataArea.prototype=e._compose(e.$keyboardNavigation.KeyNavNode,{getNode:function(t){return e.$container.querySelector(".dhx_cal_data")},_handlers:null,isValid:function(){return true},fallback:function(){return this},keys:{"up,down,right,left":function(){this.moveTo(new e.$keyboardNavigation.TimeSlot)}}});e.$keyboardNavigation.DataArea.prototype.bindAll(e.$keyboardNavigation.DataArea.prototype.keys);if(!dhtmlx._modalsStack){dhtmlx._modalsStack=[]}(function(){var t=[];function a(){return!!(t.length||dhtmlx._modalsStack.length)}function i(e,t){while(e&&e!=t){e=e.parentNode}return!!(e==t)}function n(t){setTimeout(function(){if(!a()&&!i(document.activeElement,e.$container)){e.focus()}},1)}function r(a){e.eventRemove(a,"keydown",s);e.event(a,"keydown",s);t.push(a)}function o(){var a=t.pop();if(a){e.eventRemove(a,"keydown",s)}n(a)}function d(e){if(dhtmlx._modalsStack.length){return e==dhtmlx._modalsStack[dhtmlx._modalsStack.length-1]}else{return e==t[t.length-1]}}function s(t){var t=t||window.event;var a=t.currentTarget;if(!d(a))return;e.$keyboardNavigation.trapFocus(a,t)}function l(){r(e.getLightbox())}e.attachEvent("onLightbox",l);e.attachEvent("onAfterLightbox",o);e.attachEvent("onAfterQuickInfo",function(){n()});if(!dhtmlx._keyNavMessagePopup){dhtmlx._keyNavMessagePopup=true;var u=null;var c=null;dhtmlx.attachEvent("onMessagePopup",function(t){u=document.activeElement;c=u;while(c&&e._getClassName(c).indexOf("dhx_cal_data")<0){c=c.parentNode}if(c){c=c.parentNode}e.eventRemove(t,"keydown",s);e.event(t,"keydown",s);dhtmlx._modalsStack.push(t)});dhtmlx.attachEvent("onAfterMessagePopup",function(){var t=dhtmlx._modalsStack.pop();if(t){e.eventRemove(t,"keydown",s)}setTimeout(function(){var t=document.activeElement;while(t&&e._getClassName(t).indexOf("dhx_cal_light")<0){t=t.parentNode}if(t)return;if(u&&u.parentNode){u.focus()}else if(c&&c.parentNode){c.focus()}u=null;c=null},1)})}e.$keyboardNavigation.isModal=a})();e.$keyboardNavigation.dispatcher={isActive:false,activeNode:null,globalNode:new e.$keyboardNavigation.SchedulerNode,keepScrollPosition:function(t){var a,i;var n=e.$container.querySelector(".dhx_timeline_scrollable_data");if(!n){n=e.$container.querySelector(".dhx_cal_data")}if(n){a=n.scrollTop;i=n.scrollLeft}t();if(n){n.scrollTop=a;n.scrollLeft=i}},enable:function(){if(!e.$container){return}this.isActive=true;var t=this;this.keepScrollPosition(function(){t.globalNode.enable();t.setActiveNode(t.getActiveNode())})},disable:function(){this.isActive=false;this.globalNode.disable()},isEnabled:function(){return!!this.isActive},getDefaultNode:function(){return this.globalNode.getDefaultNode()},setDefaultNode:function(){this.setActiveNode(this.getDefaultNode())},getActiveNode:function(){var e=this.activeNode;if(e&&!e.isValid()){e=e.fallback()}return e},focusGlobalNode:function(){this.blurNode(this.globalNode);this.focusNode(this.globalNode)},setActiveNode:function(e){if(!e||!e.isValid())return;if(this.activeNode){if(this.activeNode.compareTo(e)){return}}if(this.isEnabled()){this.blurNode(this.activeNode);this.activeNode=e;this.focusNode(this.activeNode)}},focusNode:function(t){if(t&&t.focus){t.focus();if(t.getNode&&document.activeElement!=t.getNode()){this.setActiveNode(new e.$keyboardNavigation.DataArea)}}},blurNode:function(e){if(e&&e.blur){e.blur()}},getInlineEditor:function(t){var a=e.$container.querySelector(".dhx_cal_editor[event_id='"+t+"'] textarea");if(a&&a.offsetWidth){return a}return null},keyDownHandler:function(t){if(t.defaultPrevented){return}var a=this.getActiveNode();if(e.$keyboardNavigation.isModal()&&!(a&&a.container&&e._locate_css({target:a.container},"dhx_minical_popup",false)))return;if(e.getState().editor_id&&this.getInlineEditor(e.getState().editor_id))return;if(!this.isEnabled())return;t=t||window.event;var i=this.globalNode;var n=e.$keyboardNavigation.shortcuts.getCommandFromEvent(t);if(!a){this.setDefaultNode()}else if(a.findHandler(n)){a.doAction(n,t)}else if(i.findHandler(n)){i.doAction(n,t)}},_timeout:null,delay:function(e,t){clearTimeout(this._timeout);this._timeout=setTimeout(e,t||1)}};e._temp_key_scope=function(){e.config.key_nav=true;e.$keyboardNavigation._pasteDate=null;e.$keyboardNavigation._pasteSection=null;var t=null;var a={};if(!document.body){e.event(window,"load",function(){e.event(document.body,"mousemove",i)})}else{e.event(document.body,"mousemove",i)}function i(e){e=e||window.event;a.x=e.clientX;a.y=e.clientY}function n(){var t=false;var i=false;var n=document.elementFromPoint(a.x,a.y);while(n&&n!=e._obj){n=n.parentNode}t=!!(n==e._obj);i=e.$keyboardNavigation.dispatcher.isEnabled();return t||i}e.attachEvent("onMouseMove",function(t,a){var i=e.getState();if(!(i.mode&&i.min_date)){return}var n=e.getActionData(a);e.$keyboardNavigation._pasteDate=n.date;e.$keyboardNavigation._pasteSection=n.section});function r(e){delete e.rec_type;delete e.rec_pattern;delete e.event_pid;delete e.event_length}function o(t){return e._lame_copy({},t)}e._make_pasted_event=function(t){var a=e.$keyboardNavigation._pasteDate;var i=e.$keyboardNavigation._pasteSection;var n=t.end_date-t.start_date;var d=o(t);r(d);d.start_date=new Date(a);d.end_date=new Date(d.start_date.valueOf()+n);if(i){var s=e._get_section_property();if(e.config.multisection)d[s]=t[s];else d[s]=i}return d};e._do_paste=function(t,a,i){e.addEvent(a);e.callEvent("onEventPasted",[t,a,i])};e._is_key_nav_active=function(){if(this._is_initialized()&&!this._is_lightbox_open()&&this.config.key_nav){return true}return false};function d(){var t=e.$keyboardNavigation.dispatcher.getActiveNode();if(t&&t.eventId)return t.eventId;return e._select_id}e.event(document,"keydown",function(t){if((t.ctrlKey||t.metaKey)&&t.keyCode==86&&e._buffer_event&&!e.$keyboardNavigation.dispatcher.isEnabled()){e.$keyboardNavigation.dispatcher.isActive=n()}});e._key_nav_copy_paste=function(a){if(!e._is_key_nav_active())return true;a=a||event;if(a.keyCode==37||a.keyCode==39){a.cancelBubble=true;var i=e.date.add(e._date,a.keyCode==37?-1:1,e._mode);e.setCurrentView(i);return true}var r=d();if((a.ctrlKey||a.metaKey)&&a.keyCode==67){if(r){e._buffer_event=o(e.getEvent(r));t=true;e.callEvent("onEventCopied",[e.getEvent(r)])}return true}if((a.ctrlKey||a.metaKey)&&a.keyCode==88){if(r){t=false;var s=e._buffer_event=o(e.getEvent(r));e.updateEvent(s.id);e.callEvent("onEventCut",[s])}}if((a.ctrlKey||a.metaKey)&&a.keyCode==86&&n(a)){var s=e._buffer_event?e.getEvent(e._buffer_event.id):e._buffer_event;s=s||e._buffer_event;if(s){var l=e._make_pasted_event(s);if(t){l.id=e.uid();e._do_paste(t,l,s)}else{var u=e.callEvent("onBeforeEventChanged",[l,a,false,s]);if(u){e._do_paste(t,l,s);t=true}}}return true}}};e._temp_key_scope();(function(){e.$keyboardNavigation.attachSchedulerHandlers=function(){var t=e.$keyboardNavigation.dispatcher;var a=function(a){if(!e.config.key_nav)return;return t.keyDownHandler(a)};var i=function(){t.keepScrollPosition(function(){t.focusGlobalNode()})};var n;e.attachEvent("onDataRender",function(){if(!e.config.key_nav)return;if(!(t.isEnabled()&&!e.getState().editor_id))return;clearTimeout(n);n=setTimeout(function(){if(!t.isEnabled())t.enable();r()})});var r=function(){if(!t.isEnabled())return;var a=t.getActiveNode();if(!a)return;if(!a.isValid()){a=a.fallback()}if(!a||a instanceof e.$keyboardNavigation.MinicalButton||a instanceof e.$keyboardNavigation.MinicalCell)return;t.keepScrollPosition(function(){a.focus(true)})};e.attachEvent("onSchedulerReady",function(){var t=e.$container;e.eventRemove(document,"keydown",a);e.eventRemove(t,"mousedown",o);e.eventRemove(t,"focus",i);if(e.config.key_nav){e.event(document,"keydown",a);e.event(t,"mousedown",o);e.event(t,"focus",i);t.setAttribute("tabindex","0")}else{t.removeAttribute("tabindex")}});function o(a){if(!e.config.key_nav)return true;var i=e.$keyboardNavigation.isChildOf(a.target||a.srcElement,e.$container.querySelector(".dhx_cal_data"));var n=e.getActionData(a);var r;if(e._locate_event(a.target||a.srcElement)){r=new e.$keyboardNavigation.Event(e._locate_event(a.target||a.srcElement))}else if(i){r=new e.$keyboardNavigation.TimeSlot;if(n.date&&i){r=r.nextSlot(new e.$keyboardNavigation.TimeSlot(n.date,null,n.section))}}if(r){if(!t.isEnabled()){t.activeNode=r}else{if(n.date&&i){t.delay(function(){t.setActiveNode(r)})}}}}function d(a){if(!e.config.key_nav)return;if(!t.isEnabled())return;var i=a;var n=new e.$keyboardNavigation.Event(i.eventId);if(!n.isValid()){var r=n.start||i.start;var o=n.end||i.end;var d=n.section||i.section;n=new e.$keyboardNavigation.TimeSlot(r,o,d);if(!n.isValid()){n=new e.$keyboardNavigation.TimeSlot}}t.setActiveNode(n);var s=t.getActiveNode();if(s&&s.getNode&&document.activeElement!=s.getNode()){t.focusNode(t.getActiveNode())}}var s=e.updateEvent;e.updateEvent=function(a){var i=s.apply(this,arguments);if(e.config.key_nav&&t.isEnabled()){if(e.getState().select_id==a){var n=new e.$keyboardNavigation.Event(a);if(!e.getState().lightbox_id){d(n)}}}return i};e.attachEvent("onEventDeleted",function(a){if(!e.config.key_nav)return true;if(t.isEnabled()){var i=t.getActiveNode();if(i.eventId==a){t.setActiveNode(new e.$keyboardNavigation.TimeSlot)}}return true});e.attachEvent("onClearAll",function(){if(!e.config.key_nav)return true;if(t.isEnabled()){if(t.getActiveNode()instanceof e.$keyboardNavigation.Event){t.setActiveNode(new e.$keyboardNavigation.TimeSlot)}}})};e.$keyboardNavigation._minicalendars=[];e.$keyboardNavigation.isMinical=function(t){var a=e.$keyboardNavigation._minicalendars;for(var i=0;i<a.length;i++){if(this.isChildOf(t,a[i]))return true}return false};e.$keyboardNavigation.isChildOf=function(e,t){while(e&&e!==t){e=e.parentNode}return!!(e===t)};e.$keyboardNavigation.patchMinicalendar=function(){var t=e.$keyboardNavigation.dispatcher;function a(a){var i=a.target;t.enable();t.setActiveNode(new e.$keyboardNavigation.MinicalButton(i,0))}function i(a){var i=a.target||a.srcElement;var n=e._locate_css(a,"dhx_cal_prev_button",false);var r=e._locate_css(a,"dhx_cal_next_button",false);var o=e._locate_css(a,"dhx_year_body",false);var d=0;var s=0;if(o){var l;var u;var c=i;while(c&&c.tagName.toLowerCase()!="td"){c=c.parentNode}if(c){u=c;l=u.parentNode}if(l&&u){var f=l.parentNode.querySelectorAll("tr");for(var v=0;v<f.length;v++){if(f[v]==l){d=v;break}}var h=l.querySelectorAll("td");for(var v=0;v<h.length;v++){if(h[v]==u){s=v;break}}}}var _=a.currentTarget;t.delay(function(){if(n||r||o){var a;if(n){a=new e.$keyboardNavigation.MinicalButton(_,0);t.setActiveNode(new e.$keyboardNavigation.MinicalButton(_,0))}else if(r){a=new e.$keyboardNavigation.MinicalButton(_,1)}else if(o){a=new e.$keyboardNavigation.MinicalCell(_,d,s)}if(a){t.enable();if(a.isValid()){t.activeNode=null;t.setActiveNode(a)}}}})}if(e.renderCalendar){var n=e.renderCalendar;e.renderCalendar=function(){var r=n.apply(this,arguments);var o=e.$keyboardNavigation._minicalendars;e.eventRemove(r,"click",i);e.event(r,"click",i);e.eventRemove(r,"focus",a);e.event(r,"focus",a);var d=false;for(var s=0;s<o.length;s++){if(o[s]==r){d=true;break}}if(!d)o.push(r);if(t.isEnabled()){var l=t.getActiveNode();if(l&&l.container==r){t.focusNode(l)}else{r.setAttribute("tabindex","0")}}else{r.setAttribute("tabindex","0")}return r}}if(e.destroyCalendar){var r=e.destroyCalendar;e.destroyCalendar=function(t,i){t=t||(e._def_count?e._def_count.firstChild:null);var n=r.apply(this,arguments);if(!t||!t.parentNode){var o=e.$keyboardNavigation._minicalendars;for(var d=0;d<o.length;d++){if(o[d]==t){e.eventRemove(o[d],"focus",a);o.splice(d,1);d--}}}return n}}};var t=e.$keyboardNavigation.dispatcher;e.$keyboardNavigation.attachSchedulerHandlers();if(e.renderCalendar){e.$keyboardNavigation.patchMinicalendar()}else{var a=e.attachEvent("onSchedulerReady",function(){e.detachEvent(a);e.$keyboardNavigation.patchMinicalendar()})}function i(){if(!e.config.key_nav)return;var t;var a=document.activeElement;if(!a||e._locate_css(a,"dhx_cal_quick_info",false)){t=false}else{t=e.$keyboardNavigation.isChildOf(a,e.$container)||e.$keyboardNavigation.isMinical(a)}return t}function n(e){if(e&&!t.isEnabled()){t.enable()}else if(!e&&t.isEnabled()){t.disable()}}setInterval(function(){if(!e.$container||!e.$keyboardNavigation.isChildOf(e.$container,document.body)){return}var a=i();if(a){n(a)}else if(!a&&t.isEnabled()){setTimeout(function(){if(e.config.key_nav){n(i())}else{e.$container.removeAttribute("tabindex")}},100)}},500)})()}if(window.Scheduler){window.Scheduler.plugin(e)}else{e(window.scheduler)}})();