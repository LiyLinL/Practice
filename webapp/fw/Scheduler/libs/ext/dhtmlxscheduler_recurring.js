/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.config.occurrence_timestamp_in_utc=false;e.config.recurring_workdays=[1,2,3,4,5];e.form_blocks["recurring"]={_get_node:function(e){if(typeof e=="string")e=document.getElementById(e);if(e.style.display=="none")e.style.display="";return e},_outer_html:function(e){return e.outerHTML||t(e);function t(e){var t=document.createElement("div"),r;t.appendChild(e.cloneNode(true));r=t.innerHTML;t=null;return r}},render:function(t){if(t.form){var r=e.form_blocks["recurring"];var a=r._get_node(t.form);var n=r._outer_html(a);a.style.display="none";return n}var _=e.locale.labels;return'<div class="dhx_form_repeat"> '+"<form> "+'<div class="dhx_repeat_left"> '+'<label><input class="dhx_repeat_radio" type="radio" name="repeat" value="day" />'+_.repeat_radio_day+"</label><br /> "+'<label><input class="dhx_repeat_radio" type="radio" name="repeat" value="week"/>'+_.repeat_radio_week+"</label><br /> "+'<label><input class="dhx_repeat_radio" type="radio" name="repeat" value="month" checked />'+_.repeat_radio_month+"</label><br /> "+'<label><input class="dhx_repeat_radio" type="radio" name="repeat" value="year" />'+_.repeat_radio_year+"</label> "+"</div> "+'<div class="dhx_repeat_divider">'+"</div> "+'<div class="dhx_repeat_center"> '+'<div style="display:none;" id="dhx_repeat_day"> '+'<label><input class="dhx_repeat_radio" type="radio" name="day_type" value="d"/>'+_.repeat_radio_day_type+"</label>"+'<label><input class="dhx_repeat_text" type="text" name="day_count" value="1" />'+_.repeat_text_day_count+"</label><br /> "+'<label><input class="dhx_repeat_radio" type="radio" name="day_type" checked value="w"/>'+_.repeat_radio_day_type2+"</label> "+"</div> "+'<div style="display:none;" id="dhx_repeat_week">'+"<label>"+_.repeat_week+'<input class="dhx_repeat_text" type="text" name="week_count" value="1" /></label>'+"<span>"+_.repeat_text_week_count+"</span><br /> "+'<table class="dhx_repeat_days"> '+"<tr> "+'<td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="1" />'+_.day_for_recurring[1]+"</label><br /> "+'<label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="4" />'+_.day_for_recurring[4]+"</label> </td> "+'<td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="2" />'+_.day_for_recurring[2]+"</label><br /> "+'<label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="5" />'+_.day_for_recurring[5]+"</label> </td> "+'<td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="3" />'+_.day_for_recurring[3]+"</label><br /> "+'<label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="6" />'+_.day_for_recurring[6]+"</label> </td> "+'<td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="0" />'+_.day_for_recurring[0]+"</label><br /><br /> </td> "+"</tr> "+"</table> "+"</div> "+'<div id="dhx_repeat_month"> '+'<label class = "dhx_repeat_month_label"><input class="dhx_repeat_radio" type="radio" name="month_type" value="d"/>'+_.repeat_radio_month_type+"</label>"+'<label><input class="dhx_repeat_text" type="text" name="month_day" value="1" />'+_.repeat_text_month_day+"</label>"+'<label><input class="dhx_repeat_text" type="text" name="month_count" value="1" />'+_.repeat_text_month_count+"</label><br /> "+'<label class = "dhx_repeat_month_label"><input class="dhx_repeat_radio" type="radio" name="month_type" checked value="w"/>'+_.repeat_radio_month_start+"</label>"+'<input class="dhx_repeat_text" type="text" name="month_week2" value="1" />'+"<label>"+'<select name="month_day2">'+'\t<option value="1" selected >'+e.locale.date.day_full[1]+'<option value="2">'+e.locale.date.day_full[2]+'<option value="3">'+e.locale.date.day_full[3]+'<option value="4">'+e.locale.date.day_full[4]+'<option value="5">'+e.locale.date.day_full[5]+'<option value="6">'+e.locale.date.day_full[6]+'<option value="0">'+e.locale.date.day_full[0]+"</select>"+_.repeat_text_month_count2_before+"</label>"+'<label><input class="dhx_repeat_text" type="text" name="month_count2" value="1" />'+_.repeat_text_month_count2_after+"</label><br /> "+"</div> "+'<div style="display:none;" id="dhx_repeat_year"> '+'<label class = "dhx_repeat_year_label"><input class="dhx_repeat_radio" type="radio" name="year_type" value="d"/>'+_.repeat_radio_day_type+"</label>"+'<label><input class="dhx_repeat_text" type="text" name="year_day" value="1" />'+_.repeat_text_year_day+"</label>"+"<label>"+'<select name="year_month">'+'<option value="0" selected >'+_.month_for_recurring[0]+'<option value="1">'+_.month_for_recurring[1]+'<option value="2">'+_.month_for_recurring[2]+'<option value="3">'+_.month_for_recurring[3]+'<option value="4">'+_.month_for_recurring[4]+'<option value="5">'+_.month_for_recurring[5]+'<option value="6">'+_.month_for_recurring[6]+'<option value="7">'+_.month_for_recurring[7]+'<option value="8">'+_.month_for_recurring[8]+'<option value="9">'+_.month_for_recurring[9]+'<option value="10">'+_.month_for_recurring[10]+'<option value="11">'+_.month_for_recurring[11]+"</select>"+_.select_year_month+"</label><br /> "+'<label class = "dhx_repeat_year_label"><input class="dhx_repeat_radio" type="radio" name="year_type" checked value="w"/>'+_.repeat_year_label+"</label>"+'<input class="dhx_repeat_text" type="text" name="year_week2" value="1" />'+'<select name="year_day2">'+'<option value="1" selected >'+e.locale.date.day_full[1]+'<option value="2">'+e.locale.date.day_full[2]+'<option value="3">'+e.locale.date.day_full[3]+'<option value="4">'+e.locale.date.day_full[4]+'<option value="5">'+e.locale.date.day_full[5]+'<option value="6">'+e.locale.date.day_full[6]+'<option value="7">'+e.locale.date.day_full[0]+"</select>"+_.select_year_day2+'<select name="year_month2">'+'<option value="0" selected >'+_.month_for_recurring[0]+'<option value="1">'+_.month_for_recurring[1]+'<option value="2">'+_.month_for_recurring[2]+'<option value="3">'+_.month_for_recurring[3]+'<option value="4">'+_.month_for_recurring[4]+'<option value="5">'+_.month_for_recurring[5]+'<option value="6">'+_.month_for_recurring[6]+'<option value="7">'+_.month_for_recurring[7]+'<option value="8">'+_.month_for_recurring[8]+'<option value="9">'+_.month_for_recurring[9]+'<option value="10">'+_.month_for_recurring[10]+'<option value="11">'+_.month_for_recurring[11]+"</select><br /> "+"</div> "+"</div> "+'<div class="dhx_repeat_divider">'+"</div> "+'<div class="dhx_repeat_right"> '+'<label><input class="dhx_repeat_radio" type="radio" name="end" checked/>'+_.repeat_radio_end+"</label><br /> "+'<label><input class="dhx_repeat_radio" type="radio" name="end" />'+_.repeat_radio_end2+"</label>"+'<input class="dhx_repeat_text" type="text" name="occurences_count" value="1" />'+_.repeat_text_occurences_count+"<br /> "+'<label><input class="dhx_repeat_radio" type="radio" name="end" />'+_.repeat_radio_end3+"</label>"+'<input class="dhx_repeat_date" type="text" name="date_of_end" value="'+e.config.repeat_date_of_end+'" /><br /> '+"</div> "+"</form> "+"</div> "+'<div style="clear:both"> '+"</div>"},_ds:{},_get_form_node:function(e,t,r){var a=e[t];if(!a)return null;if(a.nodeName)return a;if(a.length){for(var n=0;n<a.length;n++){if(a[n].value==r)return a[n]}}},_get_node_value:function(e,t,r){var a=e[t];if(!a)return"";if(a.length){if(r){var n=[];for(var _=0;_<a.length;_++)if(a[_].checked)n.push(a[_].value);return n}else{for(var _=0;_<a.length;_++)if(a[_].checked)return a[_].value}}if(a.value)return!r?a.value:[a.value]},_get_node_numeric_value:function(t,r){var a=e.form_blocks["recurring"]._get_node_value(t,r);return a*1||0},_set_node_value:function(e,t,r){var a=e[t];if(!a)return;if(a.name==t){a.value=r}else if(a.length){var n=typeof r=="object";for(var _=0;_<a.length;_++)if(n||a[_].value==r){a[_].checked=n?!!r[a[_].value]:!!r}}},_init_set_value:function(t,r,a){var n=e.form_blocks["recurring"];var _=n._get_node_value;var i=n._set_node_value;e.form_blocks["recurring"]._ds={start:a.start_date,end:a._end_date};var o=e.date.str_to_date(e.config.repeat_date);var l=function(t){var r=o(t);if(e.config.include_end_by)r=e.date.add(r,1,"day");return r};var s=e.date.date_to_str(e.config.repeat_date);var d=t.getElementsByTagName("FORM")[0];var c={};function u(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.name){if(!c[r.name]){c[r.name]=r}else if(c[r.name].nodeType){var a=c[r.name];c[r.name]=[a,r]}else{c[r.name].push(r)}}}}u(d.getElementsByTagName("INPUT"));u(d.getElementsByTagName("SELECT"));if(!e.config.repeat_date_of_end){var v=e.date.date_to_str(e.config.repeat_date);e.config.repeat_date_of_end=v(e.date.add(e._currentDate(),30,"day"))}i(c,"date_of_end",e.config.repeat_date_of_end);var p=function(e){return document.getElementById(e)||{style:{}}};function h(){p("dhx_repeat_day").style.display="none";p("dhx_repeat_week").style.display="none";p("dhx_repeat_month").style.display="none";p("dhx_repeat_year").style.display="none";p("dhx_repeat_"+this.value).style.display="block";e.setLightboxSize()}function f(t){var r=[_(c,"repeat")];y[r[0]](r,t);while(r.length<5)r.push("");var a="";var n=g(c);if(n=="no"){t.end=new Date(9999,1,1);a="no"}else if(n=="date_of_end"){t.end=l(_(c,"date_of_end"))}else{e.transpose_type(r.join("_"));a=Math.max(1,_(c,"occurences_count"));var i=0;t.end=e.date.add(new Date(t.start),a+i,r.join("_"))}return r.join("_")+"#"+a}function g(e){var t=e["end"];if(t.length){for(var r=0;r<t.length;r++){if(t[r].checked){if(t[r].value&&t[r].value!="on"){return t[r].value}else{if(!r){return"no"}else if(r==2){return"date_of_end"}else{return"occurences_count"}}}}}else{if(t.value)return t.value}return"no"}function m(e,t){var r=e["end"];if(r.length){var a=!!r[0].value&&r[0].value!="on";if(a){for(var n=0;n<r.length;n++){if(r[n].value==t)r[n].checked=true}}else{var _=0;switch(t){case"no":_=0;break;case"date_of_end":_=2;break;default:_=1;break}r[_].checked=true}}else{r.value=t}}e.form_blocks["recurring"]._get_repeat_code=f;var y={month:function(t,r){var a=e.form_blocks["recurring"]._get_node_value;var n=e.form_blocks["recurring"]._get_node_numeric_value;if(a(c,"month_type")=="d"){t.push(Math.max(1,n(c,"month_count")));r.start.setDate(a(c,"month_day"))}else{t.push(Math.max(1,n(c,"month_count2")));t.push(a(c,"month_day2"));t.push(Math.max(1,n(c,"month_week2")));if(!e.config.repeat_precise){r.start.setDate(1)}}r._start=true},week:function(t,r){var a=e.form_blocks["recurring"]._get_node_value;var n=e.form_blocks["recurring"]._get_node_numeric_value;t.push(Math.max(1,n(c,"week_count")));t.push("");t.push("");var _=[];var i=a(c,"week_day",true);var o=r.start.getDay();var l=false;for(var s=0;s<i.length;s++){_.push(i[s]);l=l||i[s]==o}if(!_.length){_.push(o);l=true}_.sort();if(!e.config.repeat_precise){r.start=e.date.week_start(r.start);r._start=true}else if(!l){e.transpose_day_week(r.start,_,1,7);r._start=true}t.push(_.join(","))},day:function(t){var r=e.form_blocks["recurring"]._get_node_value;var a=e.form_blocks["recurring"]._get_node_numeric_value;if(r(c,"day_type")=="d"){t.push(Math.max(1,a(c,"day_count")))}else{t.push("week");t.push(1);t.push("");t.push("");t.push(e.config.recurring_workdays.join(","));t.splice(0,1)}},year:function(t,r){var a=e.form_blocks["recurring"]._get_node_value;if(a(c,"year_type")=="d"){t.push("1");r.start.setMonth(0);r.start.setDate(a(c,"year_day"));r.start.setMonth(a(c,"year_month"))}else{t.push("1");t.push(a(c,"year_day2"));t.push(a(c,"year_week2"));r.start.setDate(1);r.start.setMonth(a(c,"year_month2"))}r._start=true}};var b={week:function(t,r){var a=e.form_blocks["recurring"]._set_node_value;a(c,"week_count",t[1]);var n=t[4].split(",");var _={};for(var i=0;i<n.length;i++)_[n[i]]=true;a(c,"week_day",_)},month:function(t,r){var a=e.form_blocks["recurring"]._set_node_value;if(t[2]===""){a(c,"month_type","d");a(c,"month_count",t[1]);a(c,"month_day",r.start.getDate())}else{a(c,"month_type","w");a(c,"month_count2",t[1]);a(c,"month_week2",t[3]);a(c,"month_day2",t[2])}},day:function(t,r){var a=e.form_blocks["recurring"]._set_node_value;a(c,"day_type","d");a(c,"day_count",t[1])},year:function(t,r){var a=e.form_blocks["recurring"]._set_node_value;if(t[2]===""){a(c,"year_type","d");a(c,"year_day",r.start.getDate());a(c,"year_month",r.start.getMonth())}else{a(c,"year_type","w");a(c,"year_week2",t[3]);a(c,"year_day2",t[2]);a(c,"year_month2",r.start.getMonth())}}};function k(t,r){var a=e.form_blocks["recurring"]._set_node_value;var n=t.split("#");t=n[0].split("_");b[t[0]](t,r);switch(n[1]){case"no":m(c,"no");break;case"":m(c,"date_of_end");var _=r.end;if(e.config.include_end_by){_=e.date.add(_,-1,"day")}a(c,"date_of_end",s(_));break;default:m(c,"occurences_count");a(c,"occurences_count",n[1]);break}a(c,"repeat",t[0]);var i=e.form_blocks["recurring"]._get_form_node(c,"repeat",t[0]);if(i.nodeName=="SELECT"&&i.onchange){i.onchange()}else if(i.onclick){i.onclick()}}function x(e,t){}e.form_blocks["recurring"]._set_repeat_code=k;for(var w=0;w<d.elements.length;w++){var E=d.elements[w];switch(E.name){case"repeat":if(E.nodeName=="SELECT"){E.onchange=h}else{E.onclick=h}break}}e._lightbox._rec_init_done=true},set_value:function(t,r,a){var n=e.form_blocks["recurring"];if(!e._lightbox._rec_init_done)n._init_set_value(t,r,a);t.open=!a.rec_type;t.blocked=this._is_modified_occurence(a);var _=n._ds;_.start=a.start_date;_.end=a._end_date;n._toggle_block();if(r)n._set_repeat_code(r,_)},get_value:function(t,r){if(t.open){var a=e.form_blocks["recurring"]._ds;var n={};this.formSection("time").getValue(n);a.start=n.start_date;r.rec_type=e.form_blocks["recurring"]._get_repeat_code(a);if(a._start){r.start_date=new Date(a.start);r._start_date=new Date(a.start);a._start=false}else r._start_date=null;r._end_date=a.end;r.rec_pattern=r.rec_type.split("#")[0]}else{r.rec_type=r.rec_pattern="";r._end_date=r.end_date}return r.rec_type},_get_button:function(){var t=e.formSection("recurring").header;return t.firstChild.firstChild},_get_form:function(){return e.formSection("recurring").node},open:function(){var t=e.form_blocks.recurring;var r=t._get_form();if(!r.open)t._toggle_block()},close:function(){var t=e.form_blocks.recurring;var r=t._get_form();if(r.open)t._toggle_block()},_toggle_block:function(){var t=e.form_blocks.recurring;var r=t._get_form(),a=t._get_button();if(!r.open&&!r.blocked){r.style.height="auto";if(a){a.style.backgroundPosition="-5px 0px";a.nextSibling.innerHTML=e.locale.labels.button_recurring_open}}else{r.style.height="0px";if(a){a.style.backgroundPosition="-5px 20px";a.nextSibling.innerHTML=e.locale.labels.button_recurring}}r.open=!r.open;e.setLightboxSize()},focus:function(e){},button_click:function(t,r,a,n){var _=e.form_blocks.recurring;var n=_._get_form();if(!n.blocked)e.form_blocks.recurring._toggle_block()}};e._rec_markers={};e._rec_markers_pull={};e._add_rec_marker=function(e,t){e._pid_time=t;this._rec_markers[e.id]=e;if(!this._rec_markers_pull[e.event_pid])this._rec_markers_pull[e.event_pid]={};this._rec_markers_pull[e.event_pid][t]=e};e._get_rec_marker=function(e,t){var r=this._rec_markers_pull[t];if(r)return r[e];return null};e._get_rec_markers=function(e){return this._rec_markers_pull[e]||[]};e._rec_temp=[];(function(){var t=e.addEvent;e.addEvent=function(r,a,n,_,i){var o=t.apply(this,arguments);if(o&&e.getEvent(o)){var l=e.getEvent(o);if(this._is_modified_occurence(l))e._add_rec_marker(l,l.event_length*1e3);if(l.rec_type)l.rec_pattern=l.rec_type.split("#")[0]}return o}})();e.attachEvent("onEventIdChange",function(t,r){if(this._ignore_call)return;this._ignore_call=true;if(e._rec_markers[t]){e._rec_markers[r]=e._rec_markers[t];delete e._rec_markers[t]}if(e._rec_markers_pull[t]){e._rec_markers_pull[r]=e._rec_markers_pull[t];delete e._rec_markers_pull[t]}for(var a=0;a<this._rec_temp.length;a++){var n=this._rec_temp[a];if(n.event_pid==t){n.event_pid=r;this.changeEventId(n.id,r+"#"+n.id.split("#")[1])}}for(var a in this._rec_markers){var n=this._rec_markers[a];if(n.event_pid==t){n.event_pid=r;n._pid_changed=true}}var _=e._rec_markers[r];if(_&&_._pid_changed){delete _._pid_changed;setTimeout(function(){e.callEvent("onEventChanged",[r,e.getEvent(r)])},1)}delete this._ignore_call});e.attachEvent("onConfirmedBeforeEventDelete",function(e){var t=this.getEvent(e);if(this._is_virtual_event(e)||this._is_modified_occurence(t)&&t.rec_type&&t.rec_type!="none"){e=e.split("#");var r=this.uid();var a=e[1]?e[1]:t._pid_time/1e3;var n=this._copy_event(t);n.id=r;n.event_pid=t.event_pid||e[0];var _=a;n.event_length=_;n.rec_type=n.rec_pattern="none";this.addEvent(n);this._add_rec_marker(n,_*1e3)}else{if(t.rec_type&&this._lightbox_id)this._roll_back_dates(t);var i=this._get_rec_markers(e);for(var o in i){if(i.hasOwnProperty(o)){e=i[o].id;if(this.getEvent(e))this.deleteEvent(e,true)}}}return true});e.attachEvent("onEventDeleted",function(t,r){if(!this._is_virtual_event(t)&&this._is_modified_occurence(r)){if(!e._events[t]){r.rec_type=r.rec_pattern="none";this.setEvent(t,r)}}});e.attachEvent("onEventChanged",function(e,t){if(this._loading)return true;var r=this.getEvent(e);if(this._is_virtual_event(e)){var e=e.split("#");var a=this.uid();this._not_render=true;var n=this._copy_event(t);n.id=a;n.event_pid=e[0];var _=e[1];n.event_length=_;n.rec_type=n.rec_pattern="";this._add_rec_marker(n,_*1e3);this.addEvent(n);this._not_render=false}else{if(r.rec_type&&this._lightbox_id)this._roll_back_dates(r);var i=this._get_rec_markers(e);for(var o in i){if(i.hasOwnProperty(o)){delete this._rec_markers[i[o].id];this.deleteEvent(i[o].id,true)}}delete this._rec_markers_pull[e];var l=false;for(var s=0;s<this._rendered.length;s++){if(this._rendered[s].getAttribute("event_id")==e)l=true}if(!l)this._select_id=null}return true});e.attachEvent("onEventAdded",function(e){if(!this._loading){var t=this.getEvent(e);if(t.rec_type&&!t.event_length)this._roll_back_dates(t)}return true});e.attachEvent("onEventSave",function(e,t,r){var a=this.getEvent(e);if(!a.rec_type&&t.rec_type&&!this._is_virtual_event(e))this._select_id=null;return true});e.attachEvent("onEventCreated",function(e){var t=this.getEvent(e);if(!t.rec_type)t.rec_type=t.rec_pattern=t.event_length=t.event_pid="";return true});e.attachEvent("onEventCancel",function(e){var t=this.getEvent(e);if(t.rec_type){this._roll_back_dates(t);this.render_view_data()}});e._roll_back_dates=function(e){e.event_length=(e.end_date.valueOf()-e.start_date.valueOf())/1e3;e.end_date=e._end_date;if(e._start_date){e.start_date.setMonth(0);e.start_date.setDate(e._start_date.getDate());e.start_date.setMonth(e._start_date.getMonth());e.start_date.setFullYear(e._start_date.getFullYear())}};e._is_virtual_event=function(e){return e.toString().indexOf("#")!=-1};e._is_modified_occurence=function(e){return e.event_pid&&e.event_pid!="0"};e._validId=function(e){return!this._is_virtual_event(e)};e.showLightbox_rec=e.showLightbox;e.showLightbox=function(t){var r=this.locale;var a=e.config.lightbox_recurring;var n=this.getEvent(t);var _=n.event_pid;var i=this._is_virtual_event(t);if(i)_=t.split("#")[0];var o=function(t){var r=e.getEvent(t);r._end_date=r.end_date;r.end_date=new Date(r.start_date.valueOf()+r.event_length*1e3);return e.showLightbox_rec(t)};if((_||_*1===0)&&n.rec_type){return o(t)}if(!_||_==="0"||(!r.labels.confirm_recurring||a=="instance"||a=="series"&&!i)){return this.showLightbox_rec(t)}if(a=="ask"){var l=this;dhtmlx.modalbox({text:r.labels.confirm_recurring,title:r.labels.title_confirm_recurring,width:"500px",position:"middle",buttons:[r.labels.button_edit_series,r.labels.button_edit_occurrence,r.labels.icon_cancel],callback:function(e){switch(+e){case 0:return o(_);case 1:return l.showLightbox_rec(t);case 2:return}}})}else{o(_)}};e.get_visible_events_rec=e.get_visible_events;e.get_visible_events=function(e){for(var t=0;t<this._rec_temp.length;t++)delete this._events[this._rec_temp[t].id];this._rec_temp=[];var r=this.get_visible_events_rec(e);var a=[];for(var t=0;t<r.length;t++){if(r[t].rec_type){if(r[t].rec_pattern!="none")this.repeat_date(r[t],a)}else a.push(r[t])}return a};(function(){var t=e.isOneDayEvent;e.isOneDayEvent=function(e){if(e.rec_type)return true;return t.call(this,e)};var r=e.updateEvent;e.updateEvent=function(t){var a=e.getEvent(t);if(a&&a.rec_type){a.rec_pattern=(a.rec_type||"").split("#")[0]}if(a&&a.rec_type&&!this._is_virtual_event(t)){e.update_view()}else{r.call(this,t)}}})();e.transponse_size={day:1,week:7,month:1,year:12};e.date.day_week=function(e,t,r){e.setDate(1);r=(r-1)*7;var a=e.getDay();var n=t*1+r-a+1;e.setDate(n<=r?n+7:n)};e.transpose_day_week=function(t,r,a,n,_){var i=(t.getDay()||(e.config.start_on_monday?7:0))-a;for(var o=0;o<r.length;o++){if(r[o]>i)return t.setDate(t.getDate()+r[o]*1-i-(n?a:_))}this.transpose_day_week(t,r,a+n,null,a)};e.transpose_type=function(t){var r="transpose_"+t;if(!this.date[r]){var a=t.split("_");var n=60*60*24*1e3;var _="add_"+t;var i=this.transponse_size[a[0]]*a[1];if(a[0]=="day"||a[0]=="week"){var o=null;if(a[4]){o=a[4].split(",");if(e.config.start_on_monday){for(var l=0;l<o.length;l++)o[l]=o[l]*1||7;o.sort()}}this.date[r]=function(t,r){var a=Math.floor((r.valueOf()-t.valueOf())/(n*i));if(a>0)t.setDate(t.getDate()+a*i);if(o)e.transpose_day_week(t,o,1,i)};this.date[_]=function(t,r){var a=new Date(t.valueOf());if(o){for(var n=0;n<r;n++)e.transpose_day_week(a,o,0,i)}else a.setDate(a.getDate()+r*i);return a}}else if(a[0]=="month"||a[0]=="year"){this.date[r]=function(t,r){var n=Math.ceil((r.getFullYear()*12+r.getMonth()*1+1-(t.getFullYear()*12+t.getMonth()*1+1))/i-1);if(n>=0)t.setMonth(t.getMonth()+n*i);if(a[3])e.date.day_week(t,a[2],a[3])};this.date[_]=function(t,r){var n=new Date(t.valueOf());n.setMonth(n.getMonth()+r*i);if(a[3])e.date.day_week(n,a[2],a[3]);return n}}}};e.repeat_date=function(t,r,a,n,_,i){n=n||this._min_date;_=_||this._max_date;var o=i||-1;var l=new Date(t.start_date.valueOf());var s=l.getHours();var d=0;if(!t.rec_pattern&&t.rec_type)t.rec_pattern=t.rec_type.split("#")[0];this.transpose_type(t.rec_pattern);e.date["transpose_"+t.rec_pattern](l,n);while(l<t.start_date||e._fix_daylight_saving_date(l,n,t,l,new Date(l.valueOf()+t.event_length*1e3)).valueOf()<=n.valueOf()||l.valueOf()+t.event_length*1e3<=n.valueOf())l=this.date.add(l,1,t.rec_pattern);while(l<_&&l<t.end_date&&(o<0||d<o)){l.setHours(s);var c=e.config.occurrence_timestamp_in_utc?Date.UTC(l.getFullYear(),l.getMonth(),l.getDate(),l.getHours(),l.getMinutes(),l.getSeconds()):l.valueOf();var u=this._get_rec_marker(c,t.id);if(!u){var v=new Date(l.valueOf()+t.event_length*1e3);var p=this._copy_event(t);p.text=t.text;p.start_date=l;p.event_pid=t.id;p.id=t.id+"#"+Math.ceil(c/1e3);p.end_date=v;p.end_date=e._fix_daylight_saving_date(p.start_date,p.end_date,t,l,p.end_date);p._timed=this.isOneDayEvent(p);if(!p._timed&&!this._table_view&&!this.config.multi_day)return;r.push(p);if(!a){this._events[p.id]=p;this._rec_temp.push(p)}d++}else if(a){if(u.rec_type!="none"){d++}r.push(u)}l=this.date.add(l,1,t.rec_pattern)}};e._fix_daylight_saving_date=function(e,t,r,a,n){var _=e.getTimezoneOffset()-t.getTimezoneOffset();if(_){if(_>0){return new Date(a.valueOf()+r.event_length*1e3-_*60*1e3)}else{return new Date(t.valueOf()-_*60*1e3)}}return new Date(n.valueOf())};e.getRecDates=function(t,r){var a=typeof t=="object"?t:e.getEvent(t);var n=[];r=r||100;if(!a.rec_type){return[{start_date:a.start_date,end_date:a.end_date}]}if(a.rec_type=="none"){return[]}e.repeat_date(a,n,true,a.start_date,a.end_date,r);var _=[];for(var i=0;i<n.length;i++){if(n[i].rec_type!="none"){_.push({start_date:n[i].start_date,end_date:n[i].end_date})}}return _};e.getEvents=function(e,t){var r=[];for(var a in this._events){var n=this._events[a];if(n&&n.start_date<t&&n.end_date>e){if(n.rec_pattern){if(n.rec_pattern=="none")continue;var _=[];this.repeat_date(n,_,true,e,t);for(var i=0;i<_.length;i++){if(!_[i].rec_pattern&&_[i].start_date<t&&_[i].end_date>e&&!this._rec_markers[_[i].id]){r.push(_[i])}}}else if(!this._is_virtual_event(n.id)){r.push(n)}}}return r};e.config.repeat_date="%m.%d.%Y";e.config.lightbox.sections=[{name:"description",map_to:"text",type:"textarea",focus:true},{name:"recurring",type:"recurring",map_to:"rec_type",button:"recurring"},{name:"time",height:72,type:"time",map_to:"auto"}];e._copy_dummy=function(e){var t=new Date(this.start_date);var r=new Date(this.end_date);this.start_date=t;this.end_date=r;this.event_length=this.event_pid=this.rec_pattern=this.rec_type=null};e.config.include_end_by=false;e.config.lightbox_recurring="ask";e.attachEvent("onClearAll",function(){e._rec_markers={};e._rec_markers_pull={};e._rec_temp=[]})});