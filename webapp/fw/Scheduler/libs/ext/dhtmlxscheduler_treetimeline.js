/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.attachEvent("onTimelineCreated",function(t){if(t.render=="tree"){t.y_unit_original=t.y_unit;t.y_unit=e._getArrayToDisplay(t.y_unit_original);e.attachEvent("onOptionsLoadStart",function(){t.y_unit=e._getArrayToDisplay(t.y_unit_original)});e.form_blocks[t.name]={render:function(e){var t="<div class='dhx_section_timeline' style='overflow: hidden; height: "+e.height+"px'></div>";return t},set_value:function(t,i,n,r){var a=e._getArrayForSelect(e.matrix[r.type].y_unit_original,r.type);t.innerHTML="";var l=document.createElement("select");t.appendChild(l);var o=t.getElementsByTagName("select")[0];if(!o._dhx_onchange&&r.onchange){o.onchange=r.onchange;o._dhx_onchange=true}for(var _=0;_<a.length;_++){var d=document.createElement("option");d.value=a[_].key;if(d.value==n[e.matrix[r.type].y_property])d.selected=true;d.innerHTML=a[_].label;o.appendChild(d)}},get_value:function(e,t,i){return e.firstChild.value},focus:function(e){}}}});e.attachEvent("onBeforeSectionRender",function(t,i,n){var r={};if(t=="tree"){var a;var l,o,_;var d;var c;_="dhx_matrix_scell";if(i.children){a=n.folder_dy||n.dy;if(n.folder_dy&&!n.section_autoheight){o="height:"+n.folder_dy+"px;"}l="dhx_row_folder";_+=" folder";if(i.open){_+=" opened"}else{_+=" closed"}d="<div class='dhx_scell_expand'>"+(i.open?"-":"+")+"</div>";c=n.folder_events_available?"dhx_data_table folder_events":"dhx_data_table folder"}else{a=n.dy;l="dhx_row_item";_+=" item";d="";c="dhx_data_table"}_+=e.templates[n.name+"_scaley_class"](i.key,i.label,i)?" "+e.templates[n.name+"_scaley_class"](i.key,i.label,i):"";var f="<div class='dhx_scell_level"+i.level+"'>"+d+"<div class='dhx_scell_name'>"+(e.templates[n.name+"_scale_label"](i.key,i.label,i)||i.label)+"</div></div>";r={height:a,style_height:o,tr_className:l,td_className:_,td_content:f,table_className:c}}return r});var t;e.attachEvent("onBeforeEventChanged",function(i,n,r){if(e._isRender("tree")){var a=e._get_event_sections?e._get_event_sections(i):[i[e.matrix[e._mode].y_property]];for(var l=0;l<a.length;l++){var o=e.getSection(a[l]);if(o&&!!o.children&&!e.matrix[e._mode].folder_events_available){if(!r){i[e.matrix[e._mode].y_property]=t}return false}}}return true});e.attachEvent("onBeforeDrag",function(i,n,r){if(e._isRender("tree")){var a=e._locate_cell_timeline(r);var l;if(a){l=e.matrix[e._mode].y_unit[a.y].key;if(!!e.matrix[e._mode].y_unit[a.y].children&&!e.matrix[e._mode].folder_events_available){return false}}var o=e.getEvent(i);var _=e.matrix[e._mode].y_property;t=o&&o[_]?o[_]:l}return true});e._getArrayToDisplay=function(t){var i=[];var n=function(t,r,a,l){var o=r||0;for(var _=0;_<t.length;_++){var d=t[_];d.level=o;d.$parent=a||null;if(!!d.children&&typeof d.key=="undefined"){d.key=e.uid()}if(!l){i.push(d)}if(d.children){n(d.children,o+1,d.key,l||!d.open)}}};n(t);return i};e._getArrayForSelect=function(t,i){var n=[];var r=function(t){for(var a=0;a<t.length;a++){if(e.matrix[i].folder_events_available){n.push(t[a])}else{if(!t[a].children){n.push(t[a])}}if(t[a].children)r(t[a].children,i)}};r(t);return n};e._toggleFolderDisplay=function(t,i,n){var r;var a=function(e,t,i,n){for(var l=0;l<t.length;l++){if((t[l].key==e||n)&&t[l].children){t[l].open=typeof i!="undefined"?i:!t[l].open;r=true;if(!n&&r)break}if(t[l].children){a(e,t[l].children,i,n)}}};var l=e.getSection(t);if(typeof i=="undefined"&&!n){i=!l.open}if(e.callEvent("onBeforeFolderToggle",[l,i,n])){a(t,e.matrix[e._mode].y_unit_original,i,n);e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original);e.callEvent("onOptionsLoad",[]);e.callEvent("onAfterFolderToggle",[l,i,n])}};e.attachEvent("onCellClick",function(t,i,n,r,a){if(e._isRender("tree")){if(!e.matrix[e._mode].folder_events_available){if(typeof e.matrix[e._mode].y_unit[i]!="undefined"&&!!e.matrix[e._mode].y_unit[i].children){e._toggleFolderDisplay(e.matrix[e._mode].y_unit[i].key)}}}});e.attachEvent("onYScaleClick",function(t,i,n){if(e._isRender("tree")){if(!!i.children){e._toggleFolderDisplay(i.key)}}});e.getSection=function(t){if(e._isRender("tree")){var i;var n=function(e,t){for(var r=0;r<t.length;r++){if(t[r].key==e)i=t[r];if(t[r].children)n(e,t[r].children)}};n(t,e.matrix[e._mode].y_unit_original);return i||null}};e.deleteSection=function(t){if(e._isRender("tree")){var i=false;var n=function(e,t){for(var r=0;r<t.length;r++){if(t[r].key==e){t.splice(r,1);i=true}if(i)break;if(t[r].children)n(e,t[r].children)}};n(t,e.matrix[e._mode].y_unit_original);e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original);e.callEvent("onOptionsLoad",[]);return i}};e.deleteAllSections=function(){if(e._isRender("tree")){e.matrix[e._mode].y_unit_original=[];e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original);e.callEvent("onOptionsLoad",[])}};e.addSection=function(t,i){if(e._isRender("tree")){var n=false;var r=function(e,t,a){if(!i){a.push(e);n=true}else{for(var l=0;l<a.length;l++){if(a[l].key==t&&!!a[l].children){a[l].children.push(e);n=true}if(n)break;if(a[l].children)r(e,t,a[l].children)}}};r(t,i,e.matrix[e._mode].y_unit_original);e.matrix[e._mode].y_unit=e._getArrayToDisplay(e.matrix[e._mode].y_unit_original);e.callEvent("onOptionsLoad",[]);return n}};e.openAllSections=function(){if(e._isRender("tree"))e._toggleFolderDisplay(1,true,true)};e.closeAllSections=function(){if(e._isRender("tree"))e._toggleFolderDisplay(1,false,true)};e.openSection=function(t){if(e._isRender("tree"))e._toggleFolderDisplay(t,true)};e.closeSection=function(t){if(e._isRender("tree"))e._toggleFolderDisplay(t,false)}});