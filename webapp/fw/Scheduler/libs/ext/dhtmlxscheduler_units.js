/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e._props={};e.createUnitsView=function(t,s,a,i,r,n,o){if(typeof t=="object"){a=t.list;s=t.property;i=t.size||0;r=t.step||1;n=t.skip_incorrect;o=t.days||1;t=t.name}e._props[t]={map_to:s,options:a,step:r,position:0,days:o};if(i>e._props[t].options.length){e._props[t]._original_size=i;i=0}e._props[t].size=i;e._props[t].skip_incorrect=n||false;e.date[t+"_start"]=e.date.day_start;e.templates[t+"_date"]=function(s,a){var i=e._props[t];if(!(i.days>1)){return e.templates.day_date(s)}else{return e.templates.week_date(s,a)}};function _(t){return Math.round((e._correct_shift(+t,1)-+e._min_date)/(60*60*24*1e3))}e._get_unit_index=function(e,t){var s=e.position||0;var a=_(t);var i=e.size||e.options.length;if(a>=i){a=a%i}return s+a};e.templates[t+"_scale_text"]=function(e,t,s){if(s.css){return"<span class='"+s.css+"'>"+t+"</span>"}else{return t}};e.templates[t+"_scale_date"]=function(s){var a=e._props[t];var i=a.options;if(!i.length)return"";var r=e._get_unit_index(a,s);var n=i[r];var o=_(s);var d=a.size||a.options.length;var p=e.date.add(e.getState().min_date,Math.floor(o/d),"day");return e.templates[t+"_scale_text"](n.key,n.label,n,p)};e.templates[t+"_second_scale_date"]=function(t){return e.templates.week_scale_date(t)};e.date["add_"+t]=function(s,a){return e.date.add(s,a*e._props[t].days,"day")};e.date["get_"+t+"_end"]=function(s){return e.date.add(s,(e._props[t].size||e._props[t].options.length)*e._props[t].days,"day")};e.attachEvent("onOptionsLoad",function(){var s=e._props[t];var a=s.order={};var i=s.options;for(var r=0;r<i.length;r++)a[i[r].key]=r;if(s._original_size&&s.size===0){s.size=s._original_size;delete s._original_size}if(s.size>i.length){s._original_size=s.size;s.position=0;s.size=0}else s.size=s._original_size||s.size;if(e._date&&e._mode==t)e.setCurrentView(e._date,e._mode)});e["mouse_"+t]=function(t){var s=e._props[this._mode];if(s){t=this._week_indexes_from_pos(t);if(!this._drag_event)this._drag_event={};if(this._drag_id&&this._drag_mode){this._drag_event._dhx_changed=true}if(this._drag_mode&&this._drag_mode=="new-size"){var a=e._get_event_sday(e._events[e._drag_id]);if(Math.floor(t.x/s.options.length)!=Math.floor(a/s.options.length))t.x=a}var i=s.size||s.options.length;var r=t.x%i;var n=Math.min(r+s.position,s.options.length-1);t.section=(s.options[n]||{}).key;t.x=Math.floor(t.x/i);var o=this.getEvent(this._drag_id);this._update_unit_section({view:s,event:o,pos:t})}t.force_redraw=true;return t};var d=false;function p(){if(!d){d=e.xy.scale_height;e.xy.scale_height=e.xy.scale_height*2}}function l(){if(d){e.xy.scale_height/=2;d=false}}e[t+"_view"]=function(t){var s=e._props[e._mode];if(t){if(s&&s.days>1){p()}else{l()}e._reset_scale()}else{l()}};e.callEvent("onOptionsLoad",[])};e._update_unit_section=function(e){var t=e.view,s=e.event,a=e.pos;if(s){s[t.map_to]=a.section}};e.scrollUnit=function(t){var s=e._props[this._mode];if(s){s.position=Math.min(Math.max(0,s.position+t),s.options.length-s.size);this.setCurrentView()}};(function(){var t=function(t){var s=e._props[e._mode];if(s&&s.order&&s.skip_incorrect){var a=[];for(var i=0;i<t.length;i++){if(typeof s.order[t[i][s.map_to]]!="undefined"){a.push(t[i])}}t.splice(0,t.length);t.push.apply(t,a)}return t};var s=e._pre_render_events_table;e._pre_render_events_table=function(e,a){e=t(e);return s.apply(this,[e,a])};var a=e._pre_render_events_line;e._pre_render_events_line=function(e,s){e=t(e);return a.apply(this,[e,s])};var i=function(t,s){if(t&&typeof t.order[s[t.map_to]]=="undefined"){var a=e;var i=24*60*60*1e3;var r=Math.floor((s.end_date-a._min_date)/i);if(t.options.length)s[t.map_to]=t.options[Math.min(r+t.position,t.options.length-1)].key;return true}};var r=e.is_visible_events;e.is_visible_events=function(t){var s=r.apply(this,arguments);if(s){var a=e._props[this._mode];if(a&&a.size){var i=a.order[t[a.map_to]];if(i<a.position||i>=a.size+a.position)return false}}return s};var n=e._process_ignores;e._process_ignores=function(t,s,a,i,r){if(!e._props[this._mode]){n.call(this,t,s,a,i,r);return}this._ignores={};this._ignores_detected=0;var o=e["ignore_"+this._mode];if(o){var _=e._props&&e._props[this._mode]?e._props[this._mode].size||e._props[this._mode].options.length:1;s/=_;var d=new Date(t);for(var p=0;p<s;p++){if(o(d)){var l=p*_,h=(p+1)*_;for(var c=l;c<h;c++){this._ignores_detected+=1;this._ignores[c]=true;if(r)s++}}d=e.date.add(d,i,a);if(e.date[a+"_start"])d=e.date[a+"_start"](d)}}};var o=e._reset_scale;e._reset_scale=function(){var t=e._props[this._mode];if(t){if(t.size&&t.position&&t.size+t.position>t.options.length){t.position=Math.max(0,t.options.length-t.size)}else if(!t.size){t.position=0}}var s=o.apply(this,arguments);if(t){this._max_date=this.date.add(this._min_date,t.days,"day");var a=this._els["dhx_cal_data"][0].childNodes;for(var i=0;i<a.length;i++)a[i].className=a[i].className.replace("_now","");var r=this._currentDate();if(r.valueOf()>=this._min_date&&r.valueOf()<this._max_date){var n=24*60*60*1e3;var _=Math.floor((r-e._min_date)/n);var d=t.size||t.options.length;var p=_*d;var l=p+d;for(i=p;i<l;i++){if(a[i])a[i].className=a[i].className.replace("dhx_scale_holder","dhx_scale_holder_now")}}if(t.size&&t.size<t.options.length){var h=this._els["dhx_cal_header"][0];var c=document.createElement("div");if(t.position){this._waiAria.headerButtonsAttributes(c,"");if(e.config.rtl){c.className="dhx_cal_next_button";c.style.cssText="left:auto; right:0px;top:2px;position:absolute;"}else{c.className="dhx_cal_prev_button";c.style.cssText="left:1px;top:2px;position:absolute;"}c.innerHTML="&nbsp;";h.firstChild.appendChild(c);c.onclick=function(){e.scrollUnit(t.step*-1)}}if(t.position+t.size<t.options.length){this._waiAria.headerButtonsAttributes(c,"");c=document.createElement("div");if(e.config.rtl){c.className="dhx_cal_prev_button";c.style.cssText="left:1px;top:2px;position:absolute;"}else{c.className="dhx_cal_next_button";c.style.cssText="left:auto; right:0px;top:2px;position:absolute;"}c.innerHTML="&nbsp;";h.lastChild.appendChild(c);c.onclick=function(){e.scrollUnit(t.step)}}}}return s};var _=e._get_view_end;e._get_view_end=function(){var t=e._props[this._mode];if(t&&t.days>1){var s=this._get_timeunit_start();return e.date.add(s,t.days,"day")}else{return _.apply(this,arguments)}};var d=e._render_x_header;e._render_x_header=function(t,s,a,i){var r=e._props[this._mode];if(!r||r.days<=1){return d.apply(this,arguments)}else if(r.days>1){var n=i.querySelector(".dhx_second_cal_header");if(!n){n=document.createElement("div");n.className="dhx_second_cal_header";i.appendChild(n)}var o=e.xy.scale_height;e.xy.scale_height=Math.ceil(o/2);d.call(this,t,s,a,n,Math.ceil(e.xy.scale_height));var _=r.size||r.options.length;if((t+1)%_===0){var p=document.createElement("div");p.className="dhx_scale_bar dhx_second_scale_bar";var l=this.date.add(this._min_date,Math.floor(t/_),"day");if(this.templates[this._mode+"_second_scalex_class"]){p.className+=" "+this.templates[this._mode+"_second_scalex_class"](new Date(l))}var h,c=this._cols[t]*_-1;if(_>1&&this.config.rtl){h=this._colsS[t-(_-1)]-this.xy.scroll_width-2}else if(_>1){h=this._colsS[t-(_-1)]-this.xy.scale_width-2}else{h=s}this.set_xy(p,c,this.xy.scale_height-2,h,0);p.innerHTML=this.templates[this._mode+"_second_scale_date"](new Date(l),this._mode);n.appendChild(p)}e.xy.scale_height=o}};var p=e._get_event_sday;e._get_event_sday=function(t){var s=e._props[this._mode];if(s){if(s.days<=1){i(s,t);return this._get_section_sday(t[s.map_to])}else{var a=24*60*60*1e3;var r=Math.floor((t.end_date.valueOf()-1-t.end_date.getTimezoneOffset()*60*1e3-(e._min_date.valueOf()-e._min_date.getTimezoneOffset()*60*1e3))/a);var n=s.size||s.options.length;var o=s.order[t[s.map_to]];return r*n+o-s.position}}return p.call(this,t)};e._get_section_sday=function(t){var s=e._props[this._mode];return s.order[t]-s.position};var l=e.locate_holder_day;e.locate_holder_day=function(t,s,a){var r=e._props[this._mode];if(!r){return l.apply(this,arguments)}var n;if(!a){a={start_date:t,end_date:t};n=0}else{i(r,a)}if(r.days<=1){return(n===undefined?r.order[a[r.map_to]]:n)*1+(s?1:0)-r.position}else{var o=24*60*60*1e3;var _=Math.floor((a.start_date.valueOf()-e._min_date.valueOf())/o);var d=r.size||r.options.length;var p=n===undefined?r.order[a[r.map_to]]:n;return _*d+p*1+(s?1:0)-r.position}};var h=e._time_order;e._time_order=function(t){var s=e._props[this._mode];if(s){t.sort(function(e,t){return s.order[e[s.map_to]]>s.order[t[s.map_to]]?1:-1})}else h.apply(this,arguments)};var c=e._pre_render_events_table;e._pre_render_events_table=function(t,s){var a=e._props[this._mode];if(a&&a.days>1){var i={};for(var r=0;r<t.length;r++){var n=t[r];if(!e.isOneDayEvent(t[r])){var o=new Date(Math.min(+n.end_date,+this._max_date)),_=new Date(Math.max(+n.start_date,+this._min_date));_=e.date.day_start(_);t.splice(r,1);r--;while(+_<+o){var d=this._copy_event(n);d.start_date=_;d.end_date=g(d.start_date);_=e.date.add(_,1,"day");var p=+e.date.date_part(new Date(_));if(!i[p])i[p]=[];i[p].push(d)}}else{var p=+e.date.date_part(new Date(n.start_date));if(!i[p])i[p]=[];i[p].push(n)}}var l;var t=[];for(var r in i){var h=c.apply(this,[i[r],s]);var f=this._colsS.heights;if(!l||f[0]>l[0]){l=f.slice()}t.push.apply(t,h)}var v=this._colsS.heights;v.splice(0,v.length);v.push.apply(v,l);for(var r=0;r<t.length;r++){if(this._ignores[t[r]._sday]){t.splice(r,1);r--}else{var u=t[r];u._first_chunk=u._last_chunk=false;var m=this.getEvent(u.id);m._sorder=u._sorder}}t.sort(function(e,t){if(e.start_date.valueOf()==t.start_date.valueOf())return e.id>t.id?1:-1;return e.start_date>t.start_date?1:-1})}else{t=c.apply(this,[t,s])}function g(t){var s=e.date.add(t,1,"day");s=e.date.date_part(s);return s}return t};e.attachEvent("onEventAdded",function(t,s){if(this._loading)return true;for(var a in e._props){var i=e._props[a];if(typeof s[i.map_to]=="undefined"&&i.options[0]){s[i.map_to]=i.options[0].key}}return true});e.attachEvent("onEventCreated",function(t,s){var a=e._props[this._mode];if(a&&s){var r=this.getEvent(t);i(a,r);var n=this._mouse_coords(s);this._update_unit_section({view:a,event:r,pos:n});this.event_updated(r)}return true})})()});