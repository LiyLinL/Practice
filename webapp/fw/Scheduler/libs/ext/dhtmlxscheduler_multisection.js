/*

@license
dhtmlxScheduler v.5.3.10 Professional

This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.config.multisection=true;e.config.multisection_shift_all=true;e.config.section_delimiter=",";e.attachEvent("onSchedulerReady",function(){if(!e._inited_multisection_copies){e.attachEvent("onEventIdChange",function(e,t){var i=this._multisection_copies;if(!i)return;if(i[e]&&!i[t]){var n=i[e];delete i[e];i[t]=n}});e._inited_multisection_copies=true}e._register_copies_array=function(e){for(var t=0;t<e.length;t++)this._register_copy(e[t])};e._register_copy=function(e){if(!this._multisection_copies){return}if(!this._multisection_copies[e.id]){this._multisection_copies[e.id]={}}var t=e[this._get_section_property()];var i=this._multisection_copies[e.id];i[t]=e};e._get_copied_event=function(t,i){if(!this._multisection_copies[t])return null;if(this._multisection_copies[t][i])return this._multisection_copies[t][i];var n=this._multisection_copies[t];if(e._drag_event&&e._drag_event._orig_section&&n[e._drag_event._orig_section]){return n[e._drag_event._orig_section]}else{var _=Infinity,s=null;for(var r in n){if(n[r]._sorder<_){s=n[r];_=n[r]._sorder}}return s}};e._clear_copied_events=function(){this._multisection_copies={}};e._restore_render_flags=function(t){var i=this._get_section_property();for(var n=0;n<t.length;n++){var _=t[n];var s=e._get_copied_event(_.id,_[i]);if(s){for(var r in s){if(r.indexOf("_")===0){_[r]=s[r]}}}}};var t=e._update_unit_section;e._update_unit_section=function(i){return e._update_sections(i,t)};var i=e._update_timeline_section;e._update_timeline_section=function(t){return e._update_sections(t,i)};e.isMultisectionEvent=function(e){if(e&&this._get_multisection_view()){var t=this._get_event_sections(e);return t.length>1}return false};e._get_event_sections=function(e){var t=this._get_section_property();var i=e[t]||"";return this._parse_event_sections(i)};e._parse_event_sections=function(t){if(t instanceof Array){return t}else{return t.toString().split(e.config.section_delimiter)}};e._clear_copied_events();e._split_events=function(t){var i=[];var n=this._get_multisection_view();var _=this._get_section_property();if(n){for(var s=0;s<t.length;s++){var r=this._get_event_sections(t[s]);if(r.length>1){for(var o=0;o<r.length;o++){if(typeof n.order[r[o]]==="undefined")continue;var c=e._copy_event(t[s]);c[_]=r[o];i.push(c)}}else{i.push(t[s])}}}else{i=t}return i};e._get_multisection_view=function(){if(!this.config.multisection){return false}else{return e._get_section_view()}};var n=e.get_visible_events;e.get_visible_events=function(e){this._clear_copied_events();var t=n.apply(this,arguments);if(this._get_multisection_view()){t=this._split_events(t);for(var i=0;i<t.length;i++){if(!this.is_visible_events(t[i])){t.splice(i,1);i--}}this._register_copies_array(t)}return t};e._rendered_events={};var _=e.render_view_data;e.render_view_data=function(e,t){if(this._get_multisection_view()&&e){e=this._split_events(e);this._restore_render_flags(e)}return _.apply(this,[e,t])};e._update_sections=function(t,i){var n=t.view,_=t.event,s=t.pos,r=true;if(!e.isMultisectionEvent(_)){i.apply(e,[t])}else{if(!e._drag_event._orig_section){e._drag_event._orig_section=s.section}if(e._drag_event._orig_section!=s.section){var o=n.order[s.section]-n.order[e._drag_event._orig_section];if(o){var c=this._get_event_sections(_);var a=[];var l=true;if(e.config.multisection_shift_all){for(var v=0;v<c.length;v++){var u=e._shift_sections(n,c[v],o);if(u!==null){a[v]=u}else{a=c;l=false;break}}}else{for(var v=0;v<c.length;v++){if(c[v]==s.section){a=c;l=false;break}if(c[v]==e._drag_event._orig_section){var u=e._shift_sections(n,c[v],o);if(u!==null){a[v]=u}else{a=c;l=false;break}}else{a[v]=c[v]}}}if(l)e._drag_event._orig_section=s.section;_[e._get_section_property()]=a.join(e.config.section_delimiter)}}}};e._shift_sections=function(e,t,i){var n=null;var _=e.y_unit||e.options;for(var s=0;s<_.length;s++){if(_[s].key==t){n=s;break}}var r=_[n+i];if(!r){return null}return r.key};var s=e._get_blocked_zones;e._get_blocked_zones=function(e,t,i,n,_){if(t&&this.config.multisection){t=this._parse_event_sections(t);var r=[];for(var o=0;o<t.length;o++){r=r.concat(s.apply(this,[e,t[o],i,n,_]))}return r}else{return s.apply(this,arguments)}};var r=e._check_sections_collision;e._check_sections_collision=function(e,t){if(this.config.multisection&&this._get_section_view()){e=this._split_events([e]);t=this._split_events([t]);var i=false;for(var n=0,_=e.length;n<_;n++){if(i){break}for(var s=0,o=t.length;s<o;s++){if(r.apply(this,[e[n],t[s]])){i=true;break}}}return i}else{return r.apply(this,arguments)}}})});